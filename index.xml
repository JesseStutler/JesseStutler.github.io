<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Jesse's Blog</title><link>http://example.org/</link><description>Recent content on Jesse's Blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>æœ¬ç«™éµå¾ª CC-BY-NC 4.0 åè®®</copyright><lastBuildDate>Tue, 09 Mar 2021 16:30:52 +0800</lastBuildDate><atom:link href="http://example.org/index.xml" rel="self" type="application/rss+xml"/><item><title>Raft</title><link>http://example.org/posts/raft/</link><pubDate>Tue, 09 Mar 2021 16:30:52 +0800</pubDate><guid>http://example.org/posts/raft/</guid><description>Jesse's Blog http://example.org/posts/raft/ -&lt;h1 id="raft">Raft&lt;/h1>
&lt;h2 id="å¼•è¨€">å¼•è¨€&lt;/h2>
&lt;p>Raftæ˜¯åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§ç®—æ³•ï¼Œç”¨äºè§£å†³PAXOSå¤šå¹´æ¥æ™¦æ¶©éš¾æ‡‚ä¸”éš¾ä»¥å·¥ç¨‹å¤ç°çš„é—®é¢˜ï¼Œæœ¬æ–‡å¯¹Raftå‘è¡¨çš„åŸæ–‡è®ºæ–‡è¿›è¡Œäº†å¤§è‡´è§£è¯»&lt;/p>
&lt;h2 id="åŸºæœ¬ç®—æ³•å†…å®¹">åŸºæœ¬ç®—æ³•å†…å®¹&lt;/h2>
&lt;h3 id="basics">Basics&lt;/h3>
&lt;p>&lt;img src="https://github.com/maemual/raft-zh_cn/raw/master/images/raft-%E5%9B%BE5.png" alt="å›¾ 5">&lt;/p>
&lt;h4 id="followercandidateleader">Follower,Candidate,Leader&lt;/h4>
&lt;p>æ¯ä¸ªserveråˆ†ä¸ºä¸‰ç§çŠ¶æ€ï¼ˆçŠ¶æ€è½¬æ¢å›¾è§Leader electionï¼‰ï¼š&lt;/p>
&lt;ul>
&lt;li>Followerï¼šåªæ¥å—RPCè¯·æ±‚ï¼ˆå°±ç®—æ”¶åˆ°æ¥è‡ªclientçš„è¯·æ±‚ä¹Ÿä¼šé‡å®šå‘ç»™leaderï¼‰&lt;/li>
&lt;li>Candidateï¼šå‚åŠ ç«é€‰ï¼Œå¯ä»¥å‘é€RequestVote RPCï¼ŒåŒæ ·ä¹Ÿå¯ä»¥æ¥å—è¯·æ±‚&lt;/li>
&lt;li>Leaderï¼ˆonly oneï¼‰ï¼š&lt;strong>åªæœ‰Leaderå¯ä»¥å¤„ç†æ¥è‡ªclientçš„è¯·æ±‚&lt;/strong>ï¼Œå¯ä»¥å‘é€AppendEntries RPCï¼Œå¯ä»¥æ˜¯è¿½åŠ æ—¥å¿—æ¡ç›®ç”¨ï¼Œä¹Ÿå¯ä»¥æ˜¯å¿ƒè·³æ£€æµ‹ç”¨ï¼ˆå®šæœŸæ£€æµ‹å…¶ä»–serveræ˜¯å¦è¿˜æ´»ç€ï¼Œé€šè¿‡&lt;strong>æ— æ¡ç›®è¿½åŠ &lt;/strong>çš„AppendEntries RPCæ¥åšåˆ°ï¼‰&lt;/li>
&lt;/ul>
&lt;h4 id="termä»»æœŸ">termâ€”â€”ä»»æœŸ&lt;/h4>
&lt;p>Raftå°†æ—¶é—´éšæœºåˆ’åˆ†ï¼Œæ¯ä¸€æ®µç§°ä¸º&lt;strong>ä»»æœŸ&lt;/strong>ï¼ˆä»»æœŸæ˜¯å•è°ƒé€’å¢çš„ï¼‰ï¼Œä»»æœŸéƒ½ä»¥ä¸€æ¬¡é€‰ä¸¾å¼€å§‹ï¼Œé€‰ä¸¾å¯ä»¥æ˜¯é€‰å‡ºleaderä¹Ÿå¯ä»¥æ˜¯æœªèƒ½é€‰å‡ºleaderï¼ˆæœªèƒ½é€‰å‡ºleaderå°±ç›´æ¥è¿›å…¥ä¸‹ä¸€ä»»æœŸï¼‰&lt;/p>
&lt;p>&lt;strong>æ¯å°serverå‘ç°è‡ªå·±çš„ä»»æœŸå°äºå…¶ä»–æœºå™¨å°±éœ€è¦updateåˆ°æœ€æ–°&lt;/strong>&lt;/p>
&lt;h4 id="entryæ¡ç›®">entryâ€”â€”æ¡ç›®&lt;/h4>
&lt;p>æ¡ç›®å°±æ˜¯æŒ‡æ—¥å¿—çš„æ¡ç›®ï¼Œç”±clientå‘æ¥çš„&lt;code>command+ä»»æœŸæ•°ï¼ˆterm numberï¼Œç”¨æ¥æ£€æµ‹ä¸ä¸€è‡´æ€§ï¼‰+indexï¼ˆæ¡ç›®ç´¢å¼•ï¼‰&lt;/code>æ„æˆ&lt;/p>
&lt;h3 id="leader-election">Leader election&lt;/h3>
&lt;p>&lt;img src="https://github.com/maemual/raft-zh_cn/raw/master/images/raft-%E5%9B%BE4.png" alt="å›¾ 4 ">&lt;/p>
&lt;p>çŠ¶æ€è½¬æ¢å›¾åˆ†æï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Starts up:&lt;/p>
&lt;p>åˆå§‹æ—¶ï¼Œæ¯å°serveréƒ½æ˜¯Follower&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Follower&amp;mdash;&amp;gt;Candidateï¼š&lt;/p>
&lt;p>å½“è¶…å‡ºelection timeoutæ—¶é—´ï¼ˆé•¿æ—¶é—´æœªæ”¶åˆ°æœ‰Leaderå‘è¿‡æ¥çš„RPCæ¶ˆæ¯ï¼Œè¯´æ˜å½“å‰clusteræœªé€‰å‡ºleaderï¼Œæˆ–è€…æ˜¯æœªæ”¶åˆ°æ¥è‡ªcandidateçš„RequestVote RPCï¼‰ï¼ŒFollowerå¢åŠ è‡ªå·±çš„å½“å‰ä»»æœŸæ•°ï¼Œå¹¶å°†è‡ªå·±è½¬æ¢ä¸ºCandidateï¼›å‚åŠ ç«é€‰leaderï¼Œç»™è‡ªå·±æŠ•ç¥¨ï¼Œç„¶åå¹¶å‘åœ°å‘å…¶ä»–serverå‘é€RequestVote RPCè¯·æ±‚ï¼Œéœ€è¦ä»–ä»¬ç»™è‡ªå·±è¿›è¡ŒæŠ•ç¥¨ï¼ˆ&lt;strong>ä¸€èˆ¬è§„åˆ™æ˜¯å…ˆæ”¶åˆ°è°è¯·æ±‚å°±æŠ•è°&lt;/strong>ï¼‰ï¼›é‡è®¾election timeout&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Candidate&amp;mdash;&amp;gt;Candidateï¼š&lt;/p>
&lt;ul>
&lt;li>é€‰ä¸¾å‘ç”ŸæŠ•ç¥¨åˆ†æ­§&lt;/li>
&lt;/ul>
&lt;p>æœªèƒ½é€‰å‡ºleaderï¼ˆå‘ç”ŸæŠ•ç¥¨åˆ†æ­§ï¼‰ï¼Œæ¯”å¦‚æœ‰å¥½å‡ å°Candidatesç¥¨æ•°ä¸€è‡´çš„æƒ…å†µï¼Œæˆ–è€…å¤§å®¶éƒ½æ˜¯Candidateï¼ˆä¸å¯èƒ½ç»™ç«äº‰å¯¹æ‰‹æŠ•ç¥¨æ˜¯å§:P ï¼‰ï¼Œå¢åŠ è‡ªå·±çš„å½“å‰ä»»æœŸæ•°ï¼Œå¹¶å¼€å§‹æ–°ä¸€è½®çš„é€‰ä¸¾ã€‚ä¸è¿‡è¿™æ ·æœ‰å¯èƒ½é€ æˆä¸€ç›´äº§ç”ŸæŠ•ç¥¨åˆ†æ­§çš„æƒ…å†µï¼Œæ‰“ç ´è¿™ç§æƒ…å†µå¹¶é€‰å‡ºleaderçš„æœºåˆ¶å°±æ˜¯&lt;strong>election timeoutï¼ŒCandidatesä»æ—¶é—´æ®µä¸­éšæœºç»™è‡ªå·±é€‰ä¸€ä¸ªelection timeoutæ—¶é—´ï¼Œå¦‚æœå‘ç”ŸæŠ•ç¥¨åˆ†æ­§ï¼Œå…ˆè¶…æ—¶çš„Candidateèµ¢å¾—é€‰ä¸¾&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Candidateæ”¶åˆ°Leaderï¼ˆå·²ç»æš‚æ—¶é€‰å‡ºçš„ï¼‰çš„RPCè¯·æ±‚ï¼Œå‘ç°å…¶ä»»æœŸæ¯”è‡ªå·±æ—§ï¼Œæ‹’ç»è¯·æ±‚å¹¶ä¿æŒCandidateçŠ¶æ€&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Candidate&amp;mdash;&amp;gt;Leaderï¼š&lt;/p>
&lt;p>èµ¢å¾—ç«é€‰ï¼ˆè·å¾—&lt;strong>å¤§å¤šæ•°&lt;/strong>serversçš„æŠ•ç¥¨ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Leader&amp;mdash;&amp;gt;Follower:&lt;/p>
&lt;p>é€šè¿‡RPCçš„å›å¤å‘ç°è‡ªå·±çš„ä»»æœŸå·²è¿‡æœŸï¼ˆæœ‰æ¯”è‡ªå·±æ›´æ–°çš„ä»»æœŸï¼‰ï¼Œé€€å›åˆ°Follower&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Candidate&amp;mdash;&amp;gt;Followerï¼š&lt;/p>
&lt;ul>
&lt;li>è¾“æ‰é€‰ä¸¾ï¼ˆæ”¶åˆ°äº†æ¥è‡ªå·±å·²é€‰å‡ºçš„leaderçš„RPCï¼Œ&lt;strong>ä½†è¦ç¡®å®šè‡ªå·±çš„ä»»æœŸè‡³å°‘å’ŒLeaderçš„ä»»æœŸç›¸åŒï¼Œå‚è€ƒç¬¬3æ­¥&lt;/strong>ï¼‰&lt;/li>
&lt;li>é€šè¿‡RPCçš„å›å¤å‘ç°è‡ªå·±çš„ä»»æœŸå·²è¿‡æœŸï¼ˆæœ‰æ¯”è‡ªå·±æ›´æ–°çš„ä»»æœŸï¼‰ï¼Œé€€å›åˆ°Follower&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h3 id="log-replication">Log Replication&lt;/h3>
&lt;p>&lt;strong>é¦–å…ˆè¦è¯´æ˜çš„æ˜¯ï¼ŒLeaderåªè¿½åŠ æ¡ç›®ï¼ˆentryï¼‰è€Œä¸ä¿®æ”¹æˆ–åˆ é™¤entry&lt;/strong>&lt;/p>
&lt;p>Leaderé€šè¿‡AppendEntries RPCæ¥åŠ æ¡ç›®å¤åˆ¶åˆ°å…¶ä»–serversä¸Šï¼Œå¦‚æœæœ‰serveræŒ‚äº†ä»–ä¹Ÿä¼šä¸€ç›´é‡å¤å°è¯•å‘é€ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Followerå¦‚ä½•ç¡®å®šè‡ªå·±Leaderå‘è¿‡æ¥çš„æ¡ç›®å¯ä»¥è¿½åŠ ï¼Ÿ&lt;/p>
&lt;p>Leaderå‘é€çš„æ¡ç›®ä¼šåŒ…æ‹¬ç´¢å¼•å·å’Œä»»æœŸæ•°ï¼Œå¦‚æœFollweræ²¡æœ‰æ‰¾åˆ°ç›¸åŒç´¢å¼•å·å’Œä»»æœŸæ•°çš„æ¡ç›®ï¼Œå°±æ‹’ç»è¯·æ±‚ï¼Œæ‰¾åˆ°äº†å°±è¯´æ˜è¿™ä¸ªæ¡ç›®ä¹‹å‰çš„æ¡ç›®éƒ½æ˜¯ç›¸åŒçš„&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¡ç›®ä»€ä¹ˆæ—¶å€™åº”è¯¥è¢«applyåˆ°å„ä¸ªæœºå™¨ä¸Šï¼Ÿ&lt;/p>
&lt;p>æˆ‘ä»¬ç§°ä¹‹ä¸º&lt;strong>æäº¤&lt;/strong>ï¼ˆcommitedï¼‰ï¼Œå½“æ¡ç›®&lt;strong>å·²ç»è¢«å¤åˆ¶åˆ°å¤§å¤šæ•°çš„servers&lt;/strong>ä¸Šï¼ˆç»´æŠ¤ä¸€ä¸ªreplicasæ¥ç¡®å®šï¼‰ï¼Œè¿™äº›æ¡ç›®ï¼ˆåŒ…æ‹¬ä¹‹å‰çš„æœªæäº¤çš„æ¡ç›®ï¼Œå‰leaderå‰©ä¸‹çš„æœªæäº¤çš„æ¡ç›®ï¼‰å°±éƒ½ä¼šè¢«æäº¤ï¼Œæ¯å°serveréƒ½ä¼šç»´æŠ¤ä¸€ä¸ªhighest indexè¡¨ç¤ºæœ€åçš„å·²ç»æäº¤çš„æ¡ç›®ï¼Œå·²è¡¨ç¤ºè¿™ä¹‹å‰çš„æ¡ç›®éƒ½å·²æäº¤&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="leader-crashæ‰€å¯¼è‡´çš„logä¸ä¸€è‡´é—®é¢˜">Leader crashæ‰€å¯¼è‡´çš„logä¸ä¸€è‡´é—®é¢˜&lt;/h3>
&lt;p>è¿™ä¸ªå°±æ˜¯å…³é”®è¦è§£å†³çš„ï¼ŒLeaderå´©æºƒï¼ˆç„¶åå‘ç”ŸLeader exchangeï¼‰å¯èƒ½ä¼šå¯¼è‡´ä¸€ç³»åˆ—å„serverä¸Š&lt;strong>logä¸ä¸€è‡´&lt;/strong>çš„é—®é¢˜ï¼ˆå‰leaderå¯èƒ½è¿˜æœªå®Œå…¨å¤åˆ¶ç»™æ‰€æœ‰æœºå™¨ï¼‰ï¼Œ&lt;strong>Followerå¯èƒ½ä¼šå¸¦æœ‰ç°Leaderæ²¡æœ‰çš„logï¼Œæˆ–è€…æ›´å¤æ‚çš„ä¸ä¸€è‡´é—®é¢˜&lt;/strong>ï¼Œé‚£å¦‚ä½•è§£å†³å‘¢ï¼Ÿ&lt;/p>
&lt;p>&lt;strong>è¦†ç›–&lt;/strong>ã€‚&lt;/p>
&lt;p>å¦‚æœæœ‰ä¸ä¸€è‡´çš„logï¼ŒLeaderéœ€è¦æ‰¾åˆ°å’ŒFollowerçš„æ—¥å¿—ä¸­ç›¸åŒçš„&lt;strong>æœ€åä¸€ä¸ªæ¡ç›®&lt;/strong>ï¼ˆä¹Ÿå°±æ˜¯ç´¢å¼•å·å’Œä»»æœŸæ•°ç›¸åŒï¼Œè¯´æ˜ä¹‹å‰çš„æ¡ç›®éƒ½ç›¸åŒï¼‰ï¼Œç„¶åå°†åé¢ä¸ä¸€æ ·çš„æ¡ç›®éƒ½&lt;strong>è¦†ç›–æˆLeaderçš„&lt;/strong>ï¼ˆå½“ç„¶ç¼ºå°‘çš„è¯å°±ç›´æ¥è¿½åŠ ï¼‰ã€‚&lt;/p>
&lt;blockquote>
&lt;p>è§£å†³æ–¹æ³•ï¼šå½“æ–°leaderå‡ºç°æ—¶ï¼Œä»–ä¼šå…ˆè¿›è¡Œä¸€è‡´æ€§æ£€æŸ¥ï¼Œä»–ä¼šç»´æŠ¤ä¸€ä¸ªnextIndexï¼Œè¡¨ç¤ºä¸‹ä¸€ä¸ªè¦å‘é€ç»™followerçš„æ¡ç›®çš„ç´¢å¼•å·ï¼Œå½“followeræ‹’ç»è¿½åŠ è¯·æ±‚æ—¶ï¼ˆå‘ç°ä¸ä¸€è‡´ï¼‰ï¼Œleaderå°±å‡å°nextIndexçš„å¤§å°ï¼Œ&lt;strong>ç›´åˆ°æ¡ç›®ç›¸åŒä¸ºæ­¢&lt;/strong>ï¼Œç„¶åleaderæŠŠè¿™ä¹‹åçš„æ¡ç›®å…¨éƒ¨è¦†ç›–æ‰Followerçš„æ—¥å¿—&lt;/p>
&lt;/blockquote>
&lt;h3 id="safety">Safety&lt;/h3>
&lt;p>å½“leaderæäº¤çš„æ—¶å€™ä¸‡ä¸€å‘ç”ŸFollowerå´©æºƒçš„æƒ…å†µï¼Œè€ŒFollowerå¤åŸä¹‹ååˆå½“ä¸Šæ–°leaderï¼Œå¯èƒ½ä¼šå‡ºç°è¦†ç›–ä¹‹å‰å·²ç»æäº¤çš„entryçš„æƒ…å†µï¼Œç»§è€Œé€ æˆä¸åŒserveræœ€åæ‰§è¡Œäº†ä¸åŒcommandçš„æƒ…å†µ&lt;/p>
&lt;blockquote>
&lt;p>è§£å†³æ–¹æ³•ï¼šåŠ ä¸Šelection restrictionï¼Œå¯¹äºcandidate&lt;strong>å¿…é¡»è¦æ¶µç›–ä¹‹å‰å·²ç»æ‰€æœ‰å·²ç»æäº¤çš„entry&lt;/strong>ï¼Œä¹Ÿå°±æ˜¯è¯´å°±ç®—candidateè·å¾—äº†å¤§å¤šæ•°ç¥¨æ•°çš„æƒ…å†µä¸‹ï¼Œå¿…é¡»ä»¥æ¶µç›–æ‰€æœ‰å·²æäº¤entryä¸ºå‰æï¼Œå¦åˆ™ä¸èƒ½èµ¢å¾—é€‰ä¸¾&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>
&lt;p>é‚£å¦‚ä½•ä¿è¯candidateæ¶µç›–äº†æ‰€æœ‰å·²ç»æäº¤çš„æ¡ç›®å‘¢ï¼Ÿ&lt;/p>
&lt;p>candidateçš„æ—¥å¿—å¿…é¡»æ˜¯æœ€æ–°çš„ï¼ˆup-to-dateï¼‰ã€‚æ€æ ·è§„å®šæœ€æ–°å‘¢ï¼Ÿä¸¤ä¸ªserverçš„æ—¥å¿—å¦‚æœä»»æœŸæ›´æ–°è€…å°±æ˜¯æœ€æ–°çš„ï¼Œæˆ–è€…ä»»æœŸç›¸åŒè€Œæ‹¥æœ‰æ›´é•¿ç´¢å¼•è€…å°±æ˜¯æœ€æ–°çš„ã€‚å¦‚æœcandidateå‘é€RequestVote RPCï¼Œ&lt;strong>è€Œå…¶logä¸æ¯”voteræ–°ï¼Œvoterå°±è¦æ‹’ç»æŠ•ç¥¨ç»™candidate&lt;/strong>ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>è¿˜æœ‰çš„æƒ…å†µæ˜¯ï¼Œæ—§leaderæœªèƒ½æäº¤entryï¼Œè€Œæ–°leaderä¹Ÿæ— æ³•ç¡®å®šè¿™ä¸ªentryæ˜¯å¦å·²æäº¤&lt;/p>
&lt;blockquote>
&lt;p>leaderåªä¸ºå½“å‰ä»»æœŸæ˜¯å¦åº”è¯¥æäº¤ç»´æŠ¤ä¸€ä¸ªreplicasï¼Œä¹Ÿå°±æ˜¯replicaså¦‚æœæ˜¯å¤§å¤šæ•°çš„è¯å°±æäº¤&lt;/p>
&lt;/blockquote>
&lt;h3 id="follower-and-candidate-crashes">Follower and candidate crashes&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>å½“Followerå’Œcandidateå´©æºƒæ—¶ï¼ŒLeaderä¼šä¸€ç›´æ— é™æœŸçš„é‡å‘RPCç›´åˆ°å®ƒä»¬é‡å¯å¹¶æˆåŠŸæ”¶åˆ°ä¸ºæ­¢&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¿è¯å¹‚ç­‰æ€§ï¼šå¦‚æœserveråœ¨å“åº”RPCå‰å´©æºƒï¼Œè¦ä¿è¯æ¢å¤åRPCçš„å“åº”ç»“æœæ˜¯ä¸€æ ·çš„&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="timing-and-availability">Timing and availability&lt;/h3>
&lt;blockquote>
&lt;p>å¹¿æ’­æ—¶é—´ &amp;laquo; é€‰ä¸¾è¶…æ—¶æ—¶é—´ &amp;laquo; å¹³å‡å´©æºƒæ—¶é—´&lt;/p>
&lt;/blockquote>
&lt;p>ç³»ç»Ÿçš„æ—¶é—´è¦éµå¾ªä¸Šè¿°ä¸ç­‰å¼ï¼Œç¬¬ä¸€ä¸ªä¸ç­‰å¼é¿å…Followeræ”¶ä¸åˆ°å¿ƒè·³æ¶ˆæ¯è€Œè½¬è€Œå˜æˆCandidateçŠ¶æ€è¿›å…¥æ–°çš„é€‰ä¸¾ï¼Œç¬¬äºŒä¸ªä¸ç­‰å¼é¿å…ä¸€ç›´æ— æ³•é€‰å‡ºLeader&lt;/p>
&lt;p>å¹¿æ’­æ—¶é—´å’Œå¹³å‡å´©æºƒæ—¶é—´ç”±ç°å®å†³å®šï¼Œ&lt;strong>é€‰ä¸¾è¶…æ—¶æ—¶é—´ä¸€èˆ¬åœ¨10msåˆ°500msä¹‹é—´&lt;/strong>&lt;/p>
&lt;h2 id="ä¼˜åŒ–">ä¼˜åŒ–&lt;/h2>
&lt;h3 id="cluster-membership-changes">Cluster membership changes&lt;/h3>
&lt;p>å¦‚æœé›†ç¾¤éœ€è¦æ›´æ”¹é…ç½®ï¼Œæ¯”å¦‚æ›¿æ¢æ‰åŸæ¥çš„æœºå™¨æˆ–è€…åŠ å…¥æ–°æœºå™¨ï¼Œå…ˆå°†é›†ç¾¤åœæ‰ï¼Œæ›´æ”¹å®Œé…ç½®ä¹‹åå†ä¸Šçº¿ä¼šè®©é›†ç¾¤æœ‰æ®µæ—¶é—´ä¸å¯ç”¨ï¼Œä½†æ˜¯å¦‚æœç›´æ¥å°†æ—§é…ç½®æ”¹ä¸ºæ–°é…ç½®æœ‰å¯èƒ½ä¼šé€ æˆé›†ç¾¤åŒæ—¶å‡ºç°ä¸¤ä¸ªleaderçš„æƒ…å†µã€‚Raftç”¨ä¸€ç§ä¸¤é˜¶æ®µç®—æ³•ï¼Œå¼•å…¥äº†ä¸€ä¸ªè¿‡æ¸¡é…ç½®â€”â€”å…±åŒä¸€è‡´ï¼Œé›†ç¾¤åŒæ—¶å¯ä»¥æœ‰æ—§é…ç½®å’Œæ–°é…ç½®çš„å­˜åœ¨ï¼Œä½†éœ€è¦è¿›è¡Œä¸€å®šçš„é™åˆ¶ï¼Œå…·ä½“å‚è€ƒï¼šhttps://github.com/maemual/raft-zh_cn/blob/master/raft-zh_cn.md#6-%E9%9B%86%E7%BE%A4%E6%88%90%E5%91%98%E5%8F%98%E5%8C%96&lt;/p>
&lt;h3 id="log-compaction">Log compaction&lt;/h3>
&lt;p>é¿å…å­˜å‚¨æ—¥å¿—è¿‡å¤šï¼ˆæäº¤äº†ä¹‹åçš„æ—¥å¿—æ¡ç›®ä¼šå ç”¨è¿‡å¤šç£ç›˜ç©ºé—´ï¼Œå…¶å®åªè¦ä¿ç•™ä¸€ç‚¹metadataç”¨æ¥æ ‡è¯†å’Œå›æ»šå°±å¤Ÿäº†ï¼‰&lt;/p>
&lt;blockquote>
&lt;p>è§£å†³æ–¹æ³•ï¼šsnapshotï¼ˆå¿«ç…§ï¼‰ï¼Œ&lt;strong>ç”±æ¯å°serverè‡ªå·±&lt;/strong>å°†å·²ç»æäº¤çš„æ¡ç›®ä¿¡æ¯ç”¨metadataçš„å½¢å¼è®°å½•ä¸‹æ¥å½¢æˆsnapshotï¼Œç„¶åå°±å¯ä»¥æŠŠå·²ç»æäº¤çš„æ—¥å¿—æ¡ç›®ä¸¢å¼ƒäº†ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘æ—¥å¿—å ç”¨çš„ç©ºé—´ï¼Œè€Œä¸”æ–¹ä¾¿ä¸€è‡´æ€§æ£€æŸ¥ï¼Œå°±æ˜¯æˆ‘ä»¬å‰æ–‡æåˆ°çš„å½“leader crashæ—¶å‡ºç°çš„ä¸€ç³»åˆ—é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿæ£€ç´¢metadataè·å–æœ€åæäº¤çš„æ¡ç›®ä¿¡æ¯&lt;/p>
&lt;/blockquote>
&lt;p>è¿™é‡Œå¼•å…¥ä¸€ä¸ªInstallSnapshot RPCï¼Œå½“å‡ºç°serverå·²ç»æäº¤è€ŒFollowerè¿˜æœªæäº¤çš„æƒ…å†µï¼ˆæ¯”å¦‚åˆšåˆšåŠ å…¥é›†ç¾¤çš„æœºå™¨æˆ–è€…æ¯”è¾ƒæ…¢çš„æœªæ”¶åˆ°entryçš„æœºå™¨ï¼‰ï¼Œè¿™æ—¶å€™Followerçš„snapshotæ˜¯è¿œè¿œè½åçš„&lt;/p>
&lt;h3 id="client-interaction">client interaction&lt;/h3>
&lt;p>clientæ˜¯éšæœºè¯·æ±‚é›†ç¾¤ä¸­çš„serverï¼Œä¸ä¸€å®šæ˜¯leaderï¼Œå¦‚æœæ˜¯Followeræ”¶åˆ°äº†è¯·æ±‚ä»–ä¼šé‡å®šå‘ç»™Leaderï¼ˆAppendEntries RPCä¸­åŒ…å«äº†Leaderçš„åœ°å€ï¼‰&lt;/p>
&lt;p>å½“Leaderå·²ç»æ‰§è¡Œäº†clientçš„è¯·æ±‚å‘æ¥çš„commandï¼Œä½†æ˜¯å“åº”clientå‰å´©æºƒï¼Œclientå¯èƒ½ä¼šé‡æ–°æäº¤è¿™ä¸ªcommandçš„è¯·æ±‚ï¼Œé€ æˆä¸¤æ¬¡æ‰§è¡ŒåŒæ ·çš„commandï¼Œæˆ‘ä»¬éœ€è¦ç»™æ¯ä¸ªcommandç»´æŠ¤ä¸€ä¸ªserial numberï¼Œè¡¨ç¤ºcommandåºåˆ—ï¼Œå½“å·²ç»æ‰§è¡Œè¿‡äº†è¿™ä¸ªserial numberçš„commandï¼Œæ”¶åˆ°åŒæ ·çš„è¯·æ±‚å°±ä¸å†æ‰§è¡Œ&lt;/p>
&lt;h2 id="references">References&lt;/h2>
&lt;p>&lt;a href="https://github.com/maemual/raft-zh_cn/blob/master/raft-zh_cn.md">https://github.com/maemual/raft-zh_cn/blob/master/raft-zh_cn.md&lt;/a>ï¼ˆè®ºæ–‡ä¸­æ–‡ç¿»è¯‘å’ŒåŸæ–‡ï¼‰&lt;/p>
&lt;p>&lt;a href="https://raft.github.io/">https://raft.github.io/&lt;/a>ï¼ˆraftæ¦‚è¿°å’ŒåŠ¨ç”»æ¼”ç¤ºï¼Œä»¥åŠè®ºæ–‡åŸæ–‡ä¸‹è½½ï¼‰&lt;/p>
- http://example.org/posts/raft/ - æœ¬ç«™éµå¾ª CC-BY-NC 4.0 åè®®</description></item><item><title>GolangåŸºç¡€</title><link>http://example.org/posts/golang%E5%9F%BA%E7%A1%80/</link><pubDate>Sun, 07 Mar 2021 11:25:55 +0800</pubDate><guid>http://example.org/posts/golang%E5%9F%BA%E7%A1%80/</guid><description>Jesse's Blog http://example.org/posts/golang%E5%9F%BA%E7%A1%80/ -&lt;h1 id="golang">GOLANG&lt;/h1>
&lt;h2 id="å¼•è¨€">å¼•è¨€&lt;/h2>
&lt;p>äº‘åŸç”Ÿä½“ç³»ä¸‹ï¼Œgolangä¸€å®šæ˜¯å¿…é¡»è¦æŒæ¡çš„é«˜çº§è¯­è¨€ï¼Œgolangå†…ç½®çš„goroutineå¥‘åˆåˆ†å¸ƒå¼æ¶æ„çš„è®¾è®¡ï¼Œè¶Šæ¥è¶Šå¤šçš„å…³äºäº‘çš„å¼€æºé¡¹ç›®é‡‡ç”¨goè¿›è¡Œå®ç°ã€‚æœ¬æ–‡å‚è€ƒï¼šhttp://c.biancheng.net/golang/intro/ ï¼Œæœ¬æ–‡å¯¹goçš„åŸºç¡€çŸ¥è¯†è¿›è¡Œäº†å¤§è‡´ä»‹ç»ï¼Œå¯å‚ç…§å³ä¾§çš„å¤§çº²æ£€ç´¢ï¼Œæœ¬æ–‡ä¼šæŒç»­æ›´æ–°ã€‚&lt;/p>
&lt;p>è¿™é‡Œç¬”è€…ä¹Ÿæ¨èä¸€äº›goç»ƒæ‰‹é¡¹ç›®ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://geektutu.com/post/gee.html">https://geektutu.com/post/gee.html&lt;/a> æå®¢å…”å…”çš„7å¤©ç”¨goä»é›¶å®ç°ç³»åˆ—ï¼ˆå¿…é¡»å¼ºçƒˆæ¨èğŸ‘ï¼Œä¸€å¤©å¤©æ‰“ä¸‹æ¥èƒ½å¯¹å¾ˆå¤šgoçš„å¼€æºé¡¹ç›®æœ‰ä¸ªå¤§è‡´çš„è®¤è¯†ï¼Œä¹Ÿèƒ½å­¦åˆ°å¾ˆå¤šæŠ€å·§ï¼‰&lt;/li>
&lt;li>&lt;a href="https://courses.calhoun.io/courses">https://courses.calhoun.io/courses&lt;/a> éœ€è¦æŒ‚æ¢¯å­ï¼Œä½œä¸ºä¸€äº›å¯¹äºgoä¸åŒçš„åŒ…çš„ç»ƒæ‰‹é¡¹ç›®ä¸é”™&lt;/li>
&lt;/ul>
&lt;h2 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>&lt;code>go install [package-name] &lt;/code>&lt;/p>
&lt;p>ç¼–è¯‘å¹¶å®‰è£…åŒ…ï¼Œå¦‚æœä¸æ˜¯mainåŒ…åˆ™ä¼šå®‰è£…åˆ°pkgåº•ä¸‹ä½œä¸ºåº“åŒ…ï¼Œå¦‚æœæ˜¯mainåŒ…åˆ™ä¼šå®‰è£…åˆ°binåº•ä¸‹ä½œä¸ºå¯æ‰§è¡Œæ–‡ä»¶&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>go doc [package] [func] &lt;/code>&lt;/p>
&lt;p>goæ‰‹å†Œ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>go build [file or package]&lt;/code>&lt;/p>
&lt;p>å¦‚æœæ˜¯mainåŒ…ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¯æ‰§è¡Œæ–‡ä»¶ååŒæ–‡ä»¶å¤¹åï¼‰ï¼Œå¦‚æœä¸æ˜¯mainåŒ…ï¼Œä¸ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œåªè¿›è¡Œç¼–è¯‘&lt;/p>
&lt;p>å¦‚æœæ˜¯å•ä¸ª.goæ–‡ä»¶ï¼ŒmainåŒ…ä¸­&lt;strong>åªèƒ½å¯¹å«mainå‡½æ•°&lt;/strong>çš„goæ–‡ä»¶è¿›è¡Œç¼–è¯‘å¹¶ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå…¶ä»–åŒ…åªè¿›è¡Œç¼–è¯‘&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="go-module">go module&lt;/h3>
&lt;p>&lt;strong>ä»¥åé»˜è®¤ç”¨go moduleçš„æ–¹å¼è¿›è¡ŒåŒ…ç®¡ç†å’Œæ·»åŠ ä¾èµ–ï¼Œä»¥åworkspaceä¸å¿…åœ¨$GOPATHä¸‹ï¼Œ$GOPATHå°±å­˜æ”¾ä¸‹è½½çš„åŒ…å’Œç¼–è¯‘å¥½çš„è¯¾æ‰§è¡Œæ–‡ä»¶&lt;/strong>&lt;/p>
&lt;p>root workspaceåº•ä¸‹æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯go.modï¼ˆåŒ…ç®¡ç†ï¼‰ï¼Œä¸€ä¸ªæ˜¯go.sumï¼ˆåŒ…æ ¡éªŒï¼‰ï¼ŒçœŸæ­£çš„åŒ…ä¸‹è½½å¥½æ”¾åœ¨$GOPATH/pkg/modåº•ä¸‹&lt;/p>
&lt;p>&lt;strong>åœ¨root workspaceåº•ä¸‹&lt;/strong>ç”¨&lt;code>go mod init[æ¨¡å—å]&lt;/code>ç”Ÿæˆgo.modï¼Œæ¨¡å—åå‘½åæ ¼å¼ä¸ºexample.com/xxx..ï¼ˆä¸€èˆ¬å°±github.com/fooè¿™æ ·ï¼‰ï¼Œç„¶åå¼•ç”¨workspaceåº•ä¸‹å­ç›®å½•çš„goæ–‡ä»¶ï¼Œç”¨&lt;code>æ¨¡å—å/å­ç›®å½•å&lt;/code>çš„æ ¼å¼å¼•ç”¨&lt;/p>
&lt;p>&lt;strong>ç»™é¡¹ç›®æ·»åŠ ä¾èµ–ï¼ˆå†™è¿› go.mod)çš„ä¸¤ç§æ–¹æ³•&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½ åªè¦åœ¨é¡¹ç›®ä¸­æœ‰ importï¼Œç„¶å go build å°±ä¼š go module å°±ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶æ·»åŠ ï¼ˆ&lt;strong>perfect way&lt;/strong>ï¼‰&lt;/li>
&lt;li>è‡ªå·±æ‰‹å·¥ä½¿ç”¨ go get ä¸‹è½½å®‰è£…åï¼Œä¼šè‡ªåŠ¨å†™å…¥ go.mod&lt;/li>
&lt;/ul>
&lt;h4 id="å¸¸ç”¨å‘½ä»¤-1">å¸¸ç”¨å‘½ä»¤&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>&lt;code>go mod init&lt;/code>&lt;/p>
&lt;p>åˆå§‹åŒ–module&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>go mod tidy&lt;/code>&lt;/p>
&lt;p>ä¸‹è½½ç¼ºå°‘çš„åŒ…ï¼Œæ¸…é™¤æ²¡æœ‰ç”¨ä¸Šçš„åŒ…&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>go list&lt;/code>&lt;/p>
&lt;p>-m allåˆ—å‡ºæ‰€æœ‰æ¨¡å—&lt;/p>
&lt;p>-u -m allåˆ—å‡ºæ‰€æœ‰æ¨¡å—åŠå…¶å¯èƒ½æ‹¥æœ‰çš„æ›´æ–°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>go get -u [module] &lt;/code>&lt;/p>
&lt;p>æ›´æ–°æ¨¡å—åŠå…¶ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="å˜é‡">å˜é‡&lt;/h2>
&lt;blockquote>
&lt;p>ç®€çŸ­å˜é‡å£°æ˜è¢«å¹¿æ³›ç”¨äºå¤§éƒ¨åˆ†çš„å±€éƒ¨å˜é‡çš„å£°æ˜å’Œåˆå§‹åŒ–ã€‚var å½¢å¼çš„å£°æ˜è¯­å¥å¾€å¾€æ˜¯ç”¨äºéœ€è¦æ˜¾å¼æŒ‡å®šå˜é‡ç±»å‹åœ°æ–¹ï¼Œæˆ–è€…å› ä¸ºå˜é‡ç¨åä¼šè¢«é‡æ–°èµ‹å€¼è€Œåˆå§‹å€¼æ— å…³ç´§è¦çš„åœ°æ–¹ã€‚&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>ä¸€èˆ¬ä»¥ &lt;code>å˜é‡å:=å˜é‡å€¼&lt;/code>çš„å½¢å¼ç”±ç¼–è¯‘å™¨è‡ªè¡Œåˆ¤æ–­ç±»å‹å¹¶èµ‹å€¼ï¼ˆé€‚ç”¨äºå±€éƒ¨å˜é‡ï¼Œç”¨åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ³¨æ„æ˜¯**:=è€Œä¸æ˜¯=ï¼Œå·¦éƒ¨å˜é‡å¿…é¡»æœªå®šä¹‰ï¼Œå¦åˆ™ä¼šäº§ç”Ÿç¼–è¯‘é”™è¯¯**ï¼‰ï¼Œ**å±€éƒ¨å˜é‡ä¸å¯é‡å¤å£°æ˜ï¼Œå£°æ˜çš„å˜é‡æ²¡æœ‰ä½¿ç”¨ä¹Ÿä¼šç¼–è¯‘é”™è¯¯(importåŒ…å¦‚æœæ²¡æœ‰ç”¨åˆ°ä¹Ÿä¼šæŠ¥é”™ï¼Œä¸javaç»™ä¸ªè­¦å‘Šä¸åŒ**ï¼Œå…¨å±€å˜é‡å¯ä»¥å£°æ˜ä½†ä¸ä½¿ç”¨ï¼Œæˆ–ä»¥&lt;code>var å˜é‡å type = å˜é‡å€¼&lt;/code>ï¼ˆvar å˜é‡å = å˜é‡å€¼ï¼Œè‡ªåŠ¨è¯†åˆ«ï¼‰çš„å½¢å¼èµ‹å€¼ï¼ˆé€‚ç”¨äºå…¨å±€å˜é‡ï¼Œç”¨åœ¨æš‚æ—¶ä¸éœ€è¦åˆå§‹åŒ–åªéœ€è¦å£°æ˜çš„æ—¶å€™ï¼Œ**goä¹Ÿä¼šç»™æœªè¿›è¡Œåˆå§‹åŒ–çš„å˜é‡èµ‹å€¼**ï¼‰ã€‚&lt;/li>
&lt;li>åœ¨åŒä¸€è¡ŒåŒæ—¶èµ‹å€¼ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®é¡ºåºå°†å³è¾¹çš„å€¼ä¾æ¬¡èµ‹äºˆç»™å·¦è¾¹çš„å˜é‡ï¼Œe.gï¼š&lt;/li>
&lt;/ul>
&lt;p>a,b,c := 1,2,&amp;ldquo;hello&amp;rdquo;ï¼Œä¹Ÿé€‚ç”¨äºä¸€ä¸ªå‡½æ•°æœ‰å¤šä¸ªè¿”å›å€¼æ—¶&lt;/p>
&lt;ul>
&lt;li>
&lt;p>äº¤æ¢å€¼a,b=b,a&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>åŒ¿åå˜é‡&lt;/strong>çš„ç‰¹ç‚¹æ˜¯ä¸€ä¸ªä¸‹ç”»çº¿â€œ_â€ï¼Œæœ¬èº«å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ ‡è¯†ç¬¦ï¼Œè¢«ç§°ä¸ºç©ºç™½æ ‡è¯†ç¬¦ã€‚å®ƒå¯ä»¥åƒå…¶ä»–æ ‡è¯†ç¬¦é‚£æ ·ç”¨äºå˜é‡çš„å£°æ˜æˆ–èµ‹å€¼ï¼ˆä»»ä½•ç±»å‹éƒ½å¯ä»¥èµ‹å€¼ç»™å®ƒï¼‰ï¼Œä½†ä»»ä½•èµ‹ç»™è¿™ä¸ªæ ‡è¯†ç¬¦çš„å€¼éƒ½å°†è¢«æŠ›å¼ƒï¼Œå› æ­¤è¿™äº›å€¼ä¸èƒ½åœ¨åç»­çš„ä»£ç ä¸­ä½¿ç”¨ï¼Œä¹Ÿä¸å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ ‡è¯†ç¬¦ä½œä¸ºå˜é‡å¯¹å…¶å®ƒå˜é‡è¿›è¡Œèµ‹å€¼æˆ–è¿ç®—ã€‚e.g:&lt;/p>
&lt;p>&lt;code>a, _ := GetData()&lt;/code>å½“å‡½æ•°æœ‰å¤šä¸ªè¿”å›å€¼ä½†æ˜¯æš‚æ—¶ä¸éœ€è¦èµ‹ç»™è¿™ä¹ˆå¤šå˜é‡æ—¶ï¼Œç”¨â€œ_&amp;ldquo;åæ‰è¿”å›çš„å€¼&lt;/p>
&lt;/li>
&lt;li>
&lt;p>goä¸­ä½¿ç”¨==æˆ–è€…!=ç­‰è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œä¸¤è¾¹çš„å˜é‡ç±»å‹å¿…é¡»ç›¸åŒï¼Œä¸ç›¸åŒå¿…é¡»è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ˆ&lt;strong>æ³¨æ„boolæ— æ³•ä¸å…¶ä»–ç±»å‹å¼ºè½¬&lt;/strong>ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŒå¼•å·å£°æ˜å­—ç¬¦ä¸²å­—é¢é‡ä¸èƒ½è·¨è¡Œï¼Œéœ€è¦ç”¨åå¼•å·`ï¼Œå¤šè¡Œå­—ç¬¦ä¸²ä¸€èˆ¬ç”¨äºå†…åµŒæºç å’Œå†…åµŒæ•°æ®ç­‰ï¼ˆæ¢è¡Œä¼šè¢«ä¿ç•™ï¼Œä½†æ˜¯æ— æ³•ç”¨è½¬ä¹‰ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>runeç±»å‹ä»£è¡¨ä¸€ä¸ªutf-8å­—ç¬¦&lt;/strong>ï¼Œå®ƒåŒç­‰äºint32ï¼Œbyteå¯è¡¨ç¤ºä¸€ä¸ªASCIIå­—ç¬¦ï¼Œå®ƒåŒç­‰äºuint8&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç±»å‹è½¬æ¢ï¼šgoä¸èƒ½éšèº«è½¬æ¢ï¼Œéœ€è¦å£°æ˜ç±»å‹è½¬æ¢ï¼ŒvalueOfTypeB = typeB(valueOfTypeA)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>iotaï¼ˆå¤šç”¨äºæšä¸¾ï¼Œå¤šå¸¸é‡å£°æ˜å½¢å¼ï¼Œå¦‚ä»¥ä¸‹ä»£ç ï¼Œæ¯æ˜¾å¼å£°æ˜ä¸€ä¸ªconstï¼ˆæˆ–ç»„ï¼‰ ï¼Œiotaéƒ½ä¼šåˆå§‹åŒ–ä¸º0ï¼Œconstç»„ä¸­æ¯å¢åŠ ä¸€è¡Œï¼Œiotaå°±åŠ 1ï¼š&lt;/p>
&lt;pre>&lt;code>const (
Sunday = iota ï¼ˆSunday=0ï¼‰
Monday ï¼ˆå¦‚æœconstä¸­æ²¡æœ‰æ˜¾å¼èµ‹å€¼ï¼Œåˆ™èµ‹å€¼ä¸ºå‰ä¸€è¡Œçš„å€¼ï¼Œå³iotaï¼‰
Tuesday
Wednesday
Thursday
Friday
Saturday
)
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>ç±»å‹åˆ«åï¼štype TypeAlias = Type ï¼ˆTypeAliasä»ç„¶æ˜¯Typeå‹ï¼Œåªä¸è¿‡å–äº†åˆ«åï¼‰&lt;/p>
&lt;p>ç±»å‹å®šä¹‰ï¼š type TypeAlias Type ï¼ˆæ²¡æœ‰ç­‰å·ï¼Œç›¸å½“äºCè¯­è¨€ä¸­çš„typedefï¼ŒTypeAliasæ˜¯ä¸€ä¸ªæ–°ç±»å‹äº†ï¼‰ï¼Œè¿™ç§ç±»å‹å’ŒåŸæ¥çš„ç±»å‹æ˜¯ä¸ä¸€æ ·çš„é™æ€ç±»å‹ï¼Œéœ€è¦ä½¿ç”¨ç±»å‹è½¬æ¢&lt;/p>
&lt;p>ç±»å‹æ–­è¨€ï¼šå› ä¸ºæ¥å£å˜é‡çš„åŠ¨æ€ç±»å‹æ˜¯å˜åŒ–çš„ï¼Œæœ‰æ—¶æˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€ä¸ªæ¥å£å˜é‡çš„åŠ¨æ€ç±»å‹ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Œè¿™å°±éœ€è¦ä½¿ç”¨ç±»å‹æ–­è¨€ï¼Œæ–­è¨€å°±æ˜¯å¯¹æ¥å£å˜é‡çš„ç±»å‹è¿›è¡Œæ£€æŸ¥ï¼Œå…¶è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼šï¼ˆ&lt;strong>å¯ä»¥ç”¨äºinterface{}ç±»å‹å˜é‡è½¬æ¢ä¸ºå…¶ä»–ç±»å‹å˜é‡&lt;/strong>ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">value, ok := x.(T)
xè¡¨ç¤ºè¦æ–­è¨€çš„æ¥å£å˜é‡&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼›&lt;/span>
Tè¡¨ç¤ºè¦æ–­è¨€çš„ç›®æ ‡ç±»å‹&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼›&lt;/span>
valueè¡¨ç¤ºæ–­è¨€æˆåŠŸä¹‹åç›®æ ‡ç±»å‹å˜é‡&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼›&lt;/span>
okè¡¨ç¤ºæ–­è¨€çš„ç»“æœ&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼Œ&lt;/span>æ˜¯ä¸€ä¸ªboolå‹å˜é‡&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼Œ&lt;/span>trueè¡¨ç¤ºæ–­è¨€æˆåŠŸ&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼Œ&lt;/span>falseè¡¨ç¤ºå¤±è´¥&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼Œ&lt;/span>å¦‚æœå¤±è´¥valueçš„å€¼ä¸ºnil&lt;span style="color:#a61717;background-color:#e3d2d2">ã€‚&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>æŒ‡é’ˆä¸èƒ½è¿›è¡Œåç§»å’Œè¿ç®—&lt;/strong>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å‡½æ•°å˜é‡ï¼šç±»å‹ä¸ºfunc([å‚æ•°ç±»å‹] [,å‚æ•°ç±»å‹â€¦â€¦])[è¿”å›ç±»å‹]&lt;/p>
&lt;p>å‡½æ•°å˜é‡å¸¸å¸¸ç”¨äºæ­é…åŒ¿åå‡½æ•°æ¥æ”¶å›è°ƒå‡½æ•°ï¼Œ&lt;strong>ä½¿ç”¨äº†å›è°ƒå‡½æ•°ï¼Œå¯ä»¥å¢åŠ çµæ´»æ€§ï¼ˆå…·ä½“å‡½æ•°ç”±è°ƒç”¨ä¸»ä½“å®ç°ï¼Œè¢«è°ƒç”¨è€…åªç”¨å‡½æ•°å˜é‡æ¥æ¥æ”¶å‚æ•°ï¼‰&lt;/strong>&lt;/p>
&lt;p>e.g:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#228b22">// éå†åˆ‡ç‰‡çš„æ¯ä¸ªå…ƒç´ , é€šè¿‡ç»™å®šå‡½æ•°è¿›è¡Œå…ƒç´ è®¿é—®
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">func&lt;/span> &lt;span style="color:#008b45">visit&lt;/span>(list []&lt;span style="color:#00688b;font-weight:bold">int&lt;/span>, f &lt;span style="color:#8b008b;font-weight:bold">func&lt;/span>(&lt;span style="color:#00688b;font-weight:bold">int&lt;/span>)) {
&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> _, v := &lt;span style="color:#8b008b;font-weight:bold">range&lt;/span> list {
&lt;span style="color:#008b45">f&lt;/span>(v)
}
}
&lt;span style="color:#8b008b;font-weight:bold">func&lt;/span> &lt;span style="color:#008b45">main&lt;/span>() {
&lt;span style="color:#228b22">// ä½¿ç”¨åŒ¿åå‡½æ•°æ‰“å°åˆ‡ç‰‡å†…å®¹
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#008b45">visit&lt;/span>([]&lt;span style="color:#00688b;font-weight:bold">int&lt;/span>{&lt;span style="color:#b452cd">1&lt;/span>, &lt;span style="color:#b452cd">2&lt;/span>, &lt;span style="color:#b452cd">3&lt;/span>, &lt;span style="color:#b452cd">4&lt;/span>}, &lt;span style="color:#8b008b;font-weight:bold">func&lt;/span>(v &lt;span style="color:#00688b;font-weight:bold">int&lt;/span>) {
fmt.&lt;span style="color:#008b45">Println&lt;/span>(v)
})
}
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>interface{}ç©ºæ¥å£ç±»å‹èƒ½å¤Ÿæ¥å—ä»»æ„ç±»å‹å˜é‡ï¼Œå› ä¸ºinterface{}ä¸åŒ…å«ä»»ä½•å‡½æ•°ï¼Œæ‰€ä»¥ä»»ä½•ç±»å‹éƒ½å®ç°äº†ç©ºæ¥å£ï¼Œinterfaceçš„åº•å±‚å®é™…ä¸Šæ˜¯efaceç»“æ„ä½“&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span> eface &lt;span style="color:#8b008b;font-weight:bold">struct&lt;/span>{
_type *_type
data unsafe.Pointer
}
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h2 id="é¡¹ç›®ç›®å½•è¯´æ˜">é¡¹ç›®ç›®å½•è¯´æ˜&lt;/h2>
&lt;blockquote>
&lt;p>srcï¼šç”¨äºä»¥åŒ…ï¼ˆpackageï¼‰çš„å½¢å¼ç»„ç»‡å¹¶å­˜æ”¾ Go æºæ–‡ä»¶ï¼Œè¿™é‡Œçš„åŒ…ä¸ src ä¸‹çš„æ¯ä¸ªå­ç›®å½•æ˜¯ä¸€ä¸€å¯¹åº”ã€‚ä¾‹å¦‚ï¼Œè‹¥ä¸€ä¸ªæºæ–‡ä»¶è¢«å£°æ˜å±äº log åŒ…ï¼Œé‚£ä¹ˆå®ƒå°±åº”å½“ä¿å­˜åœ¨ src/log ç›®å½•ä¸­ã€‚&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>åŒä¸€ä¸ªç›®å½•ä¸‹æ‰€æœ‰çš„goæ–‡ä»¶åªèƒ½æœ‰ä¸€ä¸ªåŒ…åï¼ˆpackageç›¸åŒï¼‰,&lt;strong>ä½†æ˜¯åŒ…åå¯ä»¥ä¸ç›®å½•åä¸åŒï¼ˆæœ€å¥½æ˜¯å»ºè®®ç›¸åŒï¼‰&lt;/strong>&lt;/li>
&lt;li>main åŒ…æ˜¯Goè¯­è¨€ç¨‹åºçš„å…¥å£åŒ…ï¼Œmainå‡½æ•°æ˜¯å…¥å£å‡½æ•°ï¼Œåªæœ‰package mainçš„goæ–‡ä»¶èƒ½åŒ…å«mainå‡½æ•°ï¼ˆ&lt;strong>æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª&lt;/strong>ï¼‰ï¼Œä¸€ä¸ªGoè¯­è¨€ç¨‹åºå¿…é¡»&lt;strong>æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª&lt;/strong> main åŒ…ã€‚å¦‚æœä¸€ä¸ªç¨‹åºæ²¡æœ‰ main åŒ…ï¼Œé‚£ä¹ˆç¼–è¯‘æ—¶å°†ä¼šå‡ºé”™ï¼Œæ— æ³•ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶&lt;/li>
&lt;li>&lt;strong>ä½¿ç”¨å¤§å°å†™æ¥å†³å®šå¸¸é‡ï¼Œå˜é‡ï¼Œå‡½æ•°ç­‰æ˜¯å¦å¯ä»¥è¢«å¤–éƒ¨åŒ…æ‰€ä½¿ç”¨ï¼Œé¦–å­—æ¯å¤§å†™å°±ç›¸å½“äºpublicï¼Œé¦–å­—æ¯å°å†™å°±ç›¸å½“äºprivate&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h2 id="æ¡ä»¶å¾ªç¯è¯­å¥">æ¡ä»¶ï¼Œå¾ªç¯è¯­å¥&lt;/h2>
&lt;p>&lt;strong>if è¯­å¥ä½¿ç”¨ tips&lt;/strong>&lt;/p>
&lt;p>&lt;strong>ï¼ˆ1ï¼‰&lt;/strong> ä¸éœ€ä½¿ç”¨æ‹¬å·å°†æ¡ä»¶åŒ…å«èµ·æ¥&lt;/p>
&lt;p>&lt;strong>ï¼ˆ2ï¼‰&lt;/strong> &lt;strong>å¤§æ‹¬å·{}å¿…é¡»å­˜åœ¨ï¼Œå³ä½¿åªæœ‰ä¸€è¡Œè¯­å¥&lt;/strong>&lt;/p>
&lt;p>&lt;strong>ï¼ˆ3ï¼‰&lt;/strong> &lt;strong>å·¦æ‹¬å·å¿…é¡»åœ¨ifæˆ–elseçš„åŒä¸€è¡Œï¼Œifçš„å³æ‹¬å·è¦ä¸elseåŒä¸€è¡Œï¼ˆæˆ–è€…æœ‰å¤šä¸ªelse ifçš„è¯ï¼‰&lt;/strong>&lt;/p>
&lt;p>&lt;strong>ï¼ˆ4ï¼‰&lt;/strong> &lt;strong>åœ¨ifä¹‹åï¼Œæ¡ä»¶è¯­å¥ä¹‹å‰ï¼Œå¯ä»¥æ·»åŠ å˜é‡åˆå§‹åŒ–è¯­å¥ï¼Œä½¿ç”¨ï¼›è¿›è¡Œåˆ†éš”&lt;/strong>&lt;/p>
&lt;p>&lt;strong>ï¼ˆ5ï¼‰&lt;/strong> åœ¨æœ‰è¿”å›å€¼çš„å‡½æ•°ä¸­ï¼Œæœ€ç»ˆçš„returnä¸èƒ½åœ¨æ¡ä»¶è¯­å¥ä¸­&lt;/p>
&lt;p>&lt;strong>for&lt;/strong>&lt;/p>
&lt;p>&lt;strong>ï¼ˆ1ï¼‰&lt;/strong> ä¸éœ€è¦ä½¿ç”¨æ‹¬å·&lt;/p>
&lt;p>&lt;strong>ï¼ˆ2ï¼‰&lt;/strong> æ²¡æœ‰whileè¯­å¥ï¼Œfor condition {}ç›¸å½“äºwhileï¼Œfor{}ç›¸å½“äºwhile(1)&lt;/p>
&lt;p>&lt;strong>switch&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#8b008b;font-weight:bold">var&lt;/span> a = &lt;span style="color:#cd5555">&amp;#34;hello&amp;#34;&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">switch&lt;/span> a {
&lt;span style="color:#8b008b;font-weight:bold">case&lt;/span> &lt;span style="color:#cd5555">&amp;#34;hello&amp;#34;&lt;/span>,&lt;span style="color:#cd5555">&amp;#34;cello&amp;#34;&lt;/span>:
fmt.&lt;span style="color:#008b45">Println&lt;/span>(&lt;span style="color:#b452cd">1&lt;/span>)
&lt;span style="color:#8b008b;font-weight:bold">case&lt;/span> &lt;span style="color:#cd5555">&amp;#34;world&amp;#34;&lt;/span>:
fmt.&lt;span style="color:#008b45">Println&lt;/span>(&lt;span style="color:#b452cd">2&lt;/span>)
&lt;span style="color:#8b008b;font-weight:bold">default&lt;/span>:
fmt.&lt;span style="color:#008b45">Println&lt;/span>(&lt;span style="color:#b452cd">0&lt;/span>)
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ï¼ˆ1ï¼‰&lt;strong>caseä¸caseæ˜¯ç‹¬ç«‹çš„ä»£ç å—ï¼Œä¸éœ€è¦break&lt;/strong>&lt;/p>
&lt;p>ï¼ˆ2ï¼‰caseçš„åˆ¤æ–­å¯ä»¥æ˜¯è¡¨è¾¾å¼ä¹Ÿå¯ä»¥å¤šå€¼ï¼Œå¦‚ä¸Šæ‰€ç¤º&lt;/p>
&lt;p>&lt;strong>type-switch&lt;/strong>&lt;/p>
&lt;p>ç”¨æ¥åˆ¤æ–­æ¥å£å˜é‡çš„ç±»å‹&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#8b008b;font-weight:bold">switch&lt;/span> æ¥å£å˜é‡.(&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span>) {
&lt;span style="color:#8b008b;font-weight:bold">case&lt;/span> ç±»å‹1:
&lt;span style="color:#228b22">// å˜é‡æ˜¯ç±»å‹1æ—¶çš„å¤„ç†
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">case&lt;/span> ç±»å‹2:
&lt;span style="color:#228b22">// å˜é‡æ˜¯ç±»å‹2æ—¶çš„å¤„ç†
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#a61717;background-color:#e3d2d2">â€¦&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">default&lt;/span>:
&lt;span style="color:#228b22">// å˜é‡ä¸æ˜¯æ‰€æœ‰caseä¸­åˆ—ä¸¾çš„ç±»å‹æ—¶çš„å¤„ç†
&lt;/span>&lt;span style="color:#228b22">&lt;/span>}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ˜¯æŸä¸ªcaseçš„ç±»å‹å°±åŒ¹é…ï¼Œå¦åˆ™åŒ¹é…default&lt;/p>
&lt;p>&lt;strong>select&lt;/strong>&lt;/p>
&lt;p>ç»“æ„ç±»ä¼¼switchï¼Œä½†æ˜¯å¦‚æœæœ‰å¤šä¸ªcaseåŒ¹é…ï¼Œswitchæ˜¯é¡ºåºæ‰§è¡Œï¼Œselectæ˜¯éšæœºæ‰§è¡Œï¼Œ&lt;strong>åªèƒ½ç”¨äºé€šé“çš„è¯»å†™&lt;/strong>&lt;/p>
&lt;p>&lt;strong>breakå’Œcontinue&lt;/strong>&lt;/p>
&lt;p>goä¸­çš„breakæœ‰ä¸€é¡¹åŠŸèƒ½ï¼Œå°±æ˜¯å¯ä»¥è·³åˆ°æŒ‡å®šæ ‡ç­¾çš„å¾ªç¯ï¼Œä¾‹å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">OuterLoop:&lt;span style="color:#228b22">//æˆ‘è¿™é‡Œç»™æœ€å¤–å±‚å¾ªç¯æ‰“ä¸Šäº†OuterLoopçš„æ ‡ç­¾
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> i := &lt;span style="color:#b452cd">0&lt;/span>; i &amp;lt; &lt;span style="color:#b452cd">2&lt;/span>; i++ {
&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> j := &lt;span style="color:#b452cd">0&lt;/span>; j &amp;lt; &lt;span style="color:#b452cd">5&lt;/span>; j++ {
&lt;span style="color:#8b008b;font-weight:bold">switch&lt;/span> j {
&lt;span style="color:#8b008b;font-weight:bold">case&lt;/span> &lt;span style="color:#b452cd">2&lt;/span>:
fmt.&lt;span style="color:#008b45">Println&lt;/span>(i, j)
&lt;span style="color:#8b008b;font-weight:bold">break&lt;/span> OuterLoop&lt;span style="color:#228b22">//è¿™é‡Œå°±ä¸æ˜¯è·³å‡ºå†…å±‚å¾ªç¯äº†ï¼Œè€Œæ˜¯ç›´æ¥è·³å‡ºæœ€å¤–å±‚å¾ªç¯
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">case&lt;/span> &lt;span style="color:#b452cd">3&lt;/span>:
fmt.&lt;span style="color:#008b45">Println&lt;/span>(i, j)
&lt;span style="color:#8b008b;font-weight:bold">break&lt;/span> OuterLoop
}
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>continueåŒç†ï¼Œè·³åˆ°æŒ‡å®šæ ‡ç­¾å¾ªç¯çš„ä¸‹ä¸€æ¬¡å¾ªç¯&lt;/p>
&lt;h2 id="å‡½æ•°">å‡½æ•°&lt;/h2>
&lt;pre>&lt;code>func function_name( [parameter list] ) [return_types] {
å‡½æ•°ä½“
}
&lt;/code>&lt;/pre>&lt;p>å‡½æ•°å¯ä»¥è¿”å›å¤šå€¼&lt;/p>
&lt;ul>
&lt;li>æœªå®šä¹‰é•¿åº¦çš„æ•°ç»„åªèƒ½ä¼ ç»™ä¸é™åˆ¶æ•°ç»„é•¿åº¦çš„å‡½æ•°ï¼Œå®šä¹‰äº†é•¿åº¦çš„æ•°ç»„åªèƒ½ä¼ ç»™é™åˆ¶äº†ç›¸åŒæ•°ç»„é•¿åº¦çš„å‡½æ•°&lt;/li>
&lt;/ul>
&lt;p>åŒ¿åå‡½æ•°&lt;/p>
&lt;ul>
&lt;li>åŒ¿åå‡½æ•°å°±æ˜¯æ²¡æœ‰å®šä¹‰å‡½æ•°åçš„å‡½æ•°ï¼Œå¯ä»¥ä¼ ç»™å‡½æ•°å˜é‡&lt;/li>
&lt;/ul>
&lt;p>é—­åŒ…(closure)&lt;/p>
&lt;ul>
&lt;li>é—­åŒ…é€šå¸¸æ˜¯å‡½æ•°å†…éƒ¨çš„åŒ¿åå‡½æ•°ï¼Œåœ¨åŒ¿åå‡½æ•°ä¸­ç›´æ¥ä½¿ç”¨æ­¤å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œè¯¥å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¼šä¸€ç›´è·Ÿéšç€è¿™ä¸ªåŒ¿åå‡½æ•°&lt;/li>
&lt;/ul>
&lt;p>deferï¼ˆå»¶è¿Ÿæ‰§è¡Œè¯­å¥ï¼‰&lt;/p>
&lt;ul>
&lt;li>å»¶è¿Ÿè°ƒç”¨å‡½æ•°æ˜¯&lt;strong>åœ¨ defer æ‰€åœ¨å‡½æ•°ç»“æŸå‰è¿›è¡Œï¼Œreturnåè¿›è¡Œ&lt;/strong>ã€‚å¸¸ä½¿ç”¨åœ¨é‡Šæ”¾èµ„æºæ—¶ï¼Œæ¯”å¦‚å…³é—­æ–‡ä»¶ï¼Œè§£é”ç­‰ç­‰ã€‚å¦‚æœæœ‰å¤šä¸ªdeferï¼Œä¾æ¬¡é€†åºè°ƒç”¨&lt;/li>
&lt;/ul>
&lt;p>æ¥å£å‹å‡½æ•°&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ¥å£å‹å‡½æ•°åœ¨å¤§é‡å¼€æºgoé¡¹ç›®ä¸­ä½¿ç”¨åˆ°ï¼Œå‚è€ƒï¼šhttps://geektutu.com/post/7days-golang-q1.htmlï¼Œç®€å•å°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ¥å£&lt;strong>åªæœ‰ä¸€ä¸ªæ–¹æ³•&lt;/strong>ï¼Œè€Œå®šä¹‰ä¸€ä¸ªå‡½æ•°å®ç°è¿™ä¸ªæ¥å£ï¼ˆ&lt;strong>å‚æ•°ç±»å‹éƒ½è¦å’Œæ¥å£ä¸­çš„æ–¹æ³•çš„å‚æ•°ç±»å‹ç›¸åŒ&lt;/strong>ï¼Œç„¶åå®ç°æ—¶è°ƒç”¨è‡ªå·±ï¼‰ã€‚è¿™æ ·ï¼Œå°±å¯ä»¥æ‹¿æ¥å£ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œæ—¢å¯ä»¥ä¼ å…¥å®ç°äº†æ¥å£çš„ç»“æ„ä½“ï¼ˆç»“æ„ä½“å¯ä»¥å¢åŠ è‡ªå·±çš„æ–¹æ³•æ‰©å……æ¥å£çš„åŠŸèƒ½ï¼‰ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥æ¥å£å‹å‡½æ•°ï¼ˆéœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼‰ï¼Œè€Œä¸å•å•åªæ˜¯åŸæ¥å®šä¹‰äº†ä¸€ä¸ªå›è°ƒå‡½æ•°å‚æ•°è®©ç”¨æˆ·å®ç°ã€‚e.g:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#228b22">// A Getter loads data for a key.
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span> Getter &lt;span style="color:#8b008b;font-weight:bold">interface&lt;/span> {
&lt;span style="color:#008b45">Get&lt;/span>(key &lt;span style="color:#00688b;font-weight:bold">string&lt;/span>) ([]&lt;span style="color:#00688b;font-weight:bold">byte&lt;/span>, &lt;span style="color:#00688b;font-weight:bold">error&lt;/span>)
}
&lt;span style="color:#228b22">// A GetterFunc implements Getter with a function.
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span> GetterFunc &lt;span style="color:#8b008b;font-weight:bold">func&lt;/span>(key &lt;span style="color:#00688b;font-weight:bold">string&lt;/span>) ([]&lt;span style="color:#00688b;font-weight:bold">byte&lt;/span>, &lt;span style="color:#00688b;font-weight:bold">error&lt;/span>)
&lt;span style="color:#228b22">// Get implements Getter interface function
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">func&lt;/span> (f GetterFunc) &lt;span style="color:#008b45">Get&lt;/span>(key &lt;span style="color:#00688b;font-weight:bold">string&lt;/span>) ([]&lt;span style="color:#00688b;font-weight:bold">byte&lt;/span>, &lt;span style="color:#00688b;font-weight:bold">error&lt;/span>) {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#008b45">f&lt;/span>(key)
}
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h2 id="æ•°ç»„å’Œåˆ‡ç‰‡">æ•°ç»„å’Œåˆ‡ç‰‡&lt;/h2>
&lt;p>åˆ‡ç‰‡å°±æ˜¯åŠ¨æ€æ•°ç»„ï¼Œå¯ä»¥åŠ¨æ€æ‰©å±•å®¹é‡ï¼Œæ— éœ€æŒ‡å®šå¤§å°ï¼Œå®ƒæœ‰ä¸‰ä¸ªå…ƒç´ ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘åˆ‡ç‰‡çš„å¼€å§‹ä½ç½®&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Lenï¼Œåˆ‡ç‰‡çš„å®é™…é•¿åº¦&lt;/p>
&lt;/li>
&lt;li>
&lt;p>capï¼Œæœ€å¤§é•¿åº¦ï¼Œé¢„åˆ†é…å†…å­˜å¤§å°&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>åˆ‡ç‰‡å¦‚æœæ”¹å˜å…ƒç´ æ˜¯ä¼šå¯¹æ‰€æœ‰å¼•ç”¨åŠåŸæ•°ç»„æ”¹å˜çš„ï¼Œå› ä¸ºä»–å®é™…æ˜¯ä¸€ä¸ªæŒ‡é’ˆ&lt;/strong>&lt;/p>
&lt;p>æ•°ç»„åˆå§‹åŒ–æ–¹æ³•ï¼Œä¾‹ï¼š arr := [3]int{3,4,5}ï¼ˆ&lt;strong>æ•°ç»„å¤§å°å¿…é¡»å›ºå®š&lt;/strong>ï¼‰ï¼Œ[&amp;hellip;]typeå¯ä»¥æ ¹æ®åˆå§‹åŒ–çš„ä¸ªæ•°æ¥åˆ¤æ–­å¤§å°&lt;/p>
&lt;p>åˆ‡ç‰‡åˆå§‹åŒ–æ–¹æ³•ï¼Œä¾‹ï¼šarr := []int{3,4,5}ï¼ˆæ²¡æŒ‡å®šå¤§å°ï¼‰&lt;/p>
&lt;h3 id="æ•°ç»„ä¸­å–å…ƒç´ ç»™åˆ‡ç‰‡æˆ–åˆ‡ç‰‡å…ƒç´ ç»™å…¶ä»–åˆ‡ç‰‡">æ•°ç»„ä¸­å–å…ƒç´ ç»™åˆ‡ç‰‡(æˆ–åˆ‡ç‰‡å…ƒç´ ç»™å…¶ä»–åˆ‡ç‰‡)&lt;/h3>
&lt;p>æ¯”å¦‚æœ‰ä¸€ä¸ªæ•°ç»„aï¼Œä»–æ˜¯[n]intå‹æ•°ç»„&lt;/p>
&lt;p>a[x:y]è¡¨ç¤ºï¼šä»a[x]å–èµ·åˆ°a[y-1]ï¼Œxä¸ºå¼€å§‹ç´¢å¼•ï¼Œyä¸ºç»“æŸç´¢å¼•ï¼ˆå–åˆ°y-1ï¼‰&lt;/p>
&lt;p>ä¸å¡«xå’Œyï¼Œé»˜è®¤ç¬¬ä¸€ä¸ªä¸º0ï¼Œç¬¬äºŒä¸ªä¸ºn&lt;/p>
&lt;ul>
&lt;li>a[:]ï¼ŒåŒç­‰a[0:n]ï¼Œå³è·å–aä¸­æ‰€æœ‰å…ƒç´ &lt;/li>
&lt;li>a[x:]ä»a&lt;input checked="" disabled="" type="checkbox"> å–èµ·åˆ°a[n]&lt;/li>
&lt;li>a[:y]ä»a[0]å¼€å§‹å–å…¶åˆ°a[y-1]&lt;/li>
&lt;li>a[0:0]åˆ‡ç‰‡æ¸…ç©º&lt;/li>
&lt;/ul>
&lt;h3 id="åˆ›å»ºåˆ‡ç‰‡çš„æ–¹æ³•">åˆ›å»ºåˆ‡ç‰‡çš„æ–¹æ³•&lt;/h3>
&lt;p>&lt;strong>åˆ›å»ºæ–°åˆ‡ç‰‡&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>æ™®é€šæ–¹æ³•åˆ›å»ºï¼š&lt;/p>
&lt;p>&lt;code>var arr []int&lt;/code>ï¼Œåˆ‡ç‰‡ä¸ºnilï¼Œæ— å…ƒç´ &lt;/p>
&lt;/li>
&lt;li>
&lt;p>makeå‡½æ•°åˆ›å»ºï¼ˆåˆå§‹åŒ–åˆ‡ç‰‡å…ƒç´ åˆ°lençš„å…ƒç´ ä¸º0ï¼‰ï¼š&lt;/p>
&lt;p>&lt;code>slice1 := make([]type, len,[cap])&lt;/code>ï¼Œå®¹é‡capå¯é™å®šä¹Ÿå¯æ— é™æ‰©å±•ï¼Œcapè¡¨ç¤ºé¢„åˆ†é…å†…å­˜å¤§å°ï¼Œé™ä½å¤šæ¬¡åˆ†é…ç©ºé—´é€ æˆçš„å½±å“&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>å¼•ç”¨åŸæ•°ç»„æˆ–åŸåˆ‡ç‰‡çš„ä¸€éƒ¨åˆ†&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>å¼•ç”¨å¦ä¸€ä¸ªæ•°ç»„çš„ä¸€éƒ¨åˆ†ï¼š&lt;/p>
&lt;p>s := arr[start:end],å³å¼•ç”¨åŸæ•°ç»„æˆ–åŸåˆ‡ç‰‡startåˆ°end-1çš„å…ƒç´ &lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="åˆ‡ç‰‡ä¸­è¿½åŠ å…ƒç´ ">åˆ‡ç‰‡ä¸­è¿½åŠ å…ƒç´ &lt;/h3>
&lt;p>åˆ‡ç‰‡è¿½åŠ å…ƒç´ ç”¨append(åˆ‡ç‰‡åï¼Œå…ƒç´ )ï¼Œå¦‚æœè¶…è¿‡capï¼Œcapä¼šç¿»å€å¢åŠ &lt;/p>
&lt;p>&lt;strong>tips:&lt;/strong>(&amp;rdquo;&amp;hellip;&amp;ldquo;ä¸‰ä¸ªç‚¹è¡¨ç¤ºä»»æ„å‚æ•°)&lt;/p>
&lt;p>&lt;strong>ä½¿ç”¨ slice&amp;hellip;è¡¨ç¤ºsliceä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œæ–¹ä¾¿ç”¨äºappend&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">slice1=&lt;span style="color:#658b00">append&lt;/span>(slice1,slice2...) &lt;span style="color:#228b22">//slice2ä¸­çš„å…ƒç´ ä¸€ä¸ªä¸ªè¿½åŠ å…¥slice1ä¸­ï¼Œè¿™æ ·ä¸ç”¨ä¸€ä¸ªä¸ªå†™å‡ºæ¥äº†
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="åˆ‡ç‰‡å¤åˆ¶">åˆ‡ç‰‡å¤åˆ¶&lt;/h3>
&lt;p>&lt;code>copy( destSlice, srcSlice)&lt;/code>ï¼Œä»æºåˆ‡ç‰‡ï¼ˆå¯ä»¥æ˜¯éƒ¨åˆ†ï¼‰æ‹·è´åˆ°ç›®æ ‡åˆ‡ç‰‡&lt;/p>
&lt;h3 id="åˆ‡ç‰‡åˆ é™¤å…ƒç´ ">åˆ‡ç‰‡åˆ é™¤å…ƒç´ &lt;/h3>
&lt;ol>
&lt;li>ç›´æ¥ç§»åŠ¨å¤´æŒ‡é’ˆ&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">a = []&lt;span style="color:#00688b;font-weight:bold">int&lt;/span>{&lt;span style="color:#b452cd">1&lt;/span>, &lt;span style="color:#b452cd">2&lt;/span>, &lt;span style="color:#b452cd">3&lt;/span>}
a = a[&lt;span style="color:#b452cd">1&lt;/span>:] &lt;span style="color:#228b22">// åˆ é™¤å¼€å¤´1ä¸ªå…ƒç´ 
&lt;/span>&lt;span style="color:#228b22">&lt;/span>a = a[N:] &lt;span style="color:#228b22">// åˆ é™¤å¼€å¤´Nä¸ªå…ƒç´ 
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>åŸåœ°appendï¼ˆå…ƒç´ å‰ç§»æ³•ï¼‰&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">a = []&lt;span style="color:#00688b;font-weight:bold">int&lt;/span>{&lt;span style="color:#b452cd">1&lt;/span>, &lt;span style="color:#b452cd">2&lt;/span>, &lt;span style="color:#b452cd">3&lt;/span>}
a = &lt;span style="color:#658b00">append&lt;/span>(a[:&lt;span style="color:#b452cd">0&lt;/span>], a[&lt;span style="color:#b452cd">1&lt;/span>:]...) &lt;span style="color:#228b22">// åˆ é™¤å¼€å¤´1ä¸ªå…ƒç´ ï¼ˆæŠŠç¬¬1ä¸ªæˆªæ‰ï¼Œåé¢å…ƒç´ è¿½åŠ ä¸Šæ¥ï¼‰
&lt;/span>&lt;span style="color:#228b22">&lt;/span>a = &lt;span style="color:#658b00">append&lt;/span>(a[:&lt;span style="color:#b452cd">0&lt;/span>], a[N:]...) &lt;span style="color:#228b22">// åˆ é™¤å¼€å¤´Nä¸ªå…ƒç´ 
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
a = &lt;span style="color:#658b00">append&lt;/span>(a[:i], a[i+&lt;span style="color:#b452cd">1&lt;/span>:]...) &lt;span style="color:#228b22">// åˆ é™¤ä¸­é—´1ä¸ªå…ƒç´ ï¼ˆæˆªåˆ°ä¸­é—´é‚£ä¸ªå…ƒç´ å‰ï¼Œç„¶åæŠŠä¸­é—´åé¢çš„å…ƒç´ è¿½åŠ ä¸Šæ¥ï¼‰
&lt;/span>&lt;span style="color:#228b22">&lt;/span>a = &lt;span style="color:#658b00">append&lt;/span>(a[:i], a[i+N:]...) &lt;span style="color:#228b22">// åˆ é™¤ä¸­é—´Nä¸ªå…ƒç´ 
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="rangeå’Œfor-eachå¾ªç¯">rangeå’Œfor-eachå¾ªç¯&lt;/h2>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> key, value := &lt;span style="color:#8b008b;font-weight:bold">range&lt;/span> æ•°ç»„æˆ–åˆ‡ç‰‡æˆ–map {
ä»£ç å—
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨rangeå¯ä»¥æ­é…forå¾ªç¯éå†æ•°ç»„ã€åˆ‡ç‰‡ã€mapå’Œå­—ç¬¦ä¸²ç­‰ï¼Œä»¥key-valueçš„å½¢å¼è¿”å›ï¼ˆæ•°ç»„å’Œåˆ‡ç‰‡çš„keyæ˜¯ç´¢å¼•å€¼ï¼‰ï¼Œå¦‚æœä¸éœ€è¦keyæˆ–è€…valueå¯ä»¥ç”¨__å ä½ç¬¦æ›¿ä»£ã€‚ä½¿ç”¨rangeè¿˜å¯ä»¥æ­é…å¯å˜å‚æ•°ï¼Œe.g:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#8b008b;font-weight:bold">func&lt;/span> &lt;span style="color:#008b45">myfunc&lt;/span>(args ...&lt;span style="color:#00688b;font-weight:bold">int&lt;/span>) {
&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> _, arg := &lt;span style="color:#8b008b;font-weight:bold">range&lt;/span> args {
fmt.&lt;span style="color:#008b45">Println&lt;/span>(arg)
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯å˜å‚æ•°å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªåˆ‡ç‰‡ï¼Œå¹¶ä¸”å¯ä»¥ç”¨&lt;code>args...&lt;/code>ç»§ç»­ä¼ ç»™å…¶ä»–å‡½æ•°&lt;/p>
&lt;p>&lt;strong>tips:&lt;/strong>&lt;/p>
&lt;p>&lt;strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œvalueä¸ºå€¼çš„æ‹·è´ï¼Œæ‰€ä»¥åªå…·æœ‰å¯è¯»æ€§ï¼Œå¯¹è¿™ä¸ªvalueå€¼çš„æ”¹å˜ä¸ä¼šæ”¹å˜åŸæ¥é›†åˆä¸­çš„å€¼&lt;/strong>&lt;/p>
&lt;h2 id="map">Map&lt;/h2>
&lt;h3 id="åˆ›å»ºmap">åˆ›å»ºmap&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>&lt;code>var å˜é‡å map[key_type]value_type&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç”¨makeå‡½æ•°åˆ›å»ºï¼š&lt;/p>
&lt;p>&lt;code>å˜é‡å := make(map[key_type]value_type,[cap])&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>tips:&lt;/strong>&lt;/p>
&lt;p>&lt;strong>value_typeå¯ä»¥æ˜¯åˆ‡ç‰‡ï¼Œè¿™æ ·ä¸€ä¸ªkeyå°±å¯¹åº”å¤šä¸ªvalueå€¼äº†ï¼Œä¾‹å¦‚ï¼šçˆ¶è¿›ç¨‹çš„pidä½œä¸ºkeyï¼Œå¤šä¸ªå­è¿›ç¨‹çš„pidä½œä¸ºåˆ‡ç‰‡å…ƒç´ &lt;/strong>&lt;/p>
&lt;h3 id="mapä¸­è¿½åŠ å…ƒç´ ">mapä¸­è¿½åŠ å…ƒç´ &lt;/h3>
&lt;p>ç›´æ¥key-valueæ–¹æ³•èµ‹å€¼å³å¯&lt;/p>
&lt;h3 id="mapåˆ é™¤å…ƒç´ ">mapåˆ é™¤å…ƒç´ &lt;/h3>
&lt;p>&lt;code>delete(map,key)&lt;/code>&lt;/p>
&lt;h2 id="containerlist">container/list&lt;/h2>
&lt;p>å®ç°ä¸ºåŒå‘å¾ªç¯é“¾è¡¨&lt;/p>
&lt;p>listä¸ºelement+lenï¼ˆé“¾è¡¨é•¿åº¦ï¼Œä¸åŒ…æ‹¬å“¨å…µï¼‰ï¼Œelementæ‰æ˜¯å…·ä½“èŠ‚ç‚¹&lt;/p>
&lt;p>&lt;img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gob78fnrlkj315h0m4wht.jpg" alt="IMG_0055">&lt;/p>
&lt;h3 id="åˆ›å»ºé“¾è¡¨">åˆ›å»ºé“¾è¡¨&lt;/h3>
&lt;p>&lt;code>å˜é‡ := list.New()&lt;/code>ï¼ŒNew()è¿”å›ä¸€ä¸ª*listï¼Œé“¾è¡¨æ— èŠ‚ç‚¹ï¼Œåªæœ‰å“¨å…µï¼Œlenä¸º0&lt;/p>
&lt;h3 id="é“¾è¡¨ä¸­æ’å…¥å…ƒç´ ">é“¾è¡¨ä¸­æ’å…¥å…ƒç´ &lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">è¿™é‡Œheadä¸º*list&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼Œ&lt;/span>ä»£è¡¨é“¾è¡¨çš„å¤´
å°¾éƒ¨æ’å…¥&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼š&lt;/span>head.&lt;span style="color:#008b45">PushBack&lt;/span>(ä»»æ„ç±»å‹å…ƒç´ )
å‰éƒ¨æ’å…¥&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼š&lt;/span>head.&lt;span style="color:#008b45">PushFront&lt;/span>(ä»»æ„ç±»å‹å…ƒç´ )
PushBackå’ŒPushFrontéƒ½è¿”å›ä¸€ä¸ª*Element&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼Œ&lt;/span>ç”¨æ¥æ–¹ä¾¿åœ¨é“¾è¡¨ä¸­æ’å…¥èŠ‚ç‚¹
è¿™é‡Œç”¨markè¡¨ç¤ºPushBackæˆ–PushFrontè¿”å›çš„*Element
åœ¨markåæ’&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼š&lt;/span>head.&lt;span style="color:#008b45">InsertAfter&lt;/span>(ä»»æ„ç±»å‹å…ƒç´ ,mark)
åœ¨markå‰æ’&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼š&lt;/span>head.&lt;span style="color:#008b45">InsertBefore&lt;/span>(ä»»æ„ç±»å‹å…ƒç´ ,mark)
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="åˆ é™¤é“¾è¡¨å…ƒç´ ">åˆ é™¤é“¾è¡¨å…ƒç´ &lt;/h3>
&lt;p>&lt;code>head.Remove(mark)&lt;/code>&lt;/p>
&lt;h3 id="éå†é“¾è¡¨å…ƒç´ ">éå†é“¾è¡¨å…ƒç´ &lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> i := l.&lt;span style="color:#008b45">Front&lt;/span>(); i != &lt;span style="color:#8b008b;font-weight:bold">nil&lt;/span>; i = i.&lt;span style="color:#008b45">Next&lt;/span>() {
fmt.&lt;span style="color:#008b45">Println&lt;/span>(i.Value)
}
&lt;span style="color:#228b22">/*
&lt;/span>&lt;span style="color:#228b22">Front()è¡¨ç¤ºè·å–ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒBack()è¡¨æ˜¯è·å–æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼ŒNext()è¡¨ç¤ºä¸‹ä¸€èŠ‚ç‚¹,Valueè·å–èŠ‚ç‚¹å€¼
&lt;/span>&lt;span style="color:#228b22">*/&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æŒ‡é’ˆ">æŒ‡é’ˆ&lt;/h2>
&lt;p>æŒ‡é’ˆçš„ç”¨æ³•ä¸cè¯­è¨€ç›¸åŒ&lt;/p>
&lt;p>ä¹Ÿå¯ä»¥ç”¨ new()å‡½æ•°æ¥åˆ›å»ºæŒ‡é’ˆï¼Œä¾‹ï¼švar_name := new(type)ï¼Œè¿™æ ·var_nameä¿å­˜çš„æ˜¯typeç±»å‹å˜é‡çš„é¦–åœ°å€&lt;/p>
&lt;h2 id="ç»“æ„ä½“">ç»“æ„ä½“&lt;/h2>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span> ç±»å‹å &lt;span style="color:#8b008b;font-weight:bold">struct&lt;/span> {
å­—æ®µ1 å­—æ®µ1ç±»å‹
å­—æ®µ2 å­—æ®µ2ç±»å‹
&lt;span style="color:#a61717;background-color:#e3d2d2">â€¦&lt;/span>
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>tips:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç»“æ„ä½“ä¸­çš„å­—æ®µå¯ä»¥å†…åµŒå…¶ä»–ç»“æ„ä½“ï¼Œè¢«å†…åµŒçš„ç»“æ„ä½“ä¸­çš„å­—æ®µå¯ä»¥ç›´æ¥å¼•ç”¨ï¼Œè€Œä¸ç”¨å¤šå±‚å¼•ç”¨ï¼ˆæœ‰ç‚¹åƒç»§æ‰¿ï¼‰ï¼Œe.g:&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>a.b.c.då¯ä»¥ç›´æ¥ç”¨a.d&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>goä¸­æŒ‡é’ˆç»“æ„ä½“ä¸­çš„å­—æ®µå¯ä»¥ç›´æ¥å¼•ç”¨ï¼ˆç”¨äº†è¯­æ³•ç³–ï¼‰ï¼Œè€Œä¸ç”¨åƒCä¸­ä¸€æ ·ç”¨-&amp;gt;&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h3 id="ç»“æ„ä½“å®ä¾‹åŒ–æ–¹å¼">ç»“æ„ä½“å®ä¾‹åŒ–æ–¹å¼&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>ä»¥åˆ›å»ºæŒ‡é’ˆçš„æ–¹å¼&lt;/p>
&lt;p>&lt;code>ins := new(T)&lt;/code>&lt;/p>
&lt;p>å…¶ä¸­Tä¸ºç»“æ„ä½“ç±»å‹åï¼Œè¿”å›ä¸€ä¸ª*T&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å–ç»“æ„ä½“çš„åœ°å€å®ä¾‹åŒ–&lt;/p>
&lt;p>&lt;code>ins := &amp;amp;T{}&lt;/code>&lt;/p>
&lt;p>åŒæ ·è¿”å›ä¸€ä¸ª*Tï¼Œç„¶å&lt;code>T.å­—æ®µå&lt;/code>èµ‹å€¼ï¼Œæˆ–è€…&lt;strong>æŒ‡æ˜å­—æ®µçš„æ–¹å¼&lt;/strong>&lt;/p>
&lt;pre>&lt;code>ins := &amp;amp;ç»“æ„ä½“ç±»å‹å{
å­—æ®µ1: å­—æ®µ1çš„å€¼,
å­—æ®µ2: å­—æ®µ2çš„å€¼,
â€¦
}
&lt;/code>&lt;/pre>&lt;p>å­—æ®µä¸å­—æ®µä¹‹é—´ç”¨,åˆ†éš”ï¼Œè¿™ç§æ–¹å¼æŸä¸ªå­—æ®µå¯ä»¥çœç•¥ï¼Œé‚£ä¹ˆå­—æ®µå€¼å–çœç•¥å€¼&lt;/p>
&lt;p>æˆ–è€…&lt;strong>å¤šå€¼æ–¹å¼&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">ins := &amp;amp;ç»“æ„ä½“ç±»å‹å{
å­—æ®µ1çš„å€¼,
å­—æ®µ2çš„å€¼,
&lt;span style="color:#a61717;background-color:#e3d2d2">â€¦&lt;/span>
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ç§æ–¹å¼çœç•¥å­—æ®µåï¼Œä½†æ˜¯æ‰€æœ‰ç»“æ„ä½“å†…çš„å­—æ®µéƒ½å¿…é¡»èµ‹å€¼&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç›´æ¥å®šä¹‰&lt;/p>
&lt;p>å£°æ˜æ–¹å¼ä¹Ÿæ˜¯&lt;strong>æŒ‡æ˜å­—æ®µå’Œå¤šå€¼æ–¹å¼&lt;/strong>ï¼Œåªä¸è¿‡å˜é‡ç”¨çš„æ˜¯Tè€Œä¸æ˜¯*Tè€Œå·²&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="æ¥å£">æ¥å£&lt;/h2>
&lt;p>goä¸­çš„æ¥å£æ˜¯éä¾µå…¥å¼çš„ï¼Œä¸åŒäºJavaè¿™äº›è¯­è¨€éœ€è¦æ˜¾å¼çš„è¿›è¡Œimplementsæ¥å£ï¼Œgoç±»å‹å®ç°æ¥å£ä¸éœ€è¦è¿›è¡Œå£°æ˜ï¼Œåªéœ€è¦å®ç°æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œæ‰€ä»¥ç±»å‹ä¸­çš„æ–¹æ³•æ˜¯æ¥å£ä¸­æ–¹æ³•çš„&lt;strong>è¶…é›†&lt;/strong>ã€‚éä¾µå…¥å¼çš„å¥½å¤„è¿˜åœ¨äºï¼Œä¸åŒäºé¢å‘å¯¹è±¡æ¥å£éœ€è¦æ ¹æ®ä¸šåŠ¡æ¥äº‹å…ˆåˆ¶å®šæ¥å£ä¸­çš„æ–¹æ³•ï¼Œ&lt;strong>ç”šè‡³å¯ä»¥å…ˆå®ç°ç±»å‹å†å£°æ˜æ¥å£&lt;/strong>ï¼Œå¯æ‰©å±•æ€§å¼ºï¼Œè€Œä¸”å¦‚æœä»¥åæƒ³æŠŠæ¥å£ä¸­ä¸€äº›æ–¹æ³•ç‹¬ç«‹å‡ºæ¥åˆ—ä¸ºæ–°æ¥å£ï¼ŒæŒ‰ç…§Javaè¿™äº›ä¾µå…¥å¼çš„æ–¹æ³•ï¼Œæ˜¯éœ€è¦é‡æ–°implementsæ–°æ¥å£å¹¶ä¸”é‡æ–°ç¼–è¯‘çš„ã€‚&lt;strong>è€Œä¸”ï¼Œç±»å‹å®ç°æ¥å£ç”šè‡³ä¸éœ€è¦å¼•å…¥åŒ…&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span> æ¥å£ç±»å‹å &lt;span style="color:#8b008b;font-weight:bold">interface&lt;/span>{
æ–¹æ³•å1( å‚æ•°åˆ—è¡¨1 ) è¿”å›å€¼åˆ—è¡¨1
æ–¹æ³•å2( å‚æ•°åˆ—è¡¨2 ) è¿”å›å€¼åˆ—è¡¨2
&lt;span style="color:#a61717;background-color:#e3d2d2">â€¦&lt;/span>
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‚æ•°&lt;strong>å&lt;/strong>å’Œè¿”å›å€¼&lt;strong>å&lt;/strong>éƒ½å¯ä»¥çœç•¥&lt;/p>
&lt;h3 id="å®ç°æ¥å£">å®ç°æ¥å£&lt;/h3>
&lt;p>e.g:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#228b22">// å®šä¹‰ä¸€ä¸ªæ•°æ®å†™å…¥å™¨
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span> DataWriter &lt;span style="color:#8b008b;font-weight:bold">interface&lt;/span> {
&lt;span style="color:#008b45">WriteData&lt;/span>(data &lt;span style="color:#8b008b;font-weight:bold">interface&lt;/span>{}) &lt;span style="color:#00688b;font-weight:bold">error&lt;/span>
}
&lt;span style="color:#228b22">// å®šä¹‰æ–‡ä»¶ç»“æ„ï¼Œç”¨äºå®ç°DataWriter
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span> file &lt;span style="color:#8b008b;font-weight:bold">struct&lt;/span> {
}
&lt;span style="color:#228b22">// å®ç°DataWriteræ¥å£çš„WriteDataæ–¹æ³•
&lt;/span>&lt;span style="color:#228b22">// è¿™é‡Œæ–¹æ³•è¦æŒ‡å®šæ¥æ”¶è€…
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">func&lt;/span> (d *file) &lt;span style="color:#008b45">WriteData&lt;/span>(data &lt;span style="color:#8b008b;font-weight:bold">interface&lt;/span>{}) &lt;span style="color:#00688b;font-weight:bold">error&lt;/span> {
&lt;span style="color:#228b22">// æ¨¡æ‹Ÿå†™å…¥æ•°æ®
&lt;/span>&lt;span style="color:#228b22">&lt;/span> fmt.&lt;span style="color:#008b45">Println&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;WriteData:&amp;#34;&lt;/span>, data)
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">nil&lt;/span>
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>tips:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>åªæœ‰å½“å®ç°äº†æ¥å£çš„ç±»å‹èµ‹å€¼ç»™æ¥å£å˜é‡æ—¶ï¼Œç¼–è¯‘å™¨æ‰ä¼šå»æ¯”è¾ƒè¿™ä¸ªç±»å‹ä¸­æ˜¯å¦å…¨éƒ¨å®ç°äº†æ¥å£ä¸­çš„æ–¹æ³•&lt;/strong>&lt;/li>
&lt;li>å†…åµŒç»“æ„ä½“ä¹Ÿèƒ½å®ç°æ¥å£ï¼Œè¿™æ ·å¤–å±‚ç»“æ„ä½“å°±ä¸å¿…å†å®ç°ä¸€æ¬¡äº†ï¼Œé¿å…äº†å†—ä½™ä»£ç &lt;/li>
&lt;li>å®ç°ç±»å‹ä¸èƒ½æ˜¯&lt;strong>ç³»ç»Ÿå†…ç½®ç±»å‹ï¼Œåªèƒ½æ˜¯ç»“æ„ä½“æˆ–è€…æ˜¯ç”¨typeå®šä¹‰çš„æ–°ç±»å‹&lt;/strong>&lt;/li>
&lt;li>æ¥å£ä¸­å¯ä»¥åƒç»“æ„ä½“ä¸€æ ·åµŒå¥—æ¥å£ï¼Œè¿™æ ·æ¥å£ä¸­å°±æ‹¥æœ‰è¢«åµŒå¥—æ¥å£çš„æ‰€æœ‰æ–¹æ³•äº†&lt;/li>
&lt;/ul>
&lt;h3 id="erroræ¥å£">erroræ¥å£&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span> &lt;span style="color:#00688b;font-weight:bold">error&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">interface&lt;/span> {
&lt;span style="color:#008b45">Error&lt;/span>() &lt;span style="color:#00688b;font-weight:bold">string&lt;/span>
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœè¦è‡ªå®šä¹‰errorå¯ä»¥å®ç°Error()æ–¹æ³•ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œæ‰“å°erroré»˜è®¤è°ƒç”¨çš„æ˜¯error.Error()&lt;/p>
&lt;p>errorsåŒ…ä¸­çš„errors.New(&amp;ldquo;é”™è¯¯ä¿¡æ¯&amp;rdquo;)å°±æ˜¯è¿”å›ä¸€ä¸ªerrorå¯¹è±¡&lt;/p>
&lt;p>æ–‡ç« æ¨èï¼šå…³äºinterfaceçš„åä¸ªé—®é¢˜ï¼Œè§£æinterfaceçš„ä¸€äº›æœºåˆ¶å’Œåº•å±‚å®ç°ï¼šhttps://mp.weixin.qq.com/s/EbxkBokYBajkCR-MazL0ZA&lt;/p>
&lt;h2 id="å®•æœºpanicå’Œå®•æœºæ¢å¤recover">å®•æœº(panic)å’Œå®•æœºæ¢å¤(recover)&lt;/h2>
&lt;p>&lt;strong>Goè¯­è¨€æ²¡æœ‰å¼‚å¸¸ç³»ç»Ÿï¼Œå…¶ä½¿ç”¨ panic è§¦å‘å®•æœºç±»ä¼¼äºå…¶ä»–è¯­è¨€çš„æŠ›å‡ºå¼‚å¸¸ï¼ˆæ‰“å°å †æ ˆå’Œä¿¡æ¯ï¼‰ï¼Œrecover çš„å®•æœºæ¢å¤æœºåˆ¶å°±å¯¹åº”å…¶ä»–è¯­è¨€ä¸­çš„ try/catch æœºåˆ¶ã€‚&lt;/strong>&lt;/p>
&lt;p>panic()å’Œrecover()éƒ½ä¸ºå†…ç½®å‡½æ•°&lt;/p>
&lt;p>å¦‚æœå½“å‰çš„ goroutine é™·å…¥panicï¼Œè°ƒç”¨ recover å¯ä»¥æ•è·åˆ° panic çš„è¾“å…¥å€¼ï¼Œå¹¶ä¸”æ¢å¤æ­£å¸¸çš„æ‰§è¡Œã€‚&lt;/p>
&lt;p>&lt;strong>å› ä¸ºå¦‚æœåœ¨æ‰‹åŠ¨panicå‰å£°æ˜çš„deferä¼šæ‰§è¡Œï¼Œæ‰€ä»¥å¯ä»¥å°†recoveræ”¾åˆ°deferä¸­ï¼Œç”¨äºæ¢å¤ï¼Œç›¸å½“äºJavaä¸­çš„catchï¼Œtryä¸­å‘ç”Ÿé”™è¯¯ï¼Œç›´æ¥å°†æ§åˆ¶äº¤ç»™catch&lt;/strong>&lt;/p>
&lt;p>e.g:&lt;/p>
&lt;p>webæœåŠ¡å™¨å´©æºƒæ—¶ç”¨recoverå…³é—­è¿æ¥ï¼Œæˆ–è€…å‘å®¢æˆ·ç«¯ä¼ é€’å¼‚å¸¸ä¿¡æ¯ç”¨äºè°ƒè¯•&lt;/p>
&lt;h2 id="sortåŒ…">SortåŒ…&lt;/h2>
&lt;h3 id="æ’åº">æ’åº&lt;/h3>
&lt;p>å¦‚æœè¦å¯¹åˆ‡ç‰‡å…ƒç´ è¿›è¡Œè‡ªå®šä¹‰æ’åºï¼Œéœ€è¦å®ç°sort.Interfaceæ¥å£ä¸­çš„ä¸‰ä¸ªæ–¹æ³•ï¼š&lt;/p>
&lt;ol>
&lt;li>â€‹ Len() int // è·å–å…ƒç´ æ•°é‡&lt;/li>
&lt;li>â€‹ Less(i, j int) bool // iï¼Œjæ˜¯åºåˆ—å…ƒç´ çš„æŒ‡æ•°ã€‚&lt;strong>å³è¡¨ç¤ºæ€ä¹ˆæ ·ç®—ä¸€ä¸ªå…ƒç´ å°äºå¦ä¸€ä¸ªå…ƒç´ ï¼Œç”±è‡ªå·±å®ç°&lt;/strong>&lt;/li>
&lt;li>â€‹ Swap(i, j int) // äº¤æ¢å…ƒç´ &lt;/li>
&lt;/ol>
&lt;p>&lt;strong>æ³¨æ„ï¼Œç³»ç»Ÿå†…ç½®å˜é‡æ˜¯ä¸èƒ½å¤Ÿç”¨æ¥å®ç°æ¥å£çš„ï¼Œå¿…é¡»ç”¨typeå£°æ˜æ–°ç±»å‹&lt;/strong>&lt;/p>
&lt;p>sortåŒ…ä¸­å†…ç½®äº†ä¸€äº›åˆ‡ç‰‡ï¼Œè¿™äº›åˆ‡ç‰‡å·²ç»å®ç°äº†Interfaceä¸­çš„æ–¹æ³•ï¼Œ&lt;strong>æ‰€ä»¥ç›´æ¥ç”¨è¿™äº›åˆ‡ç‰‡å®šä¹‰ï¼Œå¹¶ç”¨sort.Sortæ–¹æ³•å³å¯æ’åº&lt;/strong>&lt;/p>
&lt;p>&lt;img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gob78l1bnmj31060aoq4k.jpg" alt="image-20201222154656587">&lt;/p>
&lt;p>å¦‚æœæ˜¯é’ˆå¯¹äºç»“æ„ä½“æƒ³è¿›è¡Œæ’åºå°±è¦é’ˆå¯¹äºæŸä¸ªå­—æ®µå†™Lessæ–¹æ³•äº†&lt;/p>
&lt;p>&lt;strong>è¿™é‡Œæ¨èsortåŒ…ä¸­æ›´å¿«çš„å®ç°æ–¹å¼&lt;/strong>ï¼Œsort.Sliceæ–¹æ³•ï¼Œè¿™æ ·å°±ä¸å¿…å®ç°sort.Interfaceä¸­æ‰€æœ‰æ–¹æ³•ï¼Œç›´æ¥æä¾›ä¸€ä¸ªåˆ‡ç‰‡å’Œå›è°ƒå‡½æ•°å°±è¡Œäº†ï¼ˆå°±æ˜¯æä¾›ä¸€ä¸ªLess()å‡½æ•°ï¼Œæ€ä¹ˆæ¯”è¾ƒåˆ‡ç‰‡ä¸­å…ƒç´ çš„å¤§å°ï¼‰&lt;/p>
&lt;p>&lt;code>func Slice(slice interface{}, less func(i, j int) bool)&lt;/code>&lt;/p>
&lt;h3 id="æŸ¥æ‰¾">æŸ¥æ‰¾&lt;/h3>
&lt;p>sort.Search(n int, f func(i int) bool) int&lt;/p>
&lt;p>åˆ©ç”¨äºŒåˆ†æŸ¥æ‰¾è¿”å›f(i)==trueæ—¶æœ€å°çš„ç´¢å¼•å€¼ï¼Œfæ˜¯ç”¨æˆ·æä¾›çš„å›è°ƒå‡½æ•°ï¼Œå½“[0,i)æ—¶fä¸ºfalseï¼Œ&amp;gt;=iæ—¶fä¸ºtrueï¼Œé€šå¸¸æ˜¯æœç´¢arrayæˆ–è€…sliceæ—¶ä½¿ç”¨ï¼Œnä¼ å…¥len(arrryæˆ–è€…slice)&lt;/p>
&lt;h2 id="goroutineæ ¸å¿ƒ">goroutineï¼ˆæ ¸å¿ƒï¼‰&lt;/h2>
&lt;p>å‚è€ƒèµ„æ–™ï¼šhttps://www.cnblogs.com/wdliu/p/9272220.html&lt;/p>
&lt;p>goroutineç›¸å½“äºç±»çº¿ç¨‹ï¼Œä¸åŒäºå…¶ä»–è¯­è¨€çº¿ç¨‹ä¹‹é—´æ˜¯é€šè¿‡å…±äº«å†…å­˜çš„æ–¹å¼æ¥é€šä¿¡ï¼Œ&lt;strong>goä¸­çš„goroutineæ˜¯é€šè¿‡é€šé“æ¥ç›¸äº’ä¼ é€’æ¶ˆæ¯çš„&lt;/strong>&lt;/p>
&lt;p>goroutineå’Œå†…æ ¸çº§çº¿ç¨‹çš„å¯¹åº”å…³ç³»æ˜¯&lt;strong>å¤šå¯¹å¤š&lt;/strong>å…³ç³»ï¼Œå¦‚æœæœºå™¨ä¸ºå¤šæ ¸æœºå™¨ï¼Œgoroutineå°±å¯ä»¥å¹¶è¡Œæ‰§è¡Œ&lt;/p>
&lt;p>&lt;strong>ä½¿ç”¨æ–¹æ³•&lt;/strong>ï¼š&lt;/p>
&lt;p>&lt;strong>go å‡½æ•°å(å®å‚)å³å¯è¿è¡Œä¸€ä¸ªgoroutine&lt;/strong>&lt;/p>
&lt;h3 id="mpgæ¨¡å‹">MPGæ¨¡å‹&lt;/h3>
&lt;p>&lt;!-- raw HTML omitted -->&lt;/p>
&lt;ul>
&lt;li>M:Mä»£è¡¨å†…æ ¸çº§çº¿ç¨‹ï¼Œä¸€ä¸ªMå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼›Mæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ç»“æ„ï¼Œé‡Œé¢ç»´æŠ¤å°å¯¹è±¡å†…å­˜cacheï¼ˆmcacheï¼‰ã€å½“å‰æ‰§è¡Œçš„goroutineã€éšæœºæ•°å‘ç”Ÿå™¨ç­‰ç­‰éå¸¸å¤šçš„ä¿¡æ¯ã€‚&lt;strong>Mä¸€å®šè¦å’Œä¸€ä¸ªPç»‘å®š&lt;/strong>&lt;/li>
&lt;li>G:ä»£è¡¨ä¸€ä¸ªgoroutineï¼Œå®ƒæœ‰è‡ªå·±çš„æ ˆï¼Œinstruction pointerå’Œå…¶ä»–ä¿¡æ¯ï¼ˆæ­£åœ¨ç­‰å¾…çš„channelç­‰ç­‰ï¼‰ï¼Œç”¨äºè°ƒåº¦ã€‚&lt;/li>
&lt;li>P:På…¨ç§°æ˜¯Processorï¼Œå¤„ç†å™¨ï¼Œå®ƒçš„ä¸»è¦ç”¨é€”å°±æ˜¯ç”¨æ¥æ‰§è¡Œgoroutineçš„ï¼Œæ‰€ä»¥å®ƒä¹Ÿç»´æŠ¤äº†ä¸€ä¸ªè‡ªå·±çš„&lt;strong>local goroutineé˜Ÿåˆ—&lt;/strong>ï¼Œé‡Œé¢å­˜å‚¨äº†æ‰€æœ‰éœ€è¦å®ƒæ¥æ‰§è¡Œçš„goroutineã€‚å½“ç„¶è¿˜å­˜åœ¨ä¸€ä¸ª&lt;strong>å…¨å±€çš„global goroutineé˜Ÿåˆ—&lt;/strong>ï¼Œå¦‚æœlocalé˜Ÿåˆ—ä¸­çš„goroutineè¿è¡Œå®Œäº†ä¹Ÿä¼šå–globalé˜Ÿåˆ—ä¸­çš„goroutineæ¥è¿è¡Œ&lt;/li>
&lt;li>Schedï¼šä»£è¡¨è°ƒåº¦å™¨ï¼Œè´Ÿè´£å°†goroutineè°ƒåº¦åˆ°å…·ä½“æŸä¸ªé˜Ÿåˆ—ä¸­ï¼ˆå¯ä»¥æ˜¯æ–°çš„goroutineåŠ å…¥ï¼Œæˆ–è€…æ˜¯ä»å…¶ä»–é˜Ÿåˆ—ä¸­å–å¾—çš„goroutine(work stealingæœºåˆ¶ï¼‰ï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>goroutineç†æƒ³è°ƒåº¦æµç¨‹&lt;/strong>ï¼š&lt;/p>
&lt;p>å½“é€šè¿‡&lt;code>go&lt;/code>å…³é”®å­—åˆ›å»ºä¸€ä¸ªæ–°çš„goroutineçš„æ—¶å€™ï¼Œå®ƒä¼šä¼˜å…ˆè¢«æ”¾å…¥Pçš„æœ¬åœ°é˜Ÿåˆ—ã€‚ä¸ºäº†è¿è¡Œgoroutineï¼ŒMéœ€è¦æŒæœ‰ï¼ˆç»‘å®šï¼‰ä¸€ä¸ªPï¼Œæ¥ç€Mä¼šå¯åŠ¨ä¸€ä¸ªOSçº¿ç¨‹ï¼Œå¾ªç¯ä»Pçš„æœ¬åœ°é˜Ÿåˆ—é‡Œå–å‡ºä¸€ä¸ªgoroutineå¹¶æ‰§è¡Œã€‚å½“ç„¶è¿˜æœ‰ &lt;code>work-stealing&lt;/code>è°ƒåº¦ç®—æ³•ï¼šå½“Mæ‰§è¡Œå®Œäº†å½“å‰Pçš„Localé˜Ÿåˆ—é‡Œçš„æ‰€æœ‰Gåï¼ŒPä¹Ÿä¸ä¼šå°±è¿™ä¹ˆåœ¨é‚£èººå°¸å•¥éƒ½ä¸å¹²ï¼Œå®ƒä¼šå…ˆå°è¯•ä»Globalé˜Ÿåˆ—å¯»æ‰¾Gæ¥æ‰§è¡Œï¼Œå¦‚æœGlobalé˜Ÿåˆ—ä¸ºç©ºï¼Œå®ƒä¼šéšæœºæŒ‘é€‰å¦å¤–ä¸€ä¸ªPï¼Œä»å®ƒçš„é˜Ÿåˆ—é‡Œä¸­æ‹¿èµ°ä¸€åŠçš„Gåˆ°è‡ªå·±çš„é˜Ÿåˆ—ä¸­æ‰§è¡Œï¼ˆä¸èƒ½è®©è‡ªå·±é—²ç½®èµ·æ¥ï¼‰&lt;/p>
&lt;p>å‚è€ƒèµ„æ–™ï¼šhttps://zhuanlan.zhihu.com/p/37754274&lt;/p>
&lt;h3 id="channelé€šé“">channelé€šé“&lt;/h3>
&lt;p>é€šé“æ˜¯ä¸€ç§åŒå‘çš„ç®¡é“ï¼Œç”¨äºgoroutineé—´çš„ä¿¡æ¯äº¤æ¢ï¼ˆä¼ è¾“å˜é‡ï¼Œç»“æ„ä½“ï¼ŒæŒ‡é’ˆç­‰ç­‰ï¼‰&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ— ç¼“å†²ç®¡é“ï¼š&lt;/p>
&lt;p>ch := make(chan ç±»å‹)&lt;/p>
&lt;p>å‘é€æ–¹å‘é€šé“å‘é€æ•°æ®åï¼Œè‹¥æ²¡æœ‰æ¥æ”¶æ–¹å–æ•°æ®å°±ä¼šé˜»å¡ï¼Œç›´åˆ°æ¥æ”¶æ–¹æ¥æ”¶ä¸ºæ­¢ï¼›æ¥æ”¶æ–¹åŒç†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æœ‰ç¼“å†²ç®¡é“ï¼š&lt;/p>
&lt;p>ch := make(chan ç±»å‹ï¼Œç¼“å†²åŒºå¤§å°)&lt;/p>
&lt;p>ä¸åŒäºæ— ç¼“å†²çš„æƒ…å†µï¼Œå‘é€æ–¹å¯ä»¥ä¸ç”¨é˜»å¡åœ°ä¸€ç›´å‘ç®¡é“å‘é€æ•°æ®ï¼Œç›´åˆ°ç¼“å†²åŒºæ»¡ä¹‹åæ‰ä¼šé˜»å¡ï¼›æ¥æ”¶æ–¹ä¹Ÿå¯ä»¥ä¸ç”¨é˜»å¡åœ°ä»é€šé“ä¸­å–æ•°æ®ï¼ˆå½“ç„¶æ˜¯ç¼“å†²åŒºä¸­æœ‰æ•°æ®çš„æƒ…å†µï¼‰ï¼Œç›´åˆ°æ²¡æœ‰æ•°æ®å¯å–ä¸ºæ­¢ï¼Œåˆ™æ¥æ”¶æ–¹é˜»å¡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç©ºç»“æ„ä½“é€šé“&lt;/strong>&lt;/p>
&lt;p>å› ä¸ºç©ºç»“æ„ä½“struct{}ä¸å å†…å­˜ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ¥ä½œä¸ºä¿¡å·æ¥åŒæ­¥ï¼Œå½“ä¸€ä¸ªgoroutineå®Œæˆæ—¶ï¼Œå¯ä»¥é€šè¿‡å‘é€struct{}{}è¡¨ç¤ºå·²å®Œæˆï¼Œé€šçŸ¥å¦ä¸€ç«¯çš„goroutine&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="å…³é—­é€šé“">å…³é—­é€šé“&lt;/h4>
&lt;p>ä½¿ç”¨åŸè¯­close(chan)å…³é—­é€šé“ï¼Œè¯»å–å…³é—­çš„é€šé“ä¼šè¯»å–åˆ°ç›¸åº”ç±»å‹çš„&lt;strong>é›¶å€¼&lt;/strong>&lt;/p>
&lt;h3 id="context">Context&lt;/h3>
&lt;p>contextå¯ä»¥ç”¨æ¥goroutineä¹‹é—´è¿›è¡Œ&lt;strong>å…ƒæ•°æ®ä¼ é€’æˆ–è€…é€€å‡ºé€šçŸ¥ï¼ˆä»ctx.Done()å½“ä¸­è¯»å‡ºï¼ŒèŠ‚çœèµ„æºï¼‰æˆ–è€…é˜²æ­¢goroutineæ³„æ¼&lt;/strong>ç­‰æ“ä½œï¼Œå‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/68792989&lt;/p>
&lt;h3 id="syncwaitgroup">sync.WaitGroup&lt;/h3>
&lt;p>æœ‰æ—¶å€™ä¸»çº¿ç¨‹éœ€è¦ç­‰å¾…å…¶ä»–goroutineæ‰§è¡Œå®Œæ¯•ï¼Œç”¨time.Sleepçš„æ–¹æ³•ä¸å¤ªå¥½ï¼Œæ— æ³•ä¼°è®¡æ‰€æœ‰goroutineå®Œæˆçš„æ—¶é—´ï¼Œæ‰€ä»¥ç”¨sync.WaitGroupç»“æ„ä½“æ¥åšåŒæ­¥æ¯”è¾ƒå¥½&lt;/p>
&lt;p>æ–¹æ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Add(delta int)&lt;/p>
&lt;p>deltaè¡¨ç¤ºè¦æ‰§è¡Œçš„goroutineæ•°é‡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Done()&lt;/p>
&lt;p>sync.WaitGroupå˜é‡è°ƒç”¨ä¸€æ¬¡Done()ï¼Œç»“æ„ä½“ä¸­çš„è®¡æ•°å™¨ï¼ˆdeltaæ•°ï¼‰å°±-1&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Wait()&lt;/p>
&lt;p>ä¸€ç›´é˜»å¡ï¼Œç›´åˆ°è®¡æ•°å™¨å˜ä¸º0ä¸ºæ­¢ï¼Œå¯ä»¥æ”¾åœ¨mainå‡½æ•°çš„æœ€åï¼Œç­‰å¾…æ‰€æœ‰å…¶ä»–goroutine doneï¼Œç„¶åç»“æŸç¨‹åº&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="äº’æ–¥é”å’Œè¯»å†™äº’æ–¥é”">äº’æ–¥é”å’Œè¯»å†™äº’æ–¥é”&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>äº’æ–¥é”&lt;/p>
&lt;p>sync.Mutexï¼Œå¯¹ç­‰æ“ä½œç³»ç»Ÿé‡Œå­¦çš„mutex&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è¯»å†™äº’æ–¥é”&lt;/p>
&lt;p>sync.RWMutexï¼Œå°è£…äº†Mutexï¼Œè¿˜å†…ç½®è¯»è€…è®¡æ•°å™¨ï¼Œå¯ç”¨äºå•å†™è€…å¤šè¯»è€…ï¼Œæ•ˆç‡æ¯”æ™®é€šäº’æ–¥é”è¦é«˜&lt;/p>
&lt;/li>
&lt;/ul>
- http://example.org/posts/golang%E5%9F%BA%E7%A1%80/ - æœ¬ç«™éµå¾ª CC-BY-NC 4.0 åè®®</description></item><item><title>Dockeråº•å±‚åŸç†</title><link>http://example.org/posts/docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/</link><pubDate>Sun, 07 Mar 2021 11:12:39 +0800</pubDate><guid>http://example.org/posts/docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/</guid><description>Jesse's Blog http://example.org/posts/docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/ -&lt;h1 id="dockeråº•å±‚åŸç†">dockeråº•å±‚åŸç†&lt;/h1>
&lt;h2 id="namespaceèµ„æºéš”ç¦»">namespaceâ€”â€”èµ„æºéš”ç¦»&lt;/h2>
&lt;p>namespace æ˜¯ Linux å†…æ ¸ç”¨æ¥éš”ç¦»å†…æ ¸èµ„æºçš„æ–¹å¼ï¼ŒåŒä¸€ä¸ªnamespaceä¸­çš„è¿›ç¨‹ä¹‹é—´å¯ä»¥äº’ç›¸æ„ŸçŸ¥ï¼Œä¸åŒnamespaceä¹‹é—´çš„è¿›ç¨‹æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œ&lt;strong>dockeræœ¬èº«å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œé€šè¿‡namespaceæ¥å®ç°éš”ç¦»ï¼Œä»è€Œæ¨¡æ‹Ÿç‹¬ç«‹è¿è¡Œç¯å¢ƒ&lt;/strong>ï¼Œåœ¨/proc/$$/nsä¸‹èƒ½æŸ¥çœ‹å½“å‰è¿›ç¨‹ä¸‹çš„æ‰€æœ‰linkæ–‡ä»¶ï¼Œæ¯ä¸ªlinkæ–‡ä»¶å¯¹åº”ä¸åŒçš„namespaceï¼Œ&lt;strong>å¦‚æœä¸åŒçš„è¿›ç¨‹é—´æœ‰ç›¸åŒçš„namespaceçš„inodeå·ï¼Œåˆ™ä»–ä»¬æ˜¯å…±äº«namespaceçš„&lt;/strong>ï¼Œå¦åˆ™ä»–ä»¬å±äºä¸åŒçš„çš„namespace&lt;/p>
&lt;p>&lt;img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gob6e80y1pj30i904dglp.jpg" alt="img">&lt;/p>
&lt;ul>
&lt;li>
&lt;p>**é€šè¿‡clone()å‡½æ•°åœ¨åˆ›å»ºå­è¿›ç¨‹çš„åŒæ—¶ç»™å­è¿›ç¨‹åˆ›å»ºæ–°çš„namespaceï¼ˆä¼ å…¥CLONE_*å®å®šä¹‰ï¼‰**&lt;/p>
&lt;/li>
&lt;li>
&lt;p>UTS namespaceï¼š&lt;/p>
&lt;p>æä¾›&lt;strong>ä¸»æœºåå’ŒåŸŸå&lt;/strong>çš„éš”ç¦»ï¼Œä½¿å®¹å™¨èƒ½å¤Ÿé€šè¿‡æœåŠ¡åè®¿é—®&lt;/p>
&lt;/li>
&lt;li>
&lt;p>IPC namespaceï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰ï¼š&lt;/p>
&lt;p>å®ç°&lt;strong>ä¿¡å·é‡ã€æ¶ˆæ¯é˜Ÿåˆ—å’Œå…±äº«å†…å­˜ç­‰èµ„æº&lt;/strong>çš„éš”ç¦»&lt;/p>
&lt;/li>
&lt;li>
&lt;p>PID namespaceï¼š&lt;/p>
&lt;p>å¯¹è¿›ç¨‹å†…çš„PIDé‡æ–°æ ‡å·ï¼Œä»1å¼€å§‹ï¼Œæ¯ä¸ªPID namespaceéƒ½æœ‰è‡ªå·±çš„è®¡æ•°ç¨‹åºï¼Œå®¿ä¸»æœºçš„PID namespaceç›¸å½“äºåˆ›å»ºè¿›ç¨‹çš„PID namespaceçš„parent pid namespaceï¼Œèƒ½çœ‹åˆ°å­èŠ‚ç‚¹ï¼ˆchild pid namespace)ä¸­çš„å†…å®¹ï¼Œä½†å­èŠ‚ç‚¹ä¸èƒ½çœ‹åˆ°çˆ¶èŠ‚ç‚¹å½“ä¸­çš„å†…å®¹ï¼Œè¿™æ ·çˆ¶èŠ‚ç‚¹èƒ½åœ¨å¤–éƒ¨ç®¡ç†å®¹å™¨å†…çš„è¿›ç¨‹&lt;/p>
&lt;p>å¦‚æœpid namespaceä¸­çš„æŸä¸ªè¿›ç¨‹çš„çˆ¶è¿›ç¨‹è¢«æ€æ­»ï¼Œè¯¥è¿›ç¨‹æˆä¸ºå­¤å„¿è¿›ç¨‹ï¼Œåˆ™&lt;strong>ä¼šè¢«å½“å‰pid namespaceçš„initè¿›ç¨‹ï¼ˆpidä¸º1ï¼Œå¦‚/bin/bashï¼‰æ”¶å…»ï¼Œæˆä¸ºå…¶å­è¿›ç¨‹&lt;/strong>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>mount namespace:&lt;/p>
&lt;p>é€šè¿‡éš”ç¦»æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹æ¥éš”ç¦»æ–‡ä»¶ç³»ç»Ÿï¼ˆå½“åˆ›å»ºæ–°çš„mount namespaceæ—¶ï¼Œä¼šå°†æ‰€æœ‰æŒ‚è½½ç‚¹å¤åˆ¶ç»™å­è¿›ç¨‹ï¼Œä½†åœ¨è¿™ä¹‹åï¼Œå­è¿›ç¨‹å¯¹è‡ªå·±namespaceå†…æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œçš„æ“ä½œä¸ä¼šå½±å“åˆ°çˆ¶è¿›ç¨‹namespaceï¼‰&lt;/p>
&lt;p>&lt;strong>å¯ä»¥é€šè¿‡å…±äº«æŒ‚è½½æœºåˆ¶ä¼ æ’­æŒ‚è½½ï¼ˆä¸»ä»æŒ‚è½½ã€å…±äº«æŒ‚è½½ç­‰ï¼‰&lt;/strong>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>network namespace:&lt;/p>
&lt;p>æä¾›ç½‘ç»œèµ„æºçš„éš”ç¦»ï¼ŒåŒ…æ‹¬ç½‘ç»œè®¾å¤‡ã€åè®®æ ˆã€è·¯ç”±è¡¨ã€é˜²ç«å¢™ç­‰ç­‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://images2018.cnblogs.com/blog/1259802/201804/1259802-20180410165500455-232801094.jpg" alt="img">&lt;/p>
&lt;p>&lt;strong>é»˜è®¤çš„bridgeæ¨¡å¼&lt;/strong>ï¼š&lt;/p>
&lt;p>æ¯ä¸ªå®¹å™¨æœ‰ç‹¬ç«‹çš„network namespaceï¼Œå®¿ä¸»æœºé€šè¿‡docker0ç½‘æ¡¥ï¼ˆè™šæ‹Ÿç½‘æ¡¥ï¼‰æ¥è¿æ¥ä¸åŒçš„network namespaceï¼Œå®¹å™¨é€šè¿‡veth pairï¼ˆè™šæ‹Ÿä»¥å¤ªç½‘ç«¯å£å¯¹ï¼Œå®ƒä»¬ç»„æˆäº†ä¸€ä¸ªæ•°æ®çš„é€šé“ï¼Œæ•°æ®ä»ä¸€ä¸ªè®¾å¤‡è¿›å…¥ï¼Œå°±ä¼šä»å¦ä¸€ä¸ªè®¾å¤‡å‡ºæ¥ï¼‰è¿æ¥docker0ç½‘æ¡¥ï¼Œè®¾å¤‡çš„ä¸€ç«¯æ”¾åœ¨æ–°åˆ›å»ºçš„å®¹å™¨ä¸­ï¼Œå¹¶å‘½åä¸ºeth0ã€‚å¦ä¸€ç«¯æ”¾åœ¨ä¸»æœºä¸­ï¼Œä»¥veth65f9è¿™æ ·ç±»ä¼¼çš„åå­—å‘½åã€‚&lt;/p>
&lt;p>å¦‚æœå®¹å™¨æƒ³ä¸»åŠ¨å’Œå¤–ç•Œé€šä¿¡ï¼Œæˆ–è€…å¤–ç•Œæƒ³è®¿é—®å®¹å™¨å†…çš„æœåŠ¡ï¼ˆè®¿é—®å®¿ä¸»æœºçš„ç«¯å£ï¼‰ï¼Œå®é™…ä¸Šè¿™æ˜¯é€šè¿‡iptablesæ¥ç®¡ç†çš„ï¼ˆè¿›è¡Œäº†è½¬å‘å’ŒNATè½¬æ¢ç­‰æ“ä½œï¼‰&lt;/p>
&lt;p>&lt;strong>hostæ¨¡å¼ï¼š&lt;/strong>&lt;/p>
&lt;p>å®¹å™¨å’Œå®¿ä¸»æœºå…±äº«network namespaceï¼Œä½†å…¶ä»–namespaceä¸å®¿ä¸»æœºéš”ç¦»ï¼Œå®¹å™¨ç”¨çš„æ˜¯å®¿ä¸»æœºçš„ipä¸å¤–ç•Œé€šä¿¡ï¼Œæ€§èƒ½è¾ƒå¥½ä½†æ˜“äº§ç”Ÿç«¯å£å†²çª&lt;/p>
&lt;p>&lt;strong>containeræ¨¡å¼ï¼š&lt;/strong>&lt;/p>
&lt;p>æ–°åˆ›å»ºçš„å®¹å™¨è‹¥æŒ‡å®šcontaineræ¨¡å¼ï¼Œåˆ™å’Œå·²ç»å­˜åœ¨çš„å®¹å™¨å…±äº«ä¸€ä¸ªnetwork namespaceï¼Œä¸æ­¤å®¹å™¨å…±äº«ipå’Œåè®®æ ˆ&lt;/p>
&lt;ul>
&lt;li>
&lt;p>user namespace&lt;/p>
&lt;p>æä¾›å®‰å…¨éš”ç¦»ï¼Œæ¯”å¦‚ç”¨æˆ·idï¼Œç”¨æˆ·ç»„ï¼Œæƒé™ç­‰ï¼Œåœ¨å­è¿›ç¨‹çš„user namespaceä¸­æ‹¥æœ‰æ–°çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œåœ¨çˆ¶è¿›ç¨‹ä¸­çš„æ™®é€šç”¨æˆ·å¯èƒ½å´æˆä¸ºå­è¿›ç¨‹ä¸­namespaceçš„è¶…çº§ç”¨æˆ·ï¼Œç»“æ„ä¸pid namespaceç±»ä¼¼ï¼ˆæ ‘çŠ¶ç»“æ„ï¼‰ï¼Œ&lt;strong>å­user namespaceä¸­çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„éœ€è¦ä¸çˆ¶user namespaceä¸­çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ç›¸å¯¹åº”ï¼ˆåšæ˜ å°„ï¼‰&lt;/strong>ï¼Œè¿™æ ·è¿™ä¸ªuser namespaceæ‰èƒ½ä¸å…¶ä»–user namespaceä¸­çš„è¿›ç¨‹é€šä¿¡ï¼Œç”šè‡³è®¿é—®å…±äº«çš„æ–‡ä»¶ï¼ˆå³å¯¹åº”åˆ°å…¶ä»–user namespaceçš„ç”¨æˆ·å’Œç”¨æˆ·ç»„å¹¶æ‹¥æœ‰ç›¸åº”çš„æƒé™ï¼Œå¦‚æœæ²¡æœ‰ç›¸åº”çš„æƒé™å°±ä¸èƒ½åœ¨å…¶ä»–user namespaceæ‰§è¡ŒæŸäº›æ“ä½œï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="cgroupsèµ„æºé™åˆ¶">cgroupsâ€”â€”èµ„æºé™åˆ¶&lt;/h2>
&lt;p>cgroups æ˜¯Linuxå†…æ ¸æä¾›çš„ä¸€ç§&lt;strong>å¯ä»¥é™åˆ¶å•ä¸ªè¿›ç¨‹æˆ–è€…å¤šä¸ªè¿›ç¨‹æ‰€ä½¿ç”¨èµ„æº&lt;/strong>çš„æœºåˆ¶ï¼Œå¯ä»¥å¯¹ cpuï¼Œå†…å­˜ç­‰èµ„æºå®ç°ç²¾ç»†åŒ–çš„æ§åˆ¶ï¼ˆä½¿ç”¨ä¸Šé™ï¼Œä½¿ç”¨èŒƒå›´ç­‰ç­‰ï¼‰ï¼Œcgroupé€šè¿‡ä¼ªæ–‡ä»¶ç³»ç»Ÿçš„å½¢å¼è¿›è¡Œæ§åˆ¶&lt;/p>
&lt;p>&lt;strong>æ¶‰åŠæ¦‚å¿µï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>taskï¼ˆä»»åŠ¡ï¼‰ï¼šè¡¨ç¤ºç³»ç»Ÿçš„ä¸€ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>subsystem(å­ç³»ç»Ÿ)ï¼šæ¯ä¸ªå­ç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªèµ„æºæ§åˆ¶å™¨ï¼Œæœ‰cpuã€memoryã€ioç­‰ç­‰ï¼Œ/sys/fs/cgroup/ä¸‹çš„ç›®å½•å°±ä»£è¡¨æ¯ä¸ªå­ç³»ç»Ÿ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>hierarchyï¼ˆå±‚çº§ï¼‰ï¼šå±‚çº§ç”±ä¸€ç³»åˆ—çš„cgroupä»¥ä¸€ä¸ªæ ‘çŠ¶å½¢å¼ç»„æˆï¼Œç”±ä¸€ä¸ªæˆ–å¤šä¸ªå­ç³»ç»Ÿé™åˆ¶å±‚çº§çš„èµ„æºä½¿ç”¨é‡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>cgroup&lt;/strong>ï¼ˆæ§åˆ¶ç»„ï¼‰ï¼šæ ¸å¿ƒæ¦‚å¿µï¼Œç”±cgroupç»„æˆå±‚çº§ï¼Œtaskæ”¾åœ¨cgroupä¸­ï¼Œä»è€Œæ§åˆ¶è¿›ç¨‹çš„ä½¿ç”¨èµ„æºé‡ï¼Œdockerçš„å®ç°æ–¹æ³•å°±æ˜¯åœ¨æ¯ä¸ªå­ç³»ç»Ÿä¸­ä¸ºæ¯ä¸ªå®¹å™¨åˆ›å»ºcgroup&lt;/p>
&lt;p>ps:ç¬”è€…è‡ªå·±ipadç”»çš„å›¾ï¼Œæœ‰ç‚¹ç®€é™‹æŠ±æ­‰:Pï¼Œä»¥åæ–‡ç« çš„å›¾æœ‰æ—¶é—´éƒ½ä¼šç”¨Graffleå¥½å¥½ç”»ä¸€ä¸‹&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>![image-20201104214438717](/Users/chenzicong/Library/Application Support/typora-user-images/image-20201104214438717.png)&lt;/p>
&lt;h2 id="docker-æ¶æ„æ€»è§ˆ">docker æ¶æ„æ€»è§ˆ&lt;/h2>
&lt;p>&lt;img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gob68s57bpj311c0hm7ax.jpg" alt="image-20201209104859776">&lt;/p>
&lt;h3 id="runc">runC&lt;/h3>
&lt;p>æ˜¯å¯¹äºOCIæ ‡å‡†çš„ä¸€ä¸ªå‚è€ƒå®ç°ï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥ç”¨äºåˆ›å»ºå’Œè¿è¡Œå®¹å™¨çš„CLI(command-line interface)å·¥å…·ã€‚runcç›´æ¥ä¸å®¹å™¨æ‰€ä¾èµ–çš„cgroup/linux kernelç­‰è¿›è¡Œäº¤äº’ï¼Œè´Ÿè´£ä¸ºå®¹å™¨é…ç½®cgroup/namespaceç­‰å¯åŠ¨å®¹å™¨æ‰€éœ€çš„ç¯å¢ƒï¼Œåˆ›å»ºå¯åŠ¨å®¹å™¨çš„ç›¸å…³è¿›ç¨‹ã€‚runCåŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå°å·¥å…·ï¼Œå®ƒå¯ä»¥ä¸ç”¨é€šè¿‡Dockerå¼•æ“ï¼Œç›´æ¥å°±å¯ä»¥åˆ›å»ºå®¹å™¨ã€‚è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½¿ç”¨OCIå®¹å™¨å°±å¯ä»¥è¿è¡Œå®ƒã€‚&lt;/p>
&lt;h3 id="containerd">containerd&lt;/h3>
&lt;p>containerd æ˜¯ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒå¯ä»¥ä½¿ç”¨runCç®¡ç†å®¹å™¨ï¼Œå¹¶ä½¿ç”¨gRPCæš´éœ²å®¹å™¨çš„å…¶ä»–åŠŸèƒ½ã€‚docker engineé¢å‘clientï¼Œcontainerdæš´éœ²å‡ºé’ˆå¯¹å®¹å™¨çš„å¢åˆ æ”¹æŸ¥çš„æ¥å£ï¼ŒDocker engineé€šè¿‡gRPCè°ƒç”¨è¿™äº›æ¥å£å®Œæˆå¯¹äºå®¹å™¨çš„æ“ä½œï¼Œcontainerdæœ€åä¼šé€šè¿‡runcæ¥å®é™…è¿è¡Œå®¹å™¨ã€‚&lt;/p>
&lt;h3 id="containerd-shim">containerd-shim&lt;/h3>
&lt;p>containerd-shimç§°ä¹‹ä¸ºå«ç‰‡ï¼Œå®ƒä½¿ç”¨runCå‘½ä»¤è¡Œå·¥å…·å®Œæˆå®¹å™¨çš„å¯åŠ¨ã€åœæ­¢ä»¥åŠå®¹å™¨è¿è¡ŒçŠ¶æ€çš„ç›‘æ§ã€‚containerd-shimè¿›ç¨‹ç”±containerdè¿›ç¨‹æ‹‰èµ·ï¼Œå¹¶æŒç»­å­˜åœ¨åˆ°å®¹å™¨å®ä¾‹è¿›ç¨‹é€€å‡ºä¸ºæ­¢ï¼ˆå’Œå®¹å™¨è¿›ç¨‹åŒç”Ÿå‘½å‘¨æœŸï¼‰ã€‚è¿™ç§è®¾è®¡çš„ä¼˜ç‚¹æ˜¯ï¼Œåªè¦æ˜¯ç¬¦åˆOCIè§„èŒƒçš„å®¹å™¨ï¼Œéƒ½å¯ä»¥é€šè¿‡containerd-shimæ¥è¿›è¡Œè°ƒç”¨&lt;/p>
&lt;h2 id="è”åˆæ–‡ä»¶ç³»ç»Ÿ">è”åˆæ–‡ä»¶ç³»ç»Ÿ&lt;/h2>
&lt;p>&lt;img src="https://docs.docker.com/storage/storagedriver/images/container-layers.jpg" alt="Layers of a container based on the Ubuntu image">&lt;/p>
&lt;p>&lt;strong>å¦‚æœå®¹å™¨åŸºäºåŒä¸€é•œåƒæ„å»ºï¼Œæ‰€æœ‰å®¹å™¨å…±äº«åº•éƒ¨çš„é•œåƒå±‚ï¼Œé•œåƒå±‚æ˜¯read-onlyçš„ï¼Œä¸å¯è¢«ä¿®æ”¹ï¼Œå®¹å™¨åªæ˜¯åœ¨é•œåƒå±‚ä¹‹ä¸Šåˆ›å»ºäº†ä¸€ä¸ªè¯»å†™å±‚ï¼Œæ‰€æœ‰å®¹å™¨çš„ä¿®æ”¹éƒ½æ˜¯åœ¨è¯»å†™å±‚å½“ä¸­ä¿®æ”¹ï¼Œå¹¶ä¸ä¼šå½±å“åˆ°åº•éƒ¨çš„é•œåƒå±‚ï¼Œå½“å®¹å™¨åˆ é™¤äº†ï¼Œè¯»å†™å±‚ä¹Ÿå°±è·Ÿç€åˆ é™¤äº†ï¼ˆé™¤écommitåšæˆäº†æ–°çš„é•œåƒï¼‰&lt;/strong>&lt;/p>
&lt;p>&lt;strong>å°±ç®—å®¹å™¨ä¸æ˜¯åŸºäºåŒä¸€é•œåƒæ„å»ºï¼Œå¦‚æœä¸åŒé•œåƒä¸­æœ‰ç›¸åŒçš„å±‚ï¼ˆæ¯”å¦‚FROMæ˜¯ç›¸åŒçš„ï¼‰ï¼Œå®¹å™¨ä¹Ÿä¼šè¯»å–åŒä¸€é•œåƒå±‚ï¼Œè¿™å°±æ˜¯è”åˆæ–‡ä»¶ç³»ç»Ÿçš„ç²¾é«“æ‰€åœ¨ï¼Œå‰¯æœ¬åªä¿å­˜ä¸€ä»½&lt;/strong>&lt;/p>
&lt;p>&lt;img src="https://docs.docker.com/storage/storagedriver/images/sharing-layers.jpg" alt="Containers sharing same image">&lt;/p>
&lt;h2 id="copy-on-writecowæœºåˆ¶">Copy on writeï¼ˆCOWï¼‰æœºåˆ¶&lt;/h2>
&lt;p>&lt;strong>å½“å®¹å™¨éœ€è¦è¯»å–æ–‡ä»¶çš„æ—¶å€™&lt;/strong>&lt;/p>
&lt;p>ä»æœ€ä¸Šå±‚é•œåƒå¼€å§‹æŸ¥æ‰¾ï¼Œå¾€ä¸‹æ‰¾ï¼Œæ‰¾åˆ°æ–‡ä»¶åè¯»å–å¹¶æ”¾å…¥å†…å­˜ï¼Œè‹¥å·²ç»åœ¨å†…å­˜ä¸­äº†ï¼Œç›´æ¥ä½¿ç”¨ã€‚(å³ï¼ŒåŒä¸€å°æœºå™¨ä¸Šè¿è¡Œçš„dockerå®¹å™¨å…±äº«è¿è¡Œæ—¶ç›¸åŒçš„æ–‡ä»¶)ã€‚&lt;/p>
&lt;p>&lt;strong>å½“å®¹å™¨éœ€è¦æ·»åŠ æ–‡ä»¶çš„æ—¶å€™&lt;/strong>&lt;/p>
&lt;p>ç›´æ¥åœ¨æœ€ä¸Šé¢çš„å®¹å™¨å±‚å¯å†™å±‚æ·»åŠ æ–‡ä»¶ï¼Œä¸ä¼šå½±å“é•œåƒå±‚ã€‚&lt;/p>
&lt;p>&lt;strong>å½“å®¹å™¨éœ€è¦ä¿®æ”¹æ–‡ä»¶çš„æ—¶å€™&lt;/strong>&lt;/p>
&lt;p>ä»ä¸Šå¾€ä¸‹å±‚å¯»æ‰¾æ–‡ä»¶ï¼Œæ‰¾åˆ°åï¼Œ&lt;strong>å¤åˆ¶åˆ°å®¹å™¨å¯å†™å±‚&lt;/strong>ï¼Œç„¶åï¼Œå¯¹å®¹å™¨æ¥è¯´ï¼Œå¯ä»¥çœ‹åˆ°çš„æ˜¯å®¹å™¨å±‚çš„è¿™ä¸ªæ–‡ä»¶ï¼Œçœ‹ä¸åˆ°é•œåƒå±‚é‡Œçš„æ–‡ä»¶ã€‚å®¹å™¨åœ¨å®¹å™¨å±‚ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ï¼ˆä¹Ÿå°±æ˜¯è¦†ç›–ï¼‰ã€‚&lt;/p>
&lt;p>&lt;strong>å¦‚æœæ˜¯ä¸€ä¸ªç»å¸¸éœ€è¦å†™çš„åº”ç”¨ï¼Œæœ€å¥½ä½¿ç”¨volumeè€Œä¸æ˜¯éƒ½å†™åœ¨å®¹å™¨å±‚é‡Œï¼Œè¿™æ ·ä¸ä¼šä½¿å®¹å™¨å±‚å˜å¾—å¾ˆå¤§&lt;/strong>&lt;/p>
&lt;p>&lt;strong>å½“å®¹å™¨éœ€è¦åˆ é™¤æ–‡ä»¶çš„æ—¶å€™&lt;/strong>&lt;/p>
&lt;p>ä»ä¸Šå¾€ä¸‹å±‚å¯»æ‰¾æ–‡ä»¶ï¼Œæ‰¾åˆ°ååœ¨å®¹å™¨ä¸­è®°å½•åˆ é™¤ã€‚å³ï¼Œ&lt;strong>å¹¶ä¸ä¼šçœŸæ­£çš„åˆ é™¤æ–‡ä»¶ï¼Œè€Œæ˜¯è½¯åˆ é™¤&lt;/strong>ã€‚è¿™å°†å¯¼è‡´é•œåƒä½“ç§¯åªä¼šå¢åŠ ï¼Œä¸ä¼šå‡å°‘ã€‚&lt;strong>æ‰€ä»¥è¦å†™Dockerfileæ—¶å¦‚æœè¦åˆ é™¤é•œåƒä¸­çš„æ–‡ä»¶ï¼Œæœ€å¥½åœ¨åŒä¸€å±‚åˆ é™¤ï¼Œå¦åˆ™åªæ˜¯è½¯åˆ é™¤&lt;/strong>ï¼ˆå› ä¸ºå¦‚æœçœŸæ­£çš„åˆ é™¤å°±ä¼šå¯¼è‡´åŸºäºè¿™ä¸ªé•œåƒæ„æ¶å†…çš„å…¶ä»–å®¹å™¨æ— æ³•å†è¯»å–è¿™ä¸ªæ–‡ä»¶äº†ï¼‰&lt;/p>
&lt;h2 id="iptablesé»˜è®¤è§„åˆ™åªåˆ—ä¸¾äº†éƒ¨åˆ†">iptablesé»˜è®¤è§„åˆ™ï¼ˆåªåˆ—ä¸¾äº†éƒ¨åˆ†ï¼‰&lt;/h2>
&lt;ul>
&lt;li>natè¡¨ï¼š
&lt;ul>
&lt;li>å¦‚æœæ•°æ®æºåœ°å€æ˜¯docker0ç½‘æ®µåœ°å€ï¼Œä¸”å‘å¾€é™¤docker 0å¤–ç«¯å£ï¼ˆå³å‘å¾€ä¸»æœºå¤–ï¼‰ï¼Œåˆ™åšSNATè½¬æ¢ï¼Œä¿®æ”¹ä¸ºä¸»æœºç½‘å¡ipåœ°å€&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>filterè¡¨ï¼š
&lt;ul>
&lt;li>docker0å‘å‡ºçš„åŒ…å¯ä»¥ä¸­è½¬ç»™docker 0æœ¬èº«ï¼Œå³å®¹å™¨ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡&lt;/li>
&lt;li>docker0å‘å‡ºçš„åŒ…å¯ä»¥ä¸­è½¬ç»™å…¶ä»–å®¿ä¸»æœºä¸Šçš„å…¶ä»–ç½‘å¡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™&lt;/h2>
&lt;ul>
&lt;li>ã€ŠDockerå®¹å™¨ä¸å®¹å™¨äº‘ ç¬¬2ç‰ˆã€‹æµ™æ±Ÿå¤§å­¦SELå®éªŒå®¤Â·è‘—&lt;/li>
&lt;li>&lt;a href="https://www.jianshu.com/p/517e757d6d17">https://www.jianshu.com/p/517e757d6d17&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.cnblogs.com/sparkdev/tag/docker/default.html?page=1">https://www.cnblogs.com/sparkdev/tag/docker/default.html?page=1&lt;/a>&lt;/li>
&lt;/ul>
- http://example.org/posts/docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/ - æœ¬ç«™éµå¾ª CC-BY-NC 4.0 åè®®</description></item><item><title>DockeråŸºç¡€çŸ¥è¯†</title><link>http://example.org/posts/docker%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</link><pubDate>Sun, 07 Mar 2021 10:56:15 +0800</pubDate><guid>http://example.org/posts/docker%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</guid><description>Jesse's Blog http://example.org/posts/docker%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/ -&lt;h1 id="docker">Docker&lt;/h1>
&lt;h2 id="dockeræ‹‰å–é•œåƒæµç¨‹å›¾">Dockeræ‹‰å–é•œåƒæµç¨‹å›¾&lt;/h2>
&lt;p>&lt;img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gob5syundsj318o0ogn1v.jpg" alt="æˆªå±2020-08-12 ä¸Šåˆ10.33.14">&lt;/p>
&lt;h2 id="docker-cli">Docker CLI&lt;/h2>
&lt;h3 id="é•œåƒå‘½ä»¤">é•œåƒå‘½ä»¤&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>docker images æŸ¥çœ‹æœ¬åœ°çš„é•œåƒ&lt;/code>&lt;/p>
&lt;p>docker images [image-name[:tag]]
é»˜è®¤ä¸åŠ å‚æ•°å°±æ˜¯-aï¼Œæˆ–è€…æŒ‡å®šimageçš„åå­—ï¼Œå¯åœ¨imageä¹‹ä¸Šå†åŠ ç‰ˆæœ¬å·
&amp;ndash;a åˆ—å‡ºæ‰€æœ‰é•œåƒ
&amp;ndash;q [image] åˆ—å‡ºé•œåƒçš„idï¼ˆ-aqæ˜¯åˆ—å‡ºæ‰€æœ‰çš„é•œåƒidï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>docker search é•œåƒ&lt;/code>&lt;/p>
&lt;p>æœç´¢è¿œç¨‹ä»“åº“é•œåƒï¼ˆdocker hubä¸ŠæŸ¥çœ‹æ›´è¯¦ç»†ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>docker rmi [repo[:tag]] &lt;/code>&lt;/p>
&lt;p>åˆ é™¤æœ¬åœ°é•œåƒï¼Œä½¿ç”¨æ–¹æ³•ä¸imagesç›¸åŒï¼Œæ³¨æ„rmiæ˜¯åˆ é™¤é•œåƒï¼Œrmæ˜¯åˆ é™¤å®¹å™¨&lt;/p>
&lt;p>æˆ–è€…æ ¹æ®docker images -q [image]åˆ—å‡ºçš„idè¿›è¡Œåˆ é™¤&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>docker tag source_image[:tag] target_image[:tag] &lt;/code>&lt;/p>
&lt;p>æ”¹é•œåƒæ ‡ç­¾åï¼ˆä¸ç„¶é»˜è®¤ä¼ åˆ°docker hubä¸Šçš„libraryä»“åº“ä¼šè¢«æ‹’ç»ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>docker pull é•œåƒ&lt;/code>&lt;/p>
&lt;p>é»˜è®¤æ‹‰å–çš„æ˜¯docker hubä¸Šçš„Imageï¼Œä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªå®¹å™¨è·‘ä¸€ä¸ªlocal docker registryï¼Œç„¶åè®©å…¶ä»–ä½¿ç”¨äº†docker pullå¹¶æŒ‡å®šäº†docker registryåœ°å€å’Œç«¯å£çš„æœºå­ä»è¿™å°è¿è¡Œäº†docker registryçš„æœºå­ä¸Šæ‹‰é•œåƒ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>docker push é•œåƒ&lt;/code>&lt;/p>
&lt;p>å°†é•œåƒä¸Šä¼ åˆ°docker hubä¸Šçš„ä»“åº“æˆ–æŒ‡å®šä»“åº“&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>docker save -o [taræ–‡ä»¶å] [é•œåƒå] &lt;/code>&lt;/p>
&lt;p>ç”¨æ¥å°†é•œåƒä¿å­˜åˆ°taræ–‡ä»¶å½“ä¸­ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒå
ä¹Ÿå¯ä»¥ä½¿ç”¨gzipå‹ç¼©tarï¼Œä½¿ç”¨docker save [é•œåƒå] | gzip &amp;gt; [xxx.tar.gz]&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>docker load -i [taræ–‡ä»¶åæˆ–gzipç­‰å‹ç¼©æ ¼å¼] &lt;/code>&lt;/p>
&lt;p>ç”¨æ¥è¯»å–æ–‡ä»¶å½¢æˆé•œåƒ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å®¹å™¨å‘½ä»¤">å®¹å™¨å‘½ä»¤&lt;/h3>
&lt;blockquote>
&lt;p>&lt;strong>docker run åˆ›å»ºå®¹å™¨å¹¶è¿è¡Œ&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">docker run [é€‰é¡¹] é•œåƒå [å‚æ•°]
-it è·å–stdinå¹¶è¿è¡Œä¸€ä¸ªä¼ªtty(é»˜è®¤æ˜¯/bin/bashï¼Œå¯åœ¨å‘½ä»¤æœ€åè‡ªå·±æŒ‡å®šshell)
--name ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåå­—(æœ€å¥½åŠ ä¸Šæ–¹ä¾¿äº›ï¼Œä¸ç„¶å°±è¦æ ¹æ®container idæ¥æŒ‡ç¤ºæ˜¯å“ªä¸ªå®¹å™¨)
æœ€å¥½åŠ ä¸Šè‡ªå·±docker hubä¸Šçš„repoåï¼Œè¿™æ ·å¯ä»¥ç›´æ¥pushåˆ°è‡ªå·±çš„repoï¼Œè€Œä¸ç”¨tagå†æ”¹é•œåƒåï¼Œå¦‚ jesse/centos:tag
-d åå°è¿è¡Œï¼Œå¦‚æœå®¹å™¨æ²¡æœ‰å¯¹å¤–æä¾›æœåŠ¡æˆ–è¿è¡Œå‰å°ç¨‹åºåˆ™ä¼šç«‹åˆ»åœæ­¢
-p å°†å®¹å™¨å†…çš„ç«¯å£ä¸host osçš„ç«¯å£ç»‘å®šèµ·æ¥ï¼Œå¦‚-p host_port:container_portå¯ä»¥é€šè¿‡è®¿é—®hostçš„æŸä¸ªç«¯å£æ¥è®¿é—®å®¹å™¨å†…çš„æŸä¸ªæœåŠ¡
-P å¤§å†™P,å°†é•œåƒæŒ‡å®šçš„æš´éœ²ç«¯å£ä¸host osä¸Šçš„éšæœºç«¯å£ç»‘å®šèµ·æ¥ï¼Œä¸€èˆ¬éœ€è¦Dockerfileä¸­æœ‰EXPOSEè¿›è¡Œç»“åˆ
-v å°†å®¹å™¨å†…çš„æŸä¸ªæ–‡ä»¶å¤¹ä¸host osçš„æ–‡ä»¶å¤¹ç»‘å®šèµ·æ¥ï¼ˆå³æ•°æ®åŒæ­¥ï¼Œç›¸å½“äºæŒ‚è½½ï¼‰
1.å¦‚-v host_dir:container_dir æŒ‡å®šè·¯å¾„æŒ‚è½½ï¼Œå¯ä»¥å°†å®¹å™¨å†…çš„æŒ‡å®šæ–‡ä»¶å¤¹æ•°æ®åŒæ­¥åˆ°host osçš„æŒ‡å®šç›®å½•ä¸Šï¼Œè¿™æ ·åˆ é™¤å®¹å™¨æ—¶ä¸è‡³äºæ•°æ®ä¸¢å¤±ï¼ˆæ¯”å¦‚å®¹å™¨å†…è£…æœ‰Mysqlï¼Œè¿™æ ·åˆ é™¤å®¹å™¨å°±ç›¸å½“äºæŠŠæ•´ä¸ªæ•°æ®åº“éƒ½åˆ äº†ï¼‰
2.å¦‚-v volume_name:container_dir å…·åæŒ‚è½½ï¼Œä¼šæŒ‡å®šå·åï¼Œå¯ä»¥é€šè¿‡docker volume inspect volume_nameæŸ¥çœ‹åœ¨Host osä¸Šçš„ç›®å½•ä½ç½®
--volumes-from ç»§æ‰¿å·²æœ‰çš„å®¹å™¨çš„æ•°æ®å·ï¼ˆå…±äº«ç›®å½•ï¼‰
e.g:
docker run --name centos -it centos /bin/bash
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>&lt;strong>docker ps æŸ¥çœ‹å®¹å™¨&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">ä¸æŒ‡å®šå‚æ•°å°±æ˜¯æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨
-a æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬åœæ­¢çš„å®¹å™¨ï¼‰
-q åˆ—å‡ºå®¹å™¨id
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>docker rm [container id æˆ–è€… container name] åˆ é™¤å®¹å™¨&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">ä¸åŠ å‚æ•°éœ€è¦æŒ‡å®šcontainer idæˆ–è€…container nameï¼Œæ­£åœ¨è¿è¡Œçš„å®¹å™¨æ— æ³•åˆ é™¤
-f å¼ºåˆ¶åˆ é™¤å®¹å™¨
docker ps -aq | xargs docker rm -f å¼ºåˆ¶åˆ é™¤æ‰€æœ‰å®¹å™¨
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>docker start å¯åŠ¨å®¹å™¨&lt;/p>
&lt;p>docker restart é‡å¯å®¹å™¨&lt;/p>
&lt;p>docker stop åœæ­¢å®¹å™¨&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>docker logs æŸ¥çœ‹æ—¥å¿—&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">-f å®æ—¶è·Ÿéš
-t æ˜¾ç¤ºæ—¶é—´
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>docker top æ˜¾ç¤ºå®¹å™¨å†…æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>docker inspect æ˜¾ç¤ºå®¹å™¨çš„æ‰€æœ‰&lt;strong>é…ç½®ä¿¡æ¯ï¼ˆå…ƒæ•°æ®ï¼‰d&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>&lt;strong>è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">1.docker &lt;span style="color:#658b00">exec&lt;/span> [container] [command]
åœ¨å®¹å™¨é‡Œè·‘ä¸€ä¸ªå‘½ä»¤
-it ä¸docker runç›¸åŒï¼Œè·å–stdinå¹¶è¿›å…¥ä¼ªtty
e.g:
docker &lt;span style="color:#658b00">exec&lt;/span> -it [container idæˆ–è€…container name] bash â€”â€”â€”â€” åœ¨å®¹å™¨é‡Œè·‘ä¸€ä¸ªæ–°çš„bashå¹¶è¿›å…¥
2.docker attach [container]
ç›´æ¥è¿›å…¥åˆ°containerå½“ä¸­
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>docker cp å°†å®¹å™¨ä¸­çš„æ–‡ä»¶æ‹·è´åˆ°å¤–éƒ¨osæˆ–å°†å¤–éƒ¨osçš„æ–‡ä»¶æ‹·è´è‡³å®¹å™¨ä¸­&lt;/p>
&lt;/blockquote>
&lt;p>&lt;code>docker cp container:path dest_path&lt;/code>&lt;/p>
&lt;blockquote>
&lt;p>docker commit ç”±ç°æœ‰å®¹å™¨åˆ¶ä½œé•œåƒ&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">-a æŒ‡å®šä½œè€…å
-m è¿™æ¬¡æäº¤è¦å‘å¸ƒçš„æ¶ˆæ¯
docker commit [é€‰é¡¹] container [image[:tag]]
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å·å‘½ä»¤">å·å‘½ä»¤&lt;/h3>
&lt;blockquote>
&lt;p>docker volume&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">ç‰¹åˆ«è¯´æ˜ï¼šä¸åŒçš„å®¹å™¨å¯ä»¥æŒ‡å®šç›¸åŒçš„volume
ls åˆ—å‡ºæ‰€æœ‰çš„å·
inspect æŸ¥çœ‹æŒ‡å®šå·çš„ä¿¡æ¯ï¼ˆå¯æŸ¥çœ‹æŒ‚è½½åœ¨host osä¸Šå…·ä½“å“ªä¸ªä½ç½®ï¼‰
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="dockeråŸºæœ¬å‘½ä»¤å›¾">DockeråŸºæœ¬å‘½ä»¤å›¾&lt;/h2>
&lt;p>&lt;img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gob60cd4z5j316t0u0k9j.jpg" alt="image-20200812163714285">&lt;/p>
&lt;h2 id="dockerå±‚çš„æ¦‚å¿µ">Dockerå±‚çš„æ¦‚å¿µ&lt;/h2>
&lt;p>&lt;img src="https://timgsa.baidu.com/timg?image&amp;amp;quality=80&amp;amp;size=b9999_10000&amp;amp;sec=1597383379693&amp;amp;di=8a718adcadd59dbfafaf89136bcf6efe&amp;amp;imgtype=0&amp;amp;src=http%3A%2F%2Fimg2020.cnblogs.com%2Fblog%2F2030366%2F202006%2F2030366-20200630103737429-2119801149.png" alt="img">&lt;/p>
&lt;h2 id="dockerfileå‘½ä»¤">Dockerfileå‘½ä»¤&lt;/h2>
&lt;p>tips:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å‘½ä»¤æœ€å¥½å¤§å†™ï¼Œå†™ä¸€ä¸ªå‘½ä»¤ä»£è¡¨æ„å»º&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é€‰ç”¨åˆé€‚çš„é•œåƒï¼Œä¸è¦é€‰ç”¨è¿‡å¤§çš„çˆ¶é•œåƒä»è€Œæ„å»ºå‡ºè‡ƒè‚¿åºå¤§çš„é•œåƒï¼Œé€‰ç”¨å°å·§çš„çˆ¶é•œåƒï¼ˆå¦‚alpineã€busyboxã€debianç­‰ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå½¢å¼ï¼ˆå¤šä¸ªFROMå‘½ä»¤ï¼Œä»¥æœ€åä¸€ä¸ªFROMä¸ºæ ¹ï¼‰ï¼Œä¾‹å¦‚å°†ç¼–è¯‘ç¯å¢ƒå’Œæ„å»ºç¯å¢ƒåˆ†ç¦»å¼€æ¥å¯ä»¥é¿å…é•œåƒè¿‡å¤§ï¼ˆå› ä¸ºæ„å»ºç¯å¢ƒåªéœ€è¦ç¼–è¯‘å‡ºæ¥çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œä¸éœ€è¦ç¼–è¯‘æ‰€éœ€çš„åº“å’Œå‘½ä»¤ç­‰ä¸€å¤§å †æ–‡ä»¶ï¼‰&lt;/strong>&lt;/p>
&lt;p>COPY &amp;ndash;from=æŒ‡å®šçš„é˜¶æ®µå&lt;/p>
&lt;p>å¯ä»¥å°†æŒ‡å®šé˜¶æ®µä¸­ç¼–è¯‘å¥½çš„æ–‡ä»¶æ‹·è´åˆ°å½“å‰æ„å»ºç¯å¢ƒä¸­ï¼Œç”šè‡³å¯ä»¥ä»æŒ‡å®šé•œåƒä¸­è¿›è¡Œæ‹·è´&lt;/p>
&lt;p>e.g:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span style="color:#228b22"># ç¼–è¯‘é˜¶æ®µ å‘½åä¸º builder&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">FROM&lt;/span>&lt;span style="color:#cd5555"> golang:1.10.3 as builder&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span> &lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>&lt;span style="color:#228b22"># ... çœç•¥&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span> &lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>&lt;span style="color:#228b22"># è¿è¡Œé˜¶æ®µ&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">FROM&lt;/span>&lt;span style="color:#cd5555"> scratch&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span> &lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>&lt;span style="color:#228b22"># ä»ç¼–è¯‘é˜¶æ®µçš„ä¸­æ‹·è´ç¼–è¯‘ç»“æœåˆ°å½“å‰é•œåƒä¸­&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">COPY&lt;/span> --from=builder /build/server /&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>&lt;strong>docker build&lt;/strong> æ ¹æ®Dockerfileæ„å»ºé•œåƒå‘½ä»¤&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">docker build [é€‰é¡¹] URL|PATH
-f è¦ç”¨å“ªä¸€ä¸ªDockerfileï¼ˆæŒ‡å®šPathï¼‰
-t ç»™é•œåƒå–åå­—ï¼Œå¯åŠ tagï¼ˆname:tagï¼‰
e.g:
docker build -f Dockerfile -t name:tag . å°†å½“å‰çš„æ–‡ä»¶å¤¹ä½œä¸ºç¯å¢ƒæ„é€ é•œåƒ
å¯ä»¥ä»¥PATHæŒ‡å®šçš„ç›®å½•ä½œä¸ºä¸Šä¸‹æ–‡ç¯å¢ƒæ¥æ„å»ºé•œåƒï¼Œæœ€å¥½æ˜¯ä»¥ç©ºç›®å½•ä¸ºä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œé‡Œé¢åªæ”¾Dockerfileï¼ˆé™¤éæ˜¯æ”¾ç”Ÿæˆé•œåƒå¿…é¡»çš„æ–‡ä»¶ï¼Œå› ä¸ºä¸Šä¸‹æ–‡è¿‡å¤§çš„è¯å‘é€ç»™daemonä¼šå¾ˆæ…¢ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯æŒ‡å®šURLä½œä¸ºæ„å»ºç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯Git Repositoryï¼Œæ¯”å¦‚Github
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>&lt;strong>FROM&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span style="color:#8b008b;font-weight:bold">FROM&lt;/span>&lt;span style="color:#cd5555"> image&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>Dockerfileéƒ½è¦ä»¥FROMå¼€å§‹ï¼Œæ„å»ºä¸€ä¸ªåŸºæœ¬é•œåƒ&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>e.g:&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">FROM&lt;/span>&lt;span style="color:#cd5555"> scratch&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>è¿™æ˜¯Docker Hubä¸Šå¤§å¤šæ•°é•œåƒçš„é€‰æ‹©ï¼Œæ„å»ºä¸€ä¸ªé»˜è®¤é•œåƒ&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>&lt;strong>RUN&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span style="color:#8b008b;font-weight:bold">RUN&lt;/span> shell_command&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>buildé•œåƒæ—¶æ‰€è¦æ‰§è¡Œçš„å‘½ä»¤&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>ä¸€èˆ¬ä»¥æ‰§è¡Œshellå‘½ä»¤çš„æ ¼å¼æœ€ä½³,é»˜è®¤æ˜¯ä»¥RUN /bin/sh -c commandå½¢å¼æ‰§è¡Œçš„&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>ä¸€è¡Œå†™ä¸ä¸‹æ—¶å¯ä»¥é€šè¿‡&lt;span style="color:#cd5555">\æ¢&lt;/span>è¡Œ,æ‰§è¡Œå¤šä¸ªå‘½ä»¤æœ€å¥½ç”¨&amp;amp;&amp;amp;æ¥ç›¸è¿ï¼Œè¿™æ ·å¯ä»¥å°‘äº›ä¸€äº›RUNï¼Œå› ä¸ºRUNã€ADDã€COPYè¿™äº›å‘½ä»¤å†™ä¸€ä¸ªå‘½ä»¤å°±ä¼šåŠ ä¸€å±‚ï¼Œè¿™æ ·ä¼šä½¿å®¹å™¨ä¸é‚£ä¹ˆè‡ƒè‚¿åºå¤§&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>CMD&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span style="color:#8b008b;font-weight:bold">CMD&lt;/span> [&lt;span style="color:#cd5555">&amp;#34;executable&amp;#34;&lt;/span>,&lt;span style="color:#cd5555">&amp;#34;param1&amp;#34;&lt;/span>,&lt;span style="color:#cd5555">&amp;#34;param2&amp;#34;&lt;/span>]ä¸€èˆ¬ä»¥è¿™ç§æ ¼å¼æœ€ä½³ï¼ˆæ³¨æ„éƒ½è¦åŒå¼•å·ï¼Œå› ä¸ºæ˜¯JSONæ ¼å¼ï¼‰&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">CMD&lt;/span>æ˜¯å®¹å™¨è¿è¡Œæ—¶æ‰€è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ—¨åœ¨æŒ‡å®šrunå®¹å™¨æ—¶æ‰€è¦åšçš„é»˜è®¤åŠ¨ä½œï¼Œè·Ÿdocker runåè·Ÿä¸€ä¸ªcommandåŸç†æ˜¯ä¸€æ ·çš„&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>ç‰¹åˆ«è¯´æ˜ï¼šDockerfileä¸­åªèƒ½æœ‰ä¸€ä¸ªCMD,å¦‚æœæœ‰å¤šä¸ªCMDï¼Œåªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆ&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>ENTRYPOINT&lt;/p>
&lt;/blockquote>
&lt;pre>&lt;code>ä½¿ç”¨æ–¹æ³•ä¸CMDç›¸åŒï¼Œä½†æ˜¯docker runåé¢å¦‚æœè·Ÿcommandä¼šæŠŠCMDè¦æ‰§è¡Œçš„å‘½ä»¤è¦†ç›–æ‰ï¼ŒENTRYPOINTè¦æ‰§è¡Œçš„å‘½ä»¤ä¸ä¼šï¼Œç”šè‡³èƒ½ç»™ENTRYPOINTè¿½åŠ å‚æ•°
&lt;/code>&lt;/pre>&lt;blockquote>
&lt;p>LABEL&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span style="color:#8b008b;font-weight:bold">LABEL&lt;/span> &lt;span style="color:#00688b">key&lt;/span>=&lt;span style="color:#cd5555">&amp;#34;value&amp;#34;&lt;/span> &lt;span style="color:#00688b">key&lt;/span>=&lt;span style="color:#cd5555">&amp;#34;value&amp;#34;&lt;/span> ... &lt;span style="color:#00688b">key&lt;/span>=&lt;span style="color:#cd5555">&amp;#34;value&amp;#34;&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>ç»™é•œåƒåŠ å…ƒæ•°æ®ï¼Œä»¥é”®å€¼å¯¹çš„å½¢å¼å¤šç»„è¿½åŠ ï¼Œå¯ä»¥é€šè¿‡&lt;span style="color:#cd5555">\æ¢&lt;/span>è¡Œ,æ¯”å¦‚åœ¨LABELé‡ŒåŠ ä¸Šmaintainerï¼ˆç»´æŠ¤è€…ï¼‰ç­‰ä¿¡æ¯&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>å¯ä»¥é€šè¿‡docker inspectæ¥æŸ¥çœ‹&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>EXPOSE&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-dockerfile" data-lang="dockerfile">è®©è¿è¡Œæ—¶çš„å®¹å™¨åœ¨æŒ‡å®šç«¯å£è¿›è¡Œç›‘å¬ï¼Œä¹Ÿå°±æ˜¯æš´éœ²ç«¯å£,é»˜è®¤æ˜¯tcpï¼Œå¯ä»¥æŒ‡å®šudpï¼Œå¦‚EXPOSE 53/udp&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>å¯ä»¥é€šè¿‡docker runä¸­çš„-pæ¥è¦†ç›–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡-På°†host osä¸Šçš„éšæœºç«¯å£ä¸æš´éœ²çš„ç«¯å£è¿›è¡Œç»‘å®š&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>&lt;strong>ENV&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-dockerfile" data-lang="dockerfile">ä¸ºè¿è¡Œçš„å®¹å™¨è®¾ç½®ç¯å¢ƒå˜é‡&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ENV&lt;/span> key value ä¸€ä¸ªENVè®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>ADD&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span style="color:#8b008b;font-weight:bold">ADD&lt;/span> &amp;lt;src&amp;gt;...&amp;lt;dest&amp;gt;&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>å°†srcçš„æ–‡ä»¶ï¼Œæ–‡ä»¶å¤¹æ‹·è´åˆ°destï¼Œsrcå¯ä»¥æ˜¯ä¸€ä¸ªremote URLï¼Œdestå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œå¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„é‚£å°±æ˜¯æ‹·è´åˆ°WORKDIR/ç›¸å¯¹è·¯å¾„ä¸‹&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>ç‰¹åˆ«è¯´æ˜ï¼šdestå¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œæƒ³æŠŠæ–‡ä»¶æ‹·è´åˆ°destæ–‡ä»¶å¤¹ä¸‹ï¼Œå¿…é¡»åœ¨æœ€ååŠ /&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">COPY&lt;/span>æŒ‡ä»¤ä¸ADDç”¨æ³•ç›¸åŒï¼Œä½†æ˜¯ADDå¯ä»¥ä»è¿œç¨‹urlä¸Šæ‹·è´ï¼ŒCOPYåªèƒ½æ‹·è´æœ¬åœ°å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>WORKDIR&lt;/p>
&lt;/blockquote>
&lt;pre>&lt;code>è®¾ç½®è¿›å…¥å®¹å™¨æ—¶çš„å·¥ä½œç›®å½•ï¼Œèƒ½ä½¿ç”¨ENVè®¾ç½®çš„ç¯å¢ƒå˜é‡
&lt;/code>&lt;/pre>&lt;h2 id="å®¹å™¨ç½‘ç»œé…ç½®">å®¹å™¨ç½‘ç»œé…ç½®&lt;/h2>
&lt;blockquote>
&lt;p>docker network&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">connect å°†ä¸€ä¸ªå®¹å™¨éƒ¨ç½²è¿›æŸä¸ªé…ç½®çš„ç½‘ç»œå½“ä¸­ï¼Œé€šè¿‡lsæŸ¥çœ‹ç½‘ç»œå
ls åˆ—å‡ºæ‰€æœ‰ç½‘ç»œ
inspect æŸ¥çœ‹ç½‘ç»œæè¿°ä¿¡æ¯
create åˆ›å»ºç½‘ç»œï¼Œå¯é€šè¿‡-dæŒ‡å®šæ–¹å¼ï¼Œæœ‰bridgeï¼Œhostç­‰ç­‰ï¼Œå¯é€šè¿‡--subnetæŒ‡å®šå­ç½‘å’Œåç¼€
...
è¦è®©å®¹å™¨ä½¿ç”¨docker networkåˆ›å»ºçš„ç½‘ç»œï¼Œåœ¨docker runæ—¶æŒ‡å®š--netå³å¯
&lt;/code>&lt;/pre>&lt;/div>- http://example.org/posts/docker%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/ - æœ¬ç«™éµå¾ª CC-BY-NC 4.0 åè®®</description></item><item><title>kubectlå¸¸ç”¨å‘½ä»¤</title><link>http://example.org/posts/kubectl%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</link><pubDate>Sun, 07 Mar 2021 10:30:17 +0800</pubDate><guid>http://example.org/posts/kubectl%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</guid><description>Jesse's Blog http://example.org/posts/kubectl%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ -&lt;h1 id="k8så‘½ä»¤">k8så‘½ä»¤&lt;/h1>
&lt;h2 id="å¼•è¨€">å¼•è¨€&lt;/h2>
&lt;p>æœ¬æ–‡åˆ—ä¸¾äº†ä¸€äº›kubectlçš„å¸¸ç”¨å‘½ä»¤ä»¥åŠå…¶å¯¹åº”çš„å¸¸ç”¨å‚æ•°&lt;/p>
&lt;p>kubectlçš„è¯¦ç»†ä¿¡æ¯å¯å‚ç…§ï¼šhttps://kubernetes.io/docs/reference/kubectl/overview/&lt;/p>
&lt;p>å¦‚æœç†Ÿæ‚‰äº†kubectlçš„æœ‹å‹ï¼Œå¯¹äºç»å¸¸æ€§çš„&lt;code>kubectl get &lt;/code>å’Œ&lt;code>kubectl describe&lt;/code>æŸ¥æ‰¾resourceæ„Ÿåˆ°ç¹çï¼Œç¬”è€…åœ¨è¿™é‡Œæ¨èä¸€æ¬¾å¼€æºçš„å¢å¼ºå‹kubectlè½¯ä»¶k9sï¼šhttps://github.com/derailed/k9sï¼Œç›¸ä¿¡å¯¹äºvimç†Ÿæ‚‰çš„æœ‹å‹ä¼šå–œæ¬¢è¿™æ¬¾å¼€æºè½¯ä»¶ï¼Œè€Œä¸”å¯ä»¥å½“ç®€ç•¥çš„dashboardä½¿ç”¨&lt;/p>
&lt;h2 id="kubectl">kubectl&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>&lt;code>kubectl create -f [yamlæˆ–è€…jsonæ–‡ä»¶]&lt;/code>&lt;/p>
&lt;p>é€šè¿‡yamlæˆ–è€…jsonæ–‡ä»¶åˆ›å»ºä¸€ä¸ªç»„ä»¶&lt;/p>
&lt;p>-n æŒ‡å®šå‘½åç©ºé—´ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤æ˜¯åœ¨defaultå‘½åç©ºé—´ä¸‹ï¼Œå…¶ä»–å‘½ä»¤ä¹Ÿä¸€æ ·&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>kubectl get [ç»„ä»¶] [ç»„ä»¶å]&lt;/code>&lt;/p>
&lt;p>è·å–ç»„ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚æœæƒ³è·å–è¯¦ç»†ä¿¡æ¯ç”¨kubectl describe&lt;/p>
&lt;p>-o wide æ˜¾ç¤ºæ›´å¤šä¿¡æ¯ï¼Œ-o yaml ä»¥yamlæ ¼å¼æ˜¾ç¤ºç»„ä»¶ä¿¡æ¯&lt;/p>
&lt;p>&amp;ndash;show-labels å¤šæ˜¾ç¤ºæ ‡ç­¾&lt;/p>
&lt;p>-l æ ‡ç­¾é”®=å€¼ æ ¹æ®æ ‡ç­¾æ¥ç­›é€‰å‡ºpodåŸºæœ¬ä¿¡æ¯ï¼Œå¤šä¸ªé”®å€¼å¯¹ç”¨é€—å·åˆ†éš”&lt;/p>
&lt;p>-L [æ ‡ç­¾å] å¤šæ˜¾ç¤ºæŒ‡å®šæ ‡ç­¾åçš„æ ‡ç­¾åˆ—ï¼Œå¤šä¸ªæ ‡ç­¾ç”¨é€—å·åˆ†éš”&lt;/p>
&lt;p>&amp;ndash;all-namespaces åˆ—å‡ºæ‰€æœ‰å‘½åç©ºé—´çš„ç»„ä»¶&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>kubectl logs [podname]&lt;/code>&lt;/p>
&lt;p>æŸ¥çœ‹podå†…å®¹å™¨çš„æ—¥å¿—è¾“å‡ºï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå®¹å™¨ä¸ç”¨æŒ‡å®šå®¹å™¨åï¼Œå¦‚æœæœ‰å¤šä¸ªå®¹å™¨ï¼Œæƒ³æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„æ—¥å¿—éœ€è¦-cå‚æ•°æŒ‡å®š&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>kubectl label [ç»„ä»¶] [ç»„ä»¶å] key=value [--overwrite]&lt;/code>&lt;/p>
&lt;p>ä¿®æ”¹æˆ–æ·»åŠ ç»„ä»¶çš„æ ‡ç­¾ï¼Œç”¨key=valueå½¢å¼ï¼Œå¦‚æœè¦å¤å†™ä¹‹å‰çš„æ ‡ç­¾ï¼Œéœ€è¦å¤šåŠ ä¸€ä¸ª&amp;ndash;overwrite&lt;/p>
&lt;p>å¦‚æœè¦åˆ é™¤ä¹‹å‰çš„æ ‡ç­¾ï¼Œç›´æ¥åœ¨keyåè·Ÿä¸€ä¸ªå‡å·å³å¯ï¼ˆå³key-ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>kubectl delete [ç»„ä»¶] [ç»„ä»¶å1] [ç»„ä»¶å2] [...]&lt;/code>&lt;/p>
&lt;p>åˆ é™¤ç»„ä»¶&lt;/p>
&lt;p>-all åˆ é™¤æ‰€æœ‰ç»„ä»¶&lt;/p>
&lt;p>æ³¨ï¼šåˆ é™¤å‘½åç©ºé—´ï¼Œé‡Œé¢çš„ç»„ä»¶ä¹Ÿä¼šä¸€å¹¶åˆ é™¤&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>kubectl scale [ç»„ä»¶] [ç»„ä»¶å] --replicas&lt;/code>&lt;/p>
&lt;p>è®¾ç½®ç»„ä»¶ç®¡ç†çš„èµ„æºæ•°é‡ï¼Œç»„ä»¶å¯ä»¥æ˜¯Deployment, ReplicaSet, Replication Controller, StatefulSet or job&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>kubectl exec [pod-name] -- [podä¸­çš„å®¹å™¨ä¸­éœ€è¦æ‰§è¡Œçš„å‘½ä»¤]&lt;/code>&lt;/p>
&lt;p>åœ¨æŒ‡å®špodä¸­çš„å®¹å™¨ä¸­è¿è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œè¿™é‡Œ&amp;ndash;è¡¨ç¤ºkubectlçš„ç»“æŸï¼Œå¦‚æœä¸å†™çš„è¯å¯èƒ½ä¼šè¢«kubectlå½“æˆå‚æ•°å¤„ç†ï¼Œä¼šé€ æˆæ­§ä¹‰&lt;/p>
&lt;p>-c æŒ‡å®šå®¹å™¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>kubectl explain [source]&lt;/code>&lt;/p>
&lt;p>æŸ¥çœ‹èµ„æºæ–‡æ¡£ï¼ŒåŒ…æ‹¬èµ„æºçš„manifestæœ‰å“ªäº›å­—æ®µï¼ŒapiVersionæ˜¯å¤šå°‘ç­‰ç­‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="ä¿®æ”¹sourceé…ç½®çš„å‘½ä»¤">ä¿®æ”¹sourceé…ç½®çš„å‘½ä»¤&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>kubectl apply -f [æ–‡ä»¶]&lt;/code>&lt;/p>
&lt;p>ä¿®æ”¹kubernetesèµ„æºï¼Œå¦‚æœæ²¡æœ‰åˆ›å»ºèµ„æºä¼šåˆ›å»ºèµ„æºï¼Œå¦‚æœå·²ç»åˆ›å»ºäº†èµ„æºåˆ™è¿›è¡Œä¿®æ”¹ï¼Œæ–‡ä»¶å¯ä»¥æ˜¯yamlæ–‡ä»¶&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>kubectl edit [source] [source-name]&lt;/code>&lt;/p>
&lt;p>ç”¨viç¼–è¾‘sourceçš„yamlé…ç½®&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>kubectl patch [source] [source-name] -p&lt;/code>&lt;/p>
&lt;p>ä½¿ç”¨JSONæ ¼å¼ä¿®æ”¹æˆ–æ·»åŠ sourceå±æ€§&lt;/p>
&lt;p>&lt;strong>æ”¹å•ä¸ªå±æ€§çš„æ—¶å€™å¾ˆæ–¹ä¾¿ï¼Œä¸ç”¨åƒeditä¸€æ ·è¦æ‰“å¼€Yamlæ‰¾åˆ°å¯¹åº”å±æ€§&lt;/strong>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>kubectl set image [source] [source-name] [container-name]=[new image]&lt;/code>&lt;/p>
&lt;p>å°†sourceä¸­çš„å®¹å™¨é•œåƒä¿®æ”¹ä¸ºæ–°çš„é•œåƒ&lt;/p>
&lt;/li>
&lt;/ul>
- http://example.org/posts/kubectl%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ - æœ¬ç«™éµå¾ª CC-BY-NC 4.0 åè®®</description></item><item><title>K8s Resourceæ¦‚æ</title><link>http://example.org/posts/k8s-resource%E6%A6%82%E6%9E%90/</link><pubDate>Sun, 07 Mar 2021 10:20:30 +0800</pubDate><guid>http://example.org/posts/k8s-resource%E6%A6%82%E6%9E%90/</guid><description>Jesse's Blog http://example.org/posts/k8s-resource%E6%A6%82%E6%9E%90/ -&lt;h1 id="k8s-resourceæ¦‚æ">K8s Resourceæ¦‚æ&lt;/h1>
&lt;h2 id="å¼•è¨€">å¼•è¨€&lt;/h2>
&lt;p>æœ¬æ–‡å‚ç…§ã€ŠKubernetes in Actionä¸­æ–‡ç‰ˆã€‹åŠå…¶ä¸€äº›ç½‘ä¸Šèµ„æ–™ï¼Œå¯¹K8sä¸­åŸºç¡€çš„Resourceè¿›è¡Œäº†æ¦‚æã€‚æœ¬æ–‡ä¼šæŒç»­æ›´æ–°ã€‚&lt;/p>
&lt;h2 id="pod">pod&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>ä¸ºä»€ä¹ˆéœ€è¦pod?&lt;/p>
&lt;p>ä¸»è¦ç›®çš„æ˜¯ç”±å¤šä¸ªè¿›ç¨‹ç»„æˆçš„ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå¤šä¸ªè¿›ç¨‹ä¸èƒ½èšé›†åœ¨ä¸€ä¸ªå®¹å™¨ä¸­è¿è¡Œ**ï¼ˆå®¹å™¨çš„è®¾è®¡ç›®çš„å°±æ˜¯åªè¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œå¦‚æœå®¹å™¨ä¸­è¿è¡Œå¤šä¸ªä¸ç›¸å…³çš„è¿›ç¨‹ï¼Œæ¯”å¦‚éœ€è¦åŒ…å«ä¸€ç§è¿›ç¨‹å´©æºƒåèƒ½å¤Ÿé‡å¯çš„æœºåˆ¶ï¼ŒåŒæ—¶å°†è¿›ç¨‹çš„æ´»åŠ¨è®°å½•è®°å½•åˆ°ç›¸åŒçš„æ ‡å‡†è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬å¾ˆéš¾ç¡®å®šæ¯ä¸ªè¿›ç¨‹åˆ†åˆ«è®°å½•äº†ä»€ä¹ˆï¼‰ï¼Œæˆ‘ä»¬ç”¨podæ¥å°è£…å®¹å™¨ï¼Œå°†å…¶ä½œä¸ºk8sçš„åŸºæœ¬å•ä½**ï¼Œæ—¢å¯ä»¥åšåˆ°ä¸€ä¸ªè¿›ç¨‹å•ç‹¬è¿è¡Œäºä¸€ä¸ªå®¹å™¨å½“ä¸­ï¼Œå®¹å™¨ä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œä¿æŒäº†å®¹å™¨çš„ç‰¹æ€§ï¼Œåˆèƒ½åŒæ—¶è¿è¡Œä¸€äº›å¯†åˆ‡ç›¸å…³çš„è¿›ç¨‹ï¼Œä¸ºä»–ä»¬æä¾›ç›¸åŒçš„ç¯å¢ƒã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>podä¸­çš„å®¹å™¨å…±äº«network namespaceï¼Œå®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ä¹‹é—´èƒ½å¤Ÿé€šè¿‡ç«¯å£æ¥ç›¸äº’é€šä¿¡ï¼ˆåŒä¸€ä¸ªpodä¸­çš„å®¹å™¨æ‹¥æœ‰ç›¸åŒçš„loopbackç½‘è·¯æ¥å£ï¼Œå¯ä»¥é€šè¿‡å‘å¾€localhostä¸å…¶ä»–å®¹å™¨ä¸­çš„è¿›ç¨‹ç›¸äº’é€šä¿¡ï¼‰&lt;/p>
&lt;ul>
&lt;li>å¦‚ä½•å†³å®šå¤šä¸ªå®¹å™¨æ˜¯å¦è¦æ”¾å…¥åŒä¸€ä¸ªpodä¸­ï¼Ÿ
&lt;ul>
&lt;li>å®ƒä»¬éœ€è¦ä¸€èµ·è¿è¡Œè¿˜æ˜¯å¯ä»¥åœ¨ä¸åŒä¸»æœºä¸Šè¿è¡Œ&lt;/li>
&lt;li>å®ƒä»¬ä»£è¡¨çš„æ˜¯ä¸€ä¸ªæ•´ä½“è¿˜æ˜¯ç›¸äº’ç‹¬ç«‹çš„ç»„ä»¶&lt;/li>
&lt;li>å®ƒä»¬å¿…é¡»ä¸€èµ·æ‰©ç¼©å®¹è¿˜æ˜¯å¯ä»¥åˆ†åˆ«è¿›è¡Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="liveness-probe--readiness-probe">liveness probe &amp;amp; readiness probe&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>liveness probeâ€”â€”å­˜æ´»æ¢é’ˆï¼ˆ&lt;strong>åœ¨pod runningæ—¶æ£€æµ‹&lt;/strong>ï¼‰&lt;/p>
&lt;p>é€šè¿‡ TCPã€HTTP æˆ–è€…å‘½ä»¤è¡Œæ–¹å¼å¯¹åº”ç”¨å°±ç»ªè¿›è¡Œæ£€æµ‹ã€‚å¯¹äº HTTP ç±»å‹æ¢é’ˆï¼ŒKubernetes ä¼šå®šæ—¶è®¿é—®è¯¥åœ°å€ï¼Œå¦‚æœè¯¥åœ°å€çš„è¿”å›ç ä¸åœ¨ 200 åˆ° 400 ä¹‹é—´ï¼Œåˆ™è®¤ä¸ºè¯¥å®¹å™¨ä¸å¥åº·ï¼Œä¼šæ€æ­»è¯¥å®¹å™¨é‡å»ºæ–°çš„å®¹å™¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>readiness probeâ€”â€”å°±ç»ªæ¢é’ˆï¼ˆ&lt;strong>åœ¨podå°±ç»ªå‰æ£€æµ‹&lt;/strong>ï¼‰&lt;/p>
&lt;p>å¯¹äºå¯åŠ¨ç¼“æ…¢çš„åº”ç”¨ï¼Œä¸ºäº†é¿å…åœ¨åº”ç”¨å¯åŠ¨å®Œæˆä¹‹å‰å°†æµé‡å¯¼å…¥ã€‚Kubernetes æ”¯æŒä¸šåŠ¡å®¹å™¨æä¾›ä¸€ä¸ª readiness æ¢é’ˆï¼Œå¯¹äº HTTP ç±»å‹æ¢é’ˆï¼ŒKubernetes ä¼šå®šæ—¶è®¿é—®è¯¥åœ°å€ï¼Œå¦‚æœè¯¥åœ°å€çš„è¿”å›ç ä¸åœ¨ 200 åˆ° 400 ä¹‹é—´ï¼Œåˆ™è®¤ä¸ºè¯¥å®¹å™¨æ— æ³•å¯¹å¤–æä¾›æœåŠ¡ï¼Œä¸ä¼šæŠŠè¯·æ±‚è°ƒåº¦åˆ°è¯¥å®¹å™¨ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å®¹å™¨é‡å¯ç­–ç•¥">å®¹å™¨é‡å¯ç­–ç•¥&lt;/h3>
&lt;ul>
&lt;li>Always ï¼š å®¹å™¨å¤±æ•ˆæ—¶ï¼Œkubelet è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ï¼ˆ&lt;strong>å°±ç®—æˆåŠŸæ‰§è¡Œå®Œå®¹å™¨ä¹Ÿä¼šé‡å¯&lt;/strong>ï¼‰&lt;/li>
&lt;li>OnFailure ï¼š å®¹å™¨ç»ˆæ­¢è¿è¡Œä¸”é€€å‡ºç ä¸ä¸º0æ—¶é‡å¯&lt;/li>
&lt;li>Never ï¼š ä¸è®ºçŠ¶æ€ä¸ºä½•ï¼Œ kubelet éƒ½ä¸é‡å¯è¯¥å®¹å™¨&lt;/li>
&lt;/ul>
&lt;h3 id="èŠ‚ç‚¹äº²å’Œæ€§">èŠ‚ç‚¹äº²å’Œæ€§&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>nodeAffinity:&lt;/p>
&lt;p>çº¦æŸpodå¯ä»¥è°ƒåº¦åˆ°å“ªäº›èŠ‚ç‚¹ï¼Œæ˜¯å¯¹nodeSelectorçš„ä¸€ç§åŠ å¼ºã€‚æœ‰ä»¥ä¸‹ä¸¤ç§å­—æ®µï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>requiredDuringSchedulingIgnoredDuringExecutionï¼ˆç¡¬é™åˆ¶ï¼‰ï¼š&lt;/p>
&lt;p>è¡¨ç¤ºnode&lt;strong>å¿…é¡»&lt;/strong>æ»¡è¶³&lt;strong>podæŒ‡å®šæ¡ä»¶&lt;/strong>(matchExpressionï¼‰æ‰èƒ½å°†podè°ƒåº¦åˆ°è¿™äº›èŠ‚ç‚¹ä¸Šï¼Œå¦åˆ™&lt;strong>ä¸è¿›è¡Œè°ƒåº¦&lt;/strong>ï¼ˆä¸nodeSelectorç›¸åŒï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>preferredDuringSchedulingIgnoredDuringExecutionï¼ˆè½¯é™åˆ¶ï¼‰ï¼š&lt;/p>
&lt;p>&lt;strong>åå¥½&lt;/strong>å°†podè°ƒåº¦åˆ°æ»¡è¶³podæŒ‡å®šæ¡ä»¶çš„nodeä¸Šï¼Œå¦‚æœèŠ‚ç‚¹ä¸æ»¡è¶³ä¹Ÿæ²¡å…³ç³»ï¼Œ&lt;strong>è¿˜æ˜¯å¯ä»¥å°†podè°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Š&lt;/strong>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>IgnoredDuringExecution&lt;/strong>è¡¨ç¤ºçºµä½¿èŠ‚ç‚¹æ ‡ç­¾å‘ç”Ÿæ”¹å˜ï¼Œpodä»å¯ä»¥åœ¨èŠ‚ç‚¹ä¸Šç»§ç»­è¿è¡Œ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="podé—´äº²å’Œæ€§">podé—´äº²å’Œæ€§&lt;/h3>
&lt;p>&lt;strong>å¦‚æœæ˜¯å¤§é›†ç¾¤ä¸å»ºè®®ä½¿ç”¨podäº²å’Œï¼Œå¦åˆ™éœ€è¦æ¶‰åŠåˆ°å¤§é‡çš„å¤„ç†&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>podAffinityå’ŒpodAntiAffinityï¼ˆpodäº²å’Œå’Œåäº²å’Œï¼‰:&lt;/p>
&lt;p>&lt;strong>æ—¢éœ€è¦nodeåŒ¹é…ï¼Œåˆéœ€è¦podåŒ¹é…&lt;/strong>ï¼Œä»–çš„è§„åˆ™æ˜¯ï¼šå¦‚æœ X èŠ‚ç‚¹ä¸Šå·²ç»è¿è¡Œäº†ä¸€ä¸ªæˆ–å¤šä¸ª æ»¡è¶³è§„åˆ™ Y çš„podï¼Œåˆ™è¿™ä¸ª pod åº”è¯¥ï¼ˆæˆ–è€…åœ¨éäº²å’Œçš„æƒ…å†µä¸‹ä¸åº”è¯¥ï¼‰è¿è¡Œåœ¨ X èŠ‚ç‚¹ï¼ŒXå’ŒYéƒ½æ˜¯æ ‡ç­¾ï¼ˆXæ˜¯nodeçš„æ ‡ç­¾ï¼Œå¯ä»¥æ˜¯k8så†…ç½®æ ‡ç­¾ä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè¡¨ç¤ºä¸€ä¸ª&lt;strong>æ‹“æ‰‘åŸŸ&lt;/strong>ï¼ŒYæ˜¯podæ ‡ç­¾ï¼‰&lt;/p>
&lt;p>å­—æ®µä¸nodeAffinityç›¸åŒï¼Œéœ€è¦åœ¨podçš„Specä¸­å†™æ˜&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="æ±¡ç‚¹å’Œå®¹å¿åº¦">æ±¡ç‚¹å’Œå®¹å¿åº¦&lt;/h3>
&lt;p>æ±¡ç‚¹å…¶å®å°±æ˜¯èŠ‚ç‚¹çš„&lt;strong>åäº²å’Œæ€§&lt;/strong>ï¼Œç”¨å¤„åœ¨äºæŸäº›podéœ€è¦è°ƒåº¦åˆ°ç‰¹å®šèŠ‚ç‚¹ä¸Šï¼Œè€Œå…¶ä»–podä¸èƒ½è°ƒåº¦åˆ°è¿™äº›èŠ‚ç‚¹ä¸Šï¼ˆå°±éœ€è¦ç»™è¿™äº›podåŠ ä¸Šå®¹å¿åº¦ï¼‰ï¼Œæˆ–è€…æ˜¯æŸäº›èŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œéœ€è¦é©±é€æŸäº›podï¼Œæˆ–è€…åŠ ä¸Šå®¹å¿åº¦ï¼Œå®¹å¿åœ¨æŒ‡å®šæ—¶é—´å†…èŠ‚ç‚¹å¯ä»¥æ¢å¤ï¼Œå¦åˆ™å°±è¦è¢«é©±é€&lt;/p>
&lt;p>ä½¿ç”¨ kubectl taint nodes node1 key*value:NoScheduleå‘½ä»¤ç»™nodeåŠ ä¸Štaintï¼Œç”¨æ³•ç±»ä¼¼kubectl labelï¼Œè¦è¯´æ˜çš„æ˜¯NoScheduleï¼Œæœ‰ä»¥ä¸‹å‡ ç§åŠ¨ä½œï¼š&lt;/p>
&lt;ul>
&lt;li>NoScheduleï¼Œå¦‚æœnodeæ‰“ä¸Šäº†taintï¼Œä¸”podæ²¡æœ‰æŒ‡æ˜tolerationsï¼Œåˆ™podä¸ä¼šè¢«è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ä¸Š&lt;/li>
&lt;li>NoExecuteï¼Œå¦‚æœnodeæ‰“ä¸Šäº†taintï¼Œåˆ™åœ¨è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œçš„podä¼šè¢«é©±é€ï¼ˆä¸€èˆ¬æ˜¯podå·²ç»åœ¨è¯¥nodeä¸Šè¿è¡Œäº†ï¼Œç„¶ånodeæŒ‚äº†ï¼Œç”±k8sè‡ªåŠ¨ç»™è¯¥nodeæ‰“ä¸Štaintï¼Œç„¶åé©±é€nodeä¸Šè¿è¡Œçš„podï¼‰ï¼Œpodä¹Ÿå¯ä»¥æŒ‡æ˜tolerationsä¸è¢«é©±é€ï¼Œæˆ–è€…åœ¨tolerationså½“ä¸­æŒ‡æ˜å®¹å¿æ—¶é—´ï¼Œåœ¨è¶…å‡ºå®¹å¿æ—¶é—´ä¹‹åä»ä¼šè¢«é©±é€&lt;/li>
&lt;li>PreferNoScheduleï¼Œå¦‚æœæ²¡æœ‰åˆé€‚çš„nodeï¼Œåˆ™å¯ä»¥è¢«è°ƒåº¦è¯¥nodeä¸Šï¼ˆè½¯é™åˆ¶ï¼‰&lt;/li>
&lt;/ul>
&lt;p>èŠ‚ç‚¹å¯èƒ½ä¼šå‡ºç°æŸç§é—®é¢˜ï¼Œå¦‚not-readyæˆ–è€…unreachableï¼Œé‚£ä¹ˆ&lt;strong>k8sä¼šè‡ªåŠ¨ç»™nodeæ‰“ä¸Šä»¥ä¸‹taintï¼š&lt;/strong>&lt;/p>
&lt;p>å¦‚æœpodæœªæŒ‡å®šå¯¹ä»¥ä¸‹ä¸¤ç§taintçš„å®¹å¿åº¦ï¼Œåˆ™k8sè‡ªåŠ¨ä¼šç»™podåŠ ä¸Šå¯¹ä»¥ä¸‹taintçš„tolerationså¹¶æŒ‡å®šå®¹å¿æ—¶é—´ä¸º300sï¼Œè¶…è¿‡è¯¥æ—¶é—´taintæœªæ¸…é™¤åˆ™podä»ä¼šè¢«é©±é€&lt;/p>
&lt;p>&lt;img src="https://tva1.sinaimg.cn/large/008eGmZEgy1goa6tpwjs7j314i05sgms.jpg" alt="image-20201106201619457">&lt;/p>
&lt;h3 id="init-container">init container&lt;/h3>
&lt;p>init containeræ˜¯podä¸­å…ˆäºåº”ç”¨å®¹å™¨åˆ›å»ºçš„å®¹å™¨ï¼Œç”¨äºä¸ºåº”ç”¨å®¹å™¨è¿›è¡Œä¸€äº›åˆå§‹åŒ–é…ç½®ï¼ˆé…ç½®å·ï¼Œé…ç½®ç¯å¢ƒå˜é‡ç­‰ç­‰ï¼‰ï¼Œæˆ–è€…å®‰è£…ä¸€äº›å®ç”¨å·¥å…·ç­‰ç­‰ï¼Œ&lt;strong>æ¨èimageä½¿ç”¨busyboxï¼Œç„¶åå†è¿è¡Œä¸€äº›å‘½ä»¤&lt;/strong>&lt;/p>
&lt;p>&lt;strong>init containerå¯ä»¥æœ‰å¤šä¸ªï¼Œé¡ºåºæ‰§è¡Œï¼Œå‰ä¸€ä¸ªæˆåŠŸæ‰§è¡Œåæ‰èƒ½æ‰§è¡Œåä¸€ä¸ªï¼ˆå¦‚æœinitå®¹å™¨æ‰§è¡Œå¤±è´¥ï¼Œåˆ™k8sä¼šé‡å¯è¯¥podï¼‰ï¼Œæœ‰ç‚¹ç±»ä¼¼jobï¼Œå…¨éƒ¨æˆåŠŸæ‰§è¡Œå®Œæˆä¹‹åï¼ˆæ³¨æ„æ˜¯ä¹‹åï¼‰ï¼Œæ‰ä¼šåˆ›å»ºåº”ç”¨å®¹å™¨&lt;/strong>&lt;/p>
&lt;p>init containerä¸èƒ½ä½¿ç”¨readinessProbeå’ŒlivenessProbeï¼Œ&lt;strong>å› ä¸ºä»–ä»¬åœ¨åº”ç”¨å®¹å™¨åˆ›å»ºä¹‹å‰å®Œæˆï¼Œpodè¿˜æœªå°±ç»ª&lt;/strong>&lt;/p>
&lt;h3 id="å®¹å™¨èµ„æºé™åˆ¶">å®¹å™¨èµ„æºé™åˆ¶&lt;/h3>
&lt;p>é™¤è‡ªå®šä¹‰èµ„æºé™åˆ¶å¤–ï¼Œä¸€èˆ¬é™åˆ¶CPUå’Œmemory&lt;/p>
&lt;p>ä¸¤ç§é™åˆ¶ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>requests:&lt;/p>
&lt;p>&lt;strong>èŠ‚ç‚¹ä¸Špodçš„requestsæ€»å’Œä¸èƒ½è¶…è¿‡èŠ‚ç‚¹å¯ç”¨èµ„æºçš„100%&lt;/strong>ï¼Œk8sçš„è°ƒåº¦å™¨è°ƒåº¦ä¹Ÿæ˜¯æ ¹æ®requestsæ¥è°ƒåº¦ï¼Œå¦‚æœpodçš„requests&lt;strong>å°äº&lt;/strong>ï¼ˆèŠ‚ç‚¹å¯ä½¿ç”¨èµ„æºæ€»é‡-å…¶ä»–podç”³è¯·é‡ï¼‰ï¼Œå³ä½¿å…¶ä»–podçš„&lt;strong>å®é™…ä½¿ç”¨èµ„æºé‡&lt;/strong>æœªè¾¾åˆ°ä»–ä»¬æ‰€ç”³è¯·é‡ï¼Œè¿™ä¸ªpodä¹Ÿä¸å¯ä»¥è°ƒåº¦åˆ°è¿™ä¸ªèŠ‚ç‚¹ä¸Šã€‚å½“æœªè¿›è¡Œlimitsé™åˆ¶æ—¶ï¼Œpodçš„å®é™…ä½¿ç”¨èµ„æºé‡æ˜¯å¯ä»¥&lt;strong>è¶…è¿‡&lt;/strong>ç”³è¯·é‡çš„ï¼Œæ¯”å¦‚æœ‰podæš‚æ—¶ä¸éœ€è¦CPUæ—¶ï¼Œè€Œæœ‰è®¡ç®—å¯†é›†å‹podéœ€è¦å…¨åŠ›ä½¿ç”¨CPUæ—¶ï¼Œä¾¿å¯ä»¥è¶…è¿‡ç”³è¯·é‡å…¨éƒ¨å ç”¨CPUã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>limitsï¼ˆåº•å±‚å®é™…ä¸Šæ˜¯cgropè¿›è¡Œé™åˆ¶ï¼‰:&lt;/p>
&lt;p>&lt;strong>èŠ‚ç‚¹ä¸Špodçš„limitsæ€»å’Œå¯ä»¥è¶…è¿‡èŠ‚ç‚¹å¯ç”¨èµ„æºçš„100%ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºè¶…å–&lt;/strong>ï¼ŒCPUè¿›è¡Œlimitsé™åˆ¶æ—¶ï¼Œè¿›ç¨‹åˆ†ä¸åˆ°æ¯”é™åˆ¶é‡æ›´å¤šçš„CPUï¼Œè€Œå†…å­˜ä¸CPUä¸åŒï¼Œå› ä¸ºå†…å­˜ä¸€æ—¦åˆ†é…ç»™è¿›ç¨‹ï¼Œæƒ³è¦å›æ”¶å°±éœ€è¦è¿›ç¨‹ä¸»åŠ¨é‡Šæ”¾ï¼Œæ‰€ä»¥å¦‚æœæœ‰æ¶æ„podæˆ–è€…æ•…éšœpodï¼Œæˆ–è€…æ˜¯è´ªå©ªçš„è¿›ç¨‹å°±æœ‰å¯èƒ½åƒæ‰èŠ‚ç‚¹ä¸Šæ‰€æœ‰çš„å†…å­˜ï¼Œéœ€è¦è¿›è¡Œé™åˆ¶ï¼Œ&lt;strong>è¿›ç¨‹å¦‚æœç”³è¯·è¶…è¿‡limitsçš„é‡&lt;/strong>æˆ–è€…èŠ‚ç‚¹ä½¿ç”¨æ€»é‡è¶…è¿‡100%å°±æœ‰å¯èƒ½ä¼šé€ æˆOOM(out of memory)ï¼Œè¿›ç¨‹å°±ä¼šæ ¹æ®ç­–ç•¥è¢«æ€æ­»ï¼ˆlinux OOM_reaper subsystemï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="pod-qos">pod QoS&lt;/h4>
&lt;p>ä¸‰ç§ç­‰çº§ï¼ˆä¼˜å…ˆçº§ä»ä½åˆ°é«˜ï¼‰ï¼š&lt;/p>
&lt;ul>
&lt;li>BestEffort&lt;/li>
&lt;li>Burstable&lt;/li>
&lt;li>Guranteed&lt;/li>
&lt;/ul>
&lt;p>å½“èµ„æºä¸å¤Ÿæ—¶ï¼Œæ¯”å¦‚èŠ‚ç‚¹å†…å­˜ä¸å¤Ÿç”¨æ—¶ï¼Œå°±éœ€è¦æ€æ­»podä¸­çš„è¿›ç¨‹ï¼Œæ ¹æ®ä¼˜å…ˆçº§&lt;strong>ä»ä½åˆ°é«˜æ¥æ€æ­»&lt;/strong>&lt;/p>
&lt;p>é‚£æ€ä¹ˆæ¥å†³å®špodçš„QoS classå‘¢ï¼Œç²—ç•¥çš„è§„åˆ™å°±æ˜¯ï¼ŒBestEffortæœªå£°æ˜requestså’Œlimitsï¼›Guranteedå¿…é¡»å£°æ˜requestså’Œlimitsï¼Œä¸”ä¸¤è€…ç›¸ç­‰ï¼›å…¶ä»–æƒ…å†µçš†ä¸ºBurstableï¼ˆæ¯”å¦‚åªæœ‰requestsæˆ–è€…limitsï¼Œrequests&amp;lt;limitsç­‰ï¼‰ï¼Œç»†è‡´çš„è§„åˆ™å¯ä»¥å‚è€ƒï¼š&lt;/p>
&lt;p>&lt;strong>å•å®¹å™¨pod&lt;/strong>ï¼š&lt;/p>
&lt;p>&lt;img src="https://tva1.sinaimg.cn/large/008eGmZEly1gnu8y3ll3pj32nb0u0qv5.jpg" alt="img">&lt;/p>
&lt;p>&lt;strong>å¤šå®¹å™¨pod:&lt;/strong>&lt;/p>
&lt;p>&lt;img src="https://tva1.sinaimg.cn/large/008eGmZEly1gnu8yai41bj32m20u0qv5.jpg" alt="img">&lt;/p>
&lt;p>&lt;strong>å½“èµ„æºä¸å¤Ÿæ—¶ï¼Œä¸åŒç­‰çº§çš„æƒ…å†µä¸‹å…ˆæ€æ­»QoSç­‰çº§ä½çš„Podä¸­çš„è¿›ç¨‹ï¼Œç›¸åŒç­‰çº§çš„podæ ¹æ®è¿›ç¨‹å·²ä½¿ç”¨èµ„æºé‡å’Œå¯ç”¨èµ„æºé‡çš„æ¯”è¾ƒæ¥æ€æ­»è¿›ç¨‹&lt;/strong>&lt;/p>
&lt;h3 id="limitrangeå’Œresourcequota">LimitRangeå’ŒResourceQuota&lt;/h3>
&lt;p>LimitRangeæ˜¯ç”¨æ¥é™åˆ¶æŸä¸ªå‘½åç©ºé—´&lt;strong>å•ä¸ªpod&lt;/strong>çš„å¯ç”¨èµ„æºï¼ŒAPI serverä¸­å­˜åœ¨LimitRange admission controlæ’ä»¶ï¼Œå½“å‘èµ·Pod Postè¯·æ±‚æ—¶å°±éœ€è¦è¿›è¡Œæ£€æŸ¥æˆ–è€…æ·»åŠ å­—æ®µï¼Œæ¯”å¦‚podå±‚é¢å¯ä»¥é™å®špodä¸­æ‰€æœ‰å®¹å™¨çš„æœ€å°requestsæ€»å’Œæˆ–æœ€å¤§limitsæ€»é‡ï¼Œå®¹å™¨å±‚é¢å¯ä»¥é™å®šé»˜è®¤çš„requestså’Œé»˜è®¤çš„limitsï¼Œè¿˜å¯ä»¥é™å®šPVCæœ€å¤§ç”³è¯·é‡ç­‰ã€‚ä¸åŒå‘½åç©ºé—´å¯ä»¥æœ‰ä¸åŒçš„LimitRangeï¼Œä½†æ˜¯LimitRangeæ— æ³•é™åˆ¶å‘½åç©ºé—´ä¸­æ‰€æœ‰podçš„èµ„æºæ€»é‡ï¼Œè¿™éœ€è¦ResourceQuota&lt;/p>
&lt;p>ResourceQuotaæ˜¯ç”¨æ¥é™åˆ¶æŸä¸ªå‘½åç©ºé—´&lt;strong>æ‰€æœ‰pod&lt;/strong>çš„å¯ç”¨èµ„æºï¼Œé™å®šå‘½åç©ºé—´ä¸­æ‰€æœ‰pod requestsæ€»å’Œæˆ–è€…limitsæ€»å’Œï¼Œä½†æ˜¯è¦&lt;strong>æ³¨æ„çš„æ˜¯&lt;/strong>ï¼Œè¿™æ ·podå¿…é¡»é™å®šresourceså­—æ®µï¼Œä¸ç„¶ResourceQuotaæ— æ³•ç¡®å®šå·²ç”¨çš„requestså’Œlimitsé‡ï¼Œæˆ–è€…æ˜ç¡®ç»™å‘½åç©ºé—´å£°æ˜ä¸€ä¸ªLimitRange&lt;/p>
&lt;h3 id="hpahorizontal-pod-autoscaler">HPA(horizontal pod autoscaler)&lt;/h3>
&lt;p>Autoscaleræ ¹æ®æŒ‡å®šèµ„æºï¼ˆé€šå¸¸æ˜¯&lt;strong>CPUæˆ–è€…QPSï¼ˆæ¯ç§’æŸ¥è¯¢ç‡ï¼‰&lt;strong>ç­‰ï¼‰çš„metricsæ¥&lt;/strong>è‡ªåŠ¨æ°´å¹³æ‰©ç¼©&lt;/strong>podï¼ˆdeploymentæˆ–statefulsetç­‰èµ„æºæ§åˆ¶çš„podï¼‰ï¼Œ&lt;strong>å…¶é€šè¿‡æ ¹æ®ä»metric serveré‡‡é›†åˆ°çš„podçš„metricsæ¥è¿›è¡Œè®¡ç®—ï¼Œä»è€Œæ”¹å˜deploymentç­‰èµ„æºçš„replicas&lt;/strong>ï¼Œè¾¾åˆ°è‡ªåŠ¨æ‰©ç¼©podçš„ç›®çš„&lt;/p>
&lt;p>ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªè¦è®©æŒ‡å®šèµ„æºæ‰©ç¼©åˆ°çš„ç›®æ ‡å€¼æ˜¯éœ€è¦&lt;strong>æ˜¾å¼&lt;/strong>çš„è®©ç®¡ç†å‘˜æŒ‡å®šçš„ï¼Œè¿™ä¸ªåªèƒ½æ ¹æ®ç»éªŒæ¥ç¡®å®š&lt;/p>
&lt;h4 id="podæ•°é‡è®¡ç®—æ–¹å¼">podæ•°é‡è®¡ç®—æ–¹å¼&lt;/h4>
&lt;ul>
&lt;li>å•metricï¼šå¦‚æœæ˜¯å•èµ„æºè®¡ç®—çš„è¯ï¼Œæ ¹æ®podçš„&lt;code>[å®é™…ä½¿ç”¨èµ„æºé‡ä¹‹å’Œ/ç›®æ ‡å€¼]&lt;/code>å†å‘ä¸Šå–æ•´&lt;/li>
&lt;li>å¤šmetricsï¼šå¤šèµ„æºè®¡ç®—çš„è¯ï¼Œå–å„å•metricçš„è®¡ç®—å‡ºçš„æ•°é‡çš„Maxå€¼&lt;/li>
&lt;/ul>
&lt;h2 id="replicationcontroller">ReplicationController&lt;/h2>
&lt;p>rcè´Ÿè´£åˆ›å»ºå’Œç®¡ç†podçš„å¤šä¸ªå‰¯æœ¬ï¼Œå…¶æœ‰ä¸‰ä¸ªéƒ¨ä»¶ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>label selectorï¼ˆæ ‡ç­¾é€‰æ‹©å™¨ï¼‰ï¼š&lt;/p>
&lt;p>ç”¨æ¥æ ‡è¯†podï¼Œrc&lt;strong>åªè´Ÿè´£ç®¡ç†åˆ›å»ºrcæ—¶æŒ‡å®šæ ‡ç­¾çš„pod&lt;/strong>ï¼ˆ&lt;strong>åªç®¡è‡ªå·±å®¶çš„å­©å­&lt;/strong>ï¼‰ï¼Œå¦‚æœåœ¨è¿™ä¹‹åpodæ›´æ”¹äº†æ ‡ç­¾ï¼Œå°±è„±ç¦»äº†rcçš„ç®¡ç†èŒƒå›´ï¼ˆpodç›¸å½“äºæ‰‹åŠ¨åˆ›å»ºï¼Œæ— äººç®¡ç†ï¼Œå˜æˆäº†å­¤å„¿ï¼‰ï¼Œrcè®¤ä¸ºç°æœ‰podæ•°ä¸replicasä¸ç¬¦åˆï¼ˆå³å°‘äº†ä¸€ä¸ªpodï¼‰ï¼Œä¼šæ ¹æ®templateåˆ›å»ºæ–°çš„pod&lt;/p>
&lt;/li>
&lt;li>
&lt;p>rplica countï¼ˆå‰¯æœ¬ä¸ªæ•°ï¼‰ï¼š&lt;/p>
&lt;p>æŒ‡å®špodå‰¯æœ¬æ•°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>pod templateï¼ˆpodæ¨¡æ¿ï¼‰ï¼š&lt;/p>
&lt;p>ç”¨æ¥åˆ›å»ºæ–°çš„podï¼Œä¹‹åå¯ä»¥æ›´æ”¹podæ¨¡æ¿ï¼Œåªæ˜¯åˆ›å»ºå‡ºæ¥çš„podå’Œä¹‹å‰çš„ä¸ä¸€æ ·äº†ï¼Œrcå¹¶ä¸å…³å¿ƒpodé•¿ä»€ä¹ˆæ ·ï¼Œå®ƒåªå…³å¿ƒpodçš„å‰¯æœ¬æ•°æ˜¯ä¸æ˜¯ç¬¦åˆé¢„æœŸ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>å¦‚æœpodæ•°å¤šäº†rcå°±ä¼šåˆ é™¤å¤šä½™çš„podï¼ˆä½¿ç¬¦åˆreplicasæ•°ï¼‰ï¼Œå°‘äº†å°±ä¼šåˆ›å»ºæ–°çš„pod&lt;/strong>&lt;/p>
&lt;p>å¯ä»¥ç”¨kubectl scaleæ”¹å˜å‰¯æœ¬æ•°é‡æ¥æ°´å¹³æ‰©ç¼©pod&lt;/p>
&lt;h2 id="replicaset">ReplicaSet&lt;/h2>
&lt;p>ReplicationControllerçš„æ›¿ä»£å“ï¼Œå…·æœ‰æ›´å¼ºçš„æ ‡ç­¾ç­›é€‰åŠŸèƒ½ï¼Œå·¥ä½œæœºç†ä¸rcç›¸åŒï¼Œ&lt;strong>ä»¥åç”¨rså³å¯&lt;/strong>&lt;/p>
&lt;p>å¯åŸºäºæ ‡ç­¾ååŒ¹é…ï¼Œå¤šæ ‡ç­¾åŒ¹é…ï¼Œå•æ ‡ç­¾å¤šå€¼åŒ¹é…ï¼Œç”šè‡³åŒ¹é…ç¼ºå°‘æŸä¸ªæ ‡ç­¾çš„podç­‰ï¼ˆå¢åŠ operatorä¸ºinï¼Œnotinï¼Œexistsç­‰ç­‰ï¼‰&lt;/p>
&lt;h2 id="daemonset">DaemonSet&lt;/h2>
&lt;p>å¦‚æœä¸æŒ‡å®šselectorï¼Œå°±ä¼šåœ¨&lt;strong>æ¯ä¸ªèŠ‚ç‚¹ä¸Šç®¡ç†ä¸€ä¸ªpodï¼ˆè¿™äº›podå¸¸ç”¨ä½œæ¥æ—¥å¿—æ”¶é›†å’Œèµ„æºç›‘æ§ï¼‰&lt;/strong>ï¼ŒæŒ‡å®šäº†å¯¹äºnodeæ ‡ç­¾çš„selectorï¼Œå°±åªä¼šåœ¨ç‰¹å®šèŠ‚ç‚¹ä¸Šæ¯ä¸ªèŠ‚ç‚¹ç®¡ç†ä¸€ä¸ªpod&lt;/p>
&lt;h2 id="job--cronjob">Job &amp;amp; CronJob&lt;/h2>
&lt;p>&lt;strong>jobæ˜¯ä¸€ä¸ªæ‰¹å¤„ç†ä»»åŠ¡&lt;/strong>ï¼ˆå¯é¡ºåºå¯å¹¶è¡Œï¼‰ï¼Œç”¨æ¥å®‰æ’ä¸€ä¸ªæˆ–å¤šä¸ªè¿è¡Œå®Œåé€€å‡ºçš„pod&lt;/p>
&lt;p>æ³¨æ„ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¦‚æœéœ€è¦å¤šæ¬¡å®Œæˆï¼Œå¯ä»¥æŒ‡å®šcompletionså­—æ®µï¼Œè¡¨ç¤ºéœ€è¦å®Œæˆå‡ æ¬¡ä»»åŠ¡ï¼Œjobè·‘å®Œä¸€ä¸ªpodåä¼šå†åˆ›å»ºä¸€ä¸ªpodï¼Œä»¥æ­¤ç±»æ¨ï¼ˆé¡ºåºæ‰§è¡Œï¼‰ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šparallelismæ•°é‡å¹¶è¡Œæ‰§è¡Œ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>jobä¸­podçš„restartPolicyå¿…é¡»ä¸ºonFailureæˆ–è€…Never&lt;/strong>ï¼Œå¦‚æœæ˜¯onFailureï¼Œåˆ™å®¹å™¨å¼‚å¸¸é€€å‡ºåï¼Œpodä»ä¼šåœ¨åŸnodeä¸Šï¼Œè€Œé‡å¯å®¹å™¨ï¼›å¦‚æœæ˜¯Neverï¼Œåˆ™pod failedæ—¶ï¼Œjobä¼šæ–°å»ºä¸€ä¸ªpod&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>jobå­˜åœ¨è¿è¡Œæ—¶é™ï¼Œå¦‚æœè¶…è¿‡äº†activeDeadlineSecondsè¿™ä¸ªæ—¶é™ï¼Œåˆ™jobä¼šè§†ä¸ºå¤±è´¥&lt;/strong>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ä¸€èˆ¬åˆ›å»ºcronjobæ¥åˆ›å»ºjob&lt;/strong>ï¼Œä»è€Œæ¥åˆ›å»ºpodï¼Œcronjobæœºåˆ¶ä¸linux crontabç›¸åŒï¼Œä¼šå®šæ—¶æ‰§è¡Œjob&lt;/p>
&lt;h2 id="service--endpoints">Service &amp;amp; EndPoints&lt;/h2>
&lt;p>å°†ç›¸åŒåŠŸèƒ½çš„podç»„ï¼ˆé€šè¿‡æ ‡ç­¾ç­›é€‰ï¼‰æš´éœ²ä¸€ä¸ªå›ºå®šçš„IPç»™å¤–éƒ¨æˆ–è€…å†…éƒ¨é›†ç¾¤è®¿é—®ï¼ˆé€šè¿‡ç«¯å£è½¬å‘ï¼‰ï¼Œ&lt;strong>è¿™æ ·podå³ä½¿é”€æ¯æˆ–è€…è½¬ç§»ï¼Œå›ºå®šIPä¹Ÿä¸ä¼šå˜åŠ¨&lt;/strong>ï¼Œå½“æœ‰clientè¯·æ±‚serviceæ—¶ï¼Œserviceä¼šéšæœºé€‰æ‹©ä¸€ä¸ªpodè¿›è¡Œè½¬å‘&lt;/p>
&lt;p>å‚è€ƒèµ„æ–™ï¼šhttps://www.qikqiak.com/post/visually-explained-k8s-service/&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æœåŠ¡å‘ç°ï¼š&lt;/p>
&lt;ul>
&lt;li>serviceå¦‚æœæ—©äºpodåˆ›å»ºï¼Œk8sä¼šå°†ä¸ºserviceç»´æŠ¤çš„ä¸€äº›ç¯å¢ƒå˜é‡é…ç½®åˆ°å®¹å™¨å½“ä¸­&lt;/li>
&lt;li>serviceä¹Ÿèƒ½é€šè¿‡kube dnsé€šè¿‡åŸŸåè§£ææ¥æ‰¾åˆ°å¯¹åº”çš„ipï¼ˆç›´æ¥è®¿é—®æœåŠ¡çš„FQDNï¼Œæ‰€æœ‰serviceå¯¹åº”çš„podçš„å®¹å™¨å½“ä¸­ï¼Œ/etc/resolv.conféƒ½æœ‰åŸŸåé…ç½®ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Endpointsï¼š&lt;/p>
&lt;p>Endpointsæ˜¯&lt;strong>ä¸€å¯¹å¯¹çš„ ipï¼šç«¯å£ å¯¹&lt;/strong>ï¼ˆå®¹å™¨å¯¹å¤–æä¾›æœåŠ¡çš„é‚£ä¸ªç«¯å£ï¼‰ï¼Œåˆ›å»ºæœåŠ¡æ—¶æ˜¯æ ¹æ®æ ‡ç­¾ç­›é€‰å™¨è·å¾—å¯¹åº”podçš„ipï¼šç«¯å£å¯¹ï¼Œç„¶åå­˜å‚¨åœ¨Endpointså½“ä¸­ï¼Œå½“å®¢æˆ·ç«¯è¿æ¥serviceæ—¶ï¼ŒæœåŠ¡ä»£ç†é€‰æ‹©Endpointså½“ä¸­çš„ä¸€ä¸ªipç«¯å£å¯¹ï¼Œè¿›è¡Œè¯·æ±‚è½¬å‘ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ&lt;strong>æœåŠ¡æœ‰äº†Endpointsï¼Œæ‰èƒ½å°†è¯·æ±‚è½¬å‘åˆ°ç›¸åº”çš„podï¼Œæ²¡æœ‰æ ‡ç­¾ç­›é€‰å™¨ç­›é€‰å‡ºå¯¹åº”çš„podï¼ŒæœåŠ¡åªæ˜¯ä¸ªç©ºæœåŠ¡è€Œå·²&lt;/strong>ï¼Œå¦‚æœæ›´æ¢æˆ–è€…ç§»é™¤äº†é€‰æ‹©å™¨ï¼ŒEndpointsä¹Ÿä¼šè·Ÿç€å˜åŠ¨æˆ–è€…åœæ­¢æ›´æ–°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°†æœåŠ¡æš´éœ²ç»™å®¢æˆ·ç«¯ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Nodeport:å°†serviceçš„typeè®¾ç½®ä¸ºnodeportï¼Œk8så°†ä¼šä¸ºæ¯ä¸ªèŠ‚ç‚¹ä¸Šå¼€ä¸€ä¸ªæŒ‡å®šç«¯å£ï¼Œåˆ°è¯¥ç«¯å£çš„æµé‡éƒ½ä¼šé‡å®šå‘åˆ°æ­¤æœåŠ¡ï¼Œç„¶åå†ç”±æœåŠ¡é‡å®šå‘åˆ°pod&lt;/p>
&lt;p>Client &amp;ndash;&amp;gt; èŠ‚ç‚¹çš„æŒ‡å®šç«¯å£ &amp;ndash;&amp;gt;clusteræœåŠ¡&amp;ndash;&amp;gt; pod&lt;/p>
&lt;p>æ—¢å¯ä»¥è®¿é—®æœåŠ¡çš„é›†ç¾¤ipæ¥è®¿é—®ï¼Œä¹Ÿå¯ä»¥è®¿é—®èŠ‚ç‚¹æŒ‡å®šç«¯å£æ¥è®¿é—®&lt;/p>
&lt;p>&lt;img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gob3wn28e1j31400u0e8d.jpg" alt="image-20200917195909101">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>LoadBalancerï¼šå°†serviceçš„typeæŒ‡å®šä¸ºLoadBalancerï¼ŒLoadBalanceréœ€è¦æœ‰ç‹¬æœ‰çš„å…¬ç½‘ipï¼Œä¸“é—¨ç”±è´Ÿè´£è´Ÿè½½å‡è¡¡çš„æœºå­æ¥åšé‡å®šå‘ï¼Œ æœºåˆ¶ä¸nodeportä¸€è‡´ï¼ˆ&lt;strong>åªä¸è¿‡å¤šåšäº†ä¸€æ¬¡æ•°æ®æµé‡å®šå‘&lt;/strong>ï¼‰&lt;/p>
&lt;p>Client &amp;ndash;&amp;gt; LoadBalancer &amp;ndash;&amp;gt; èŠ‚ç‚¹çš„æŒ‡å®šç«¯å£&amp;ndash;&amp;gt;clusteræœåŠ¡&amp;ndash;&amp;gt; pod&lt;/p>
&lt;p>&lt;img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gob3wrz939j31400u0b2k.jpg" alt="image-20200917200648198">&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>â€‹ æ€»ç»“ï¼šLoad Balancer &amp;ndash;&amp;gt; Node Port &amp;ndash;&amp;gt; cluster service å±‚å±‚å¾€ä¸‹&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Ingressï¼š&lt;/p>
&lt;p>é€šè¿‡å¤–åŠ çš„ingress controlleræ¥è¿›è¡Œåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ï¼Œå½“å®¢æˆ·ç«¯å‘ingresså‘é€httpè¯·æ±‚ï¼Œæ ¹æ®ä¸»æœºåå’Œè·¯å¾„åˆ†å‘åˆ°å¯¹åº”çš„æœåŠ¡ï¼ˆ&lt;strong>è¿™æ ·æ—¢å¯ä»¥åªç”¨ä¸€ä¸ªå…¬ç½‘ipå°±å¯ä»¥ä¸ºå¤šæœåŠ¡åšè´Ÿè½½å‡è¡¡å’Œå¯¹å¤–æš´éœ²ï¼Œåˆå¯ä»¥é¿å…nodeportå¼€æ”¾è¿‡å¤šç«¯å£å¯èƒ½é€ æˆçš„å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºè¿è¡Œk8séœ€è¦å…³é—­é˜²ç«å¢™&lt;/strong>ï¼‰ï¼Œé€šè¿‡ä¸è¯¥æœåŠ¡ç›¸å…³è”çš„Endpointæ¥æŸ¥çœ‹ipï¼Œç„¶åå°†å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬å‘ç»™å…¶ä¸­ä¸€ä¸ªpod&lt;/p>
&lt;p>Client &amp;ndash;&amp;gt; ingress controller &amp;ndash;&amp;gt; pod&lt;/p>
&lt;p>Ingress controllerå®ç°æ–¹æ¡ˆï¼š nginxï¼Œtraefixï¼ŒHAproxyç­‰ç­‰&lt;/p>
&lt;p>ingresså‚è€ƒèµ„æ–™ï¼šhttps://www.cnblogs.com/linuxk/p/9706720.html&lt;/p>
&lt;p>ingress controlleré€šå¸¸é€šè¿‡daemonsetå®ç°ï¼Œåœ¨æ¯ä¸ªnodeä¸Šè·‘ä¸€ä¸ªpodï¼ˆå¦‚nginxï¼‰ï¼Œå®ƒä¼šç›‘å¬ingressçš„å˜åŒ–ï¼Œä¸€æ—¦æœ‰æ–°çš„ingresså°±æ ¹æ®æ¨¡æ¿ç”Ÿæˆé…ç½®ç„¶åå†™å…¥podä¸­ï¼Œç„¶åreloadã€‚ingresså°±æ˜¯è½¬å‘è§„åˆ™ï¼Œè¦å‘å¾€å“ªäº›serviceï¼ŒæŒ‡å®šä»€ä¹ˆURLæ¥è½¬å‘åˆ°ç›¸åº”çš„serviceã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>headlessæœåŠ¡ï¼š&lt;/p>
&lt;p>å°†æœåŠ¡çš„clusterIPå­—æ®µè®¾ç½®ä¸ºnoneï¼Œk8sä¾¿ä¸ä¼šä¸ºå…¶åˆ†é…é›†ç¾¤ipï¼Œç”¨dnsæŸ¥æ‰¾æœåŠ¡ä¼šè¿”å›æ‰€æœ‰pod ipï¼Œå®¢æˆ·ç«¯ä¼šç›´æ¥è®¿é—®podï¼Œè€Œä¸æ˜¯ç»è¿‡æœåŠ¡ä»£ç†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>External Name:&lt;/p>
&lt;p>é€šè¿‡external nameæŒ‡å®šé›†ç¾¤å¤–éƒ¨æœåŠ¡ï¼ˆDNSåï¼‰ï¼Œå°†å…¶è™šæ‹Ÿä¸ºå†…éƒ¨æœåŠ¡ï¼ˆç›´æ¥é€šè¿‡cluster ipè®¿é—®å³å¯ï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="volume">volume&lt;/h2>
&lt;p>&lt;strong>ä½¿ç”¨å·æ¥è®©å®¹å™¨ä¹‹é—´å…±äº«æ–‡ä»¶æˆ–è€…æŒä¹…åŒ–æ–‡ä»¶&lt;/strong>&lt;/p>
&lt;h3 id="volumeçš„ç§ç±»">volumeçš„ç§ç±»&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>emptyDirï¼ˆ&lt;strong>ä¸€ä¸ªpodä¸­çš„å¤šä¸ªå®¹å™¨å…±äº«&lt;/strong>ï¼‰:&lt;/p>
&lt;p>emptyDirå·çš„å£°æ˜å‘¨æœŸä¸podçš„ç”Ÿå‘½å‘¨æœŸç›¸åŒï¼Œå·çš„å£°æ˜æ˜¯åœ¨åˆ›å»ºpodæ—¶å£°æ˜çš„ï¼Œ&lt;strong>podåˆ é™¤å·ä¹Ÿè·Ÿç€åˆ é™¤&lt;/strong>ï¼Œå·ä»ä¸€ä¸ªç©ºç›®å½•å¼€å§‹ï¼ŒæŒ‚è½½åˆ°å¤šä¸ªå®¹å™¨çš„æŸä¸ªæ–‡ä»¶å¤¹åï¼ˆæ–‡ä»¶å¤¹åœ¨ä¸åŒå®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿçš„ä½ç½®å¯ä»¥ä¸ä¸€æ ·ï¼‰ï¼Œå¤šä¸ªå®¹å™¨ä¹‹é—´ä¾¿å¯ä»¥å¾€é‡Œé¢å­˜æ”¾æ–‡ä»¶ï¼Œä»¥ä¾¿å…±äº«&lt;/p>
&lt;/li>
&lt;li>
&lt;p>gitRepo:&lt;/p>
&lt;p>gitRepoå®é™…ä¸Šæ˜¯ä¸€ä¸ªemptyDirå·ï¼Œä¸emptyDiråŒç†ï¼Œåªä¸è¿‡åˆ›å»ºå·åå·ä¸­ä¼šåŠ å…¥ä»gitè¿œç¨‹repoä¸­cloneä¸‹æ¥çš„æ–‡ä»¶ï¼Œæ¯”å¦‚webæœåŠ¡å®¹å™¨æŒ‚è½½äº†è¿™æ ·ä¸€ä¸ªå·ï¼Œç½‘é¡µå¼€å‘è€…å¾€gitè¿œç¨‹ä»“åº“é‡Œpushæ–°çš„ç½‘é¡µç‰ˆæœ¬ï¼Œsidecarå®¹å™¨ï¼ˆé€šå¸¸æ˜¯git sycå®¹å™¨ï¼‰ä¾¿å¯ä»¥è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œä»¥ä¾¿webæœåŠ¡å™¨å¯¹å¤–æœåŠ¡ï¼ˆ&lt;strong>å…¶å®å°±æ˜¯emptyDirçš„åŸºç¡€ä¸Šä¹‹åå¤šåŠ äº†git repoä¸­cloneä¸‹æ¥çš„æ•°æ®è€Œå·²&lt;/strong>ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>hostPath:&lt;/p>
&lt;p>hostPathå¯ä»¥æä¾›æŒä¹…åŒ–å­˜å‚¨ï¼Œä¸ä¼šéšpodåˆ é™¤è€Œåˆ é™¤ï¼Œå®ƒè®¿é—®çš„æ˜¯èŠ‚ç‚¹ä¸Šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®¹å™¨å¯ä»¥é€šè¿‡æŒ‚è½½hostPathå·è®¿é—®èŠ‚ç‚¹ä¸Šçš„æŸäº›ç‰¹å®šæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œä½†æ˜¯&lt;strong>ä¸æ¨èä½¿ç”¨hostPathæ¥ä½œä¸ºæ•°æ®åº“æ•°æ®ç­‰éœ€è¦ä¸€ç›´ä¿å­˜åœ¨ç›®å½•ä¸Šçš„æ•°æ®&lt;/strong>ï¼Œå› ä¸ºå¦‚æœpodè¢«é‡æ–°è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šå°±æ‰¾ä¸åˆ°hostPathä¸Šçš„æ•°æ®äº†ï¼Œæ‰€ä»¥åº”è¯¥ç”¨pv&lt;/p>
&lt;/li>
&lt;li>
&lt;p>configMap:&lt;/p>
&lt;p>å°†æ¯ä¸ªconfigMapä¸­çš„é”®å€¼å¯¹æš´éœ²ä¸ºæ–‡ä»¶æ”¾åˆ°å·ä¸­ï¼ŒæŒ‚è½½åˆ°å®¹å™¨å½“ä¸­ä¹‹åä»è€Œå®¹å™¨å¯ä»¥è¿›è¡Œè¯»å–ï¼Œä¸emptyDirå’ŒgitRepoåŒç†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>PersistentVolumeï¼ˆæŒä¹…åŒ–å­˜å‚¨ï¼Œåç«¯å­˜å‚¨ï¼‰&lt;/p>
&lt;p>&lt;strong>PVæ˜¯å¯¹åˆ†å¸ƒå¼å­˜å‚¨èµ„æºçš„æŠ½è±¡&lt;/strong>ï¼Œpvçš„æä¾›è€…å¯ä»¥æ˜¯å„ç§äº‘æä¾›å•†ï¼Œå¦‚AWSï¼ŒGCEï¼Œä¹Ÿå¯ä»¥æ˜¯nfsï¼Œglusterfsï¼Œcephç­‰å¼€æºåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œå…·ä½“å®ç°å…·ä½“å¯¹å¾…ã€‚pvçš„ä¿¡æ¯åŒ…æ‹¬å­˜å‚¨èƒ½åŠ›ï¼ˆæ¯”å¦‚å®¹é‡å¤šå¤§ï¼‰ï¼Œè®¿é—®æ¨¡å¼ï¼ˆæ˜¯ReadWriteOnceï¼ŒReadOnlyManyï¼Œè¿˜æ˜¯ReadWriteManyï¼‰ï¼Œå›æ”¶ç­–ç•¥ï¼ˆä¸pvcè§£ç»‘åå¯¹pvçš„å¤„ç†æ˜¯ä¿ç•™ï¼Œå›æ”¶è¿˜æ˜¯åˆ é™¤ï¼‰ç­‰ã€‚&lt;/p>
&lt;p>pvcæ˜¯å¯¹pvçš„ç”³è¯·ï¼Œå¯ä»¥ä¸pvè¿›è¡Œä¸€ä¸€ç»‘å®šï¼Œåªè¦æœ‰pvæ»¡è¶³pvcä¸­ç”³è¯·çš„å®¹é‡å’Œè®¿é—®æ¨¡å¼ï¼Œk8så°±ä¼šå°†å…¶ç»‘å®šèµ·æ¥ï¼Œpvä¸€æ—¦ä¸pvcç»‘å®šèµ·æ¥å°±ä¸èƒ½å†å»ä¸å…¶ä»–pvcç»‘å®šäº†ï¼Œä½†æ˜¯å¦‚æœpvå¤§å°ä¸æ»¡è¶³pvcç”³è¯·é‡ï¼Œpvcä¼šä¸€ç›´pendingï¼Œç›´åˆ°æœ‰è¶³å¤Ÿå¤§å°çš„pvåŠ å…¥ã€‚&lt;strong>pvcå°±ç›¸å½“äºæ˜¯å·ï¼Œç„¶åpodä½¿ç”¨å…¶æ¥æŒ‚è½½åˆ°å¯¹åº”ç›®å½•ï¼Œç›¸å½“äºæ˜¯pod-&amp;gt;pvc-&amp;gt;pvä¸‰å±‚ç»“æ„&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åŠ¨æ€ç»‘å®šï¼ˆ&lt;strong>ä½¿ç”¨StorageClass&lt;/strong>)ï¼š&lt;/p>
&lt;p>åŸå§‹çš„é™æ€ç»‘å®šå¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://www.kubernetes.org.cn/img/2018/06/20180604211538.png" alt="img">&lt;/p>
&lt;p>åŸå§‹é™æ€ç»‘å®šéœ€è¦ç®¡ç†å‘˜å®ç°åˆ›å»ºå¥½pvï¼Œå·¥ä½œæ˜¯éè‡ªåŠ¨çš„ï¼Œä¸”pvçš„é‡æ˜¯é™æ€çš„ï¼Œå¾ˆæœ‰å¯èƒ½é€ æˆèµ„æºæµªè´¹ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨åŠ¨æ€ç»‘å®šï¼š&lt;/p>
&lt;p>&lt;img src="https://www.kubernetes.org.cn/img/2018/06/%E5%9B%BE%E7%89%872.png" alt="img">&lt;/p>
&lt;p>ç°åœ¨åŠ å…¥ä¸€ä¸ªèµ„æºå«StorageClassï¼Œç”¨æˆ·åˆ›å»ºpvcåï¼Œstorageclassçš„æ§åˆ¶å™¨ä¼šæ ¹æ®pvcæŒ‡å®šçš„storageClassNameæ¥æ‰¾åˆ°å¯¹åº”çš„å­˜å‚¨ç±»ï¼Œç„¶ååŠ¨æ€çš„åˆ›å»ºpvï¼Œå†å°†å…¶ä¸pvcç»‘å®šï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯&lt;strong>æ—¢åŠ¨æ€åˆ›å»ºpvï¼Œå‡å°‘äº†ç®¡ç†å‘˜çš„å·¥ä½œé‡ï¼Œåˆä½¿ç”¨å­˜å‚¨ç±»æ¥æŠ½è±¡æè¿°ä¸€ç§å­˜å‚¨ç±»åˆ«ï¼Œæ¯”å¦‚æ˜¯â€å¿«é€Ÿå­˜å‚¨â€œè¿˜æ˜¯â€æ…¢é€Ÿå­˜å‚¨â€œï¼Œæ˜¯â€å†—ä½™å­˜å‚¨â€œè¿˜æ˜¯â€æ— å†—ä½™å­˜å‚¨â€œç­‰ç­‰ï¼Œéå¸¸ç›´è§‚&lt;/strong>&lt;/p>
&lt;p>å¦‚æœæ²¡æœ‰é»˜è®¤å­˜å‚¨ç±»ï¼Œä¸”pvcæ²¡æœ‰æŒ‡å®šstorageClassNameï¼Œåˆ™è¿™ä¸ªpvcåªèƒ½ä¸æ²¡æœ‰æŒ‡å®šå­˜å‚¨ç±»çš„pvç»‘å®šï¼Œå¦åˆ™æ²¡æœ‰æŒ‡å®šstorageClassNameçš„pvcå°†äº¤ç”±é»˜è®¤å­˜å‚¨ç±»å¤„ç†&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="configmap">ConfigMap&lt;/h2>
&lt;p>å°†é…ç½®å•ç‹¬åˆ—ä¸ºèµ„æºï¼Œæ–¹ä¾¿ç§»åŠ¨å’Œä¿®æ”¹ï¼Œ&lt;strong>è¿™æ ·podå®šä¹‰æ—¶ä¸ç”¨å®šæ­»å’Œé‡å¤ç¯å¢ƒå˜é‡é…ç½®&lt;/strong>ï¼Œä¹Ÿå¢åŠ äº†é…ç½®çš„é‡ç”¨æ€§ï¼Œè€Œä¸”ä½¿ç”¨ç¯å¢ƒå˜é‡å’Œå‘½ä»¤å‚æ•°ä½œä¸ºpodé…ç½®çš„æ–¹æ³•æ— æ³•åœ¨è¿›ç¨‹è¿è¡Œæ—¶æ›´æ–°é…ç½®ï¼Œ&lt;strong>configmapæš´éœ²ä¸ºå·å¯ä»¥è¿›è¡Œçƒ­æ›´æ–°,æ— éœ€é‡æ–°åˆ›å»ºpodæˆ–é‡å¯å®¹å™¨&lt;/strong>&lt;/p>
&lt;p>&lt;strong>configmapä¸­å­˜æ”¾çš„å°±æ˜¯key-valueå¯¹&lt;/strong>&lt;/p>
&lt;p>kubectl create configmap [configmap-name]å³å¯åˆ›å»ºconfigmapï¼ˆæˆ–è€…kubectl create -f xxx.yamlï¼‰&lt;/p>
&lt;h3 id="å‚æ•°å½¢å¼">å‚æ•°å½¢å¼ï¼š&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&amp;ndash;from-literal&lt;em>key&lt;/em>value ç›´æ¥ç”¨key*valueå½¢å¼å®šä¹‰å˜é‡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&amp;ndash;from-file*[file or directory] è¯»å–æ–‡ä»¶ä¸ºå˜é‡ï¼Œå¦‚æœæ²¡æŒ‡å®škeyï¼Œåˆ™ç›´æ¥ç”¨fileçš„åå­—ä¸ºkeyï¼Œvalueä¸ºfileä¸­çš„æ•°æ®ï¼Œå¦‚æœè¯»å–çš„æ˜¯æ•´ä¸ªæ–‡ä»¶å¤¹ï¼Œåˆ™æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„æ–‡ä»¶éƒ½ä¼šè¢«åˆ—ä¸ºkey*value&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>&amp;ndash;from-literalå’Œ&amp;ndash;from-fileéƒ½å¯ä»¥å†™å¤šä¸ª&lt;/strong>&lt;/p>
&lt;h3 id="configmapçš„è¯»å–å½¢å¼">configmapçš„è¯»å–å½¢å¼ï¼š&lt;/h3>
&lt;ul>
&lt;li>podçš„yamlä¸­æŒ‡å®šenvæˆ–è€…envFromæ¥ç»™å®¹å™¨å½“ä¸­çš„ç¯å¢ƒå˜é‡èµ‹å€¼ï¼Œåœ¨è¿™åŸºç¡€ä¹‹ä¸Šï¼Œè¿˜å¯ä»¥å†ä¼ ç»™podä¸­çš„yamlä¸­çš„argsæ¥ç»™å‘½ä»¤å‚æ•°èµ‹å€¼ï¼ˆ&lt;strong>é€‚ç”¨äºå˜é‡å€¼è¾ƒçŸ­çš„åœºæ™¯&lt;/strong>ï¼‰&lt;/li>
&lt;li>ä½¿ç”¨configmapå·æ¥å­˜æ”¾configmapä¸­çš„æ‰€æœ‰é”®å€¼å¯¹ï¼Œç„¶åæŒ‚è½½åˆ°å®¹å™¨å½“ä¸­ï¼ˆ&lt;strong>æ¨èï¼Œå°†å˜é‡å€¼æ•´åˆæˆä¸ºæ–‡ä»¶&lt;/strong>ï¼‰ã€‚&lt;strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæŒ‚è½½ä¼šè¦†ç›–æŒ‚è½½ç‚¹ä¸‹åŸå·²æœ‰çš„æ–‡ä»¶ï¼Œå¦‚æœæœ‰éœ€è¦ä¸è¦†ç›–çš„è¯å¯ä»¥ç”¨subpathæŒ‡å®šéœ€è¦æŒ‚è½½çš„æŸä¸ªæ–‡ä»¶åŠ åˆ°æŒ‚è½½ç‚¹ç›®å½•å½“ä¸­&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h2 id="secret">Secret&lt;/h2>
&lt;p>åŸç†ä¸configmapç±»ä¼¼ï¼Œå¯ä»¥å­˜æ”¾äºŒè¿›åˆ¶æ•°æ®ï¼Œé‡‡ç”¨base64ç¼–ç ï¼Œä¸“é—¨ç”¨æ¥å­˜å‚¨æ•æ„Ÿæ•°æ®ï¼ˆå®‰å…¨ï¼‰ï¼Œ&lt;strong>configmapç”¨æ¥å­˜å‚¨éæ•æ„Ÿæ•°æ®ï¼ˆä¸€äº›é…ç½®ï¼‰&lt;/strong>&lt;/p>
&lt;p>ç”¨secretå·æŒ‚è½½åˆ°å®¹å™¨å½“ä¸­å³å¯å¼•ç”¨secretå†…çš„key-valueé”®å€¼å¯¹ï¼Œ&lt;strong>æœ€å¥½ä¸è¦ç”¨ç¯å¢ƒå˜é‡å¼•ç”¨ï¼Œå› ä¸ºç¯å¢ƒå˜é‡ä¼šæ¶‰åŠåˆ°å®‰å…¨é—®é¢˜&lt;/strong>&lt;/p>
&lt;p>Tips:&lt;/p>
&lt;ul>
&lt;li>k8sé€šè¿‡å°†secretåˆ†å‘åˆ°éœ€è¦è®¿é—®secretçš„podæ‰€åœ¨çš„èŠ‚ç‚¹çš„å†…å­˜ä¸­ï¼Œè¿™æ ·ä¹Ÿæ–¹ä¾¿åˆ é™¤&lt;/li>
&lt;li>å¦‚æœæœªç»™podæŒ‡å®šservice accountï¼Œk8sä¼šç»™podæŒ‡å®šå…¶æ‰€åœ¨namespaceçš„default service accountï¼Œä¼šåœ¨æ¯ä¸ªå®¹å™¨çš„/var/run/secrets/kubetnetes.io/serviceaccountç›®å½•æŒ‚è½½ä¸€ä¸ªé»˜è®¤secretå·:default-token-xxxxï¼Œè¿™ä¸ªsecretä¸­å«ä¸‰ä¸ªæ¡ç›®ï¼Œåˆ†åˆ«æ˜¯ï¼š
&lt;ul>
&lt;li>ca.crtï¼šCAçš„è¯ä¹¦ï¼Œå½“podè®¿é—®APIæœåŠ¡å™¨æ—¶ï¼ˆé€šè¿‡httpsï¼‰ï¼ŒéªŒè¯APIæœåŠ¡å™¨è¿”å›çš„è¯ä¹¦å°±æ˜¯CAç­¾å‘çš„&lt;/li>
&lt;li>namespace: podæ‰€åœ¨çš„namespace&lt;/li>
&lt;li>token: ç”¨æ¥é€šè¿‡api serverçš„è®¤è¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="downwardapi">DownwardAPI&lt;/h2>
&lt;p>ä½¿ç”¨configmapå’Œsecretæ— æ³•è®©åº”ç”¨è·å–åˆ°&lt;strong>podçš„ipï¼Œpodçš„åç§°ï¼Œpodè¿è¡ŒèŠ‚ç‚¹çš„åç§°&lt;/strong>ç­‰ç­‰åªæœ‰podæˆåŠŸéƒ¨ç½²åæ‰ä¼šè·å–åˆ°çš„å…ƒæ•°æ®ï¼Œé€šè¿‡DownwardAPIçš„æ–¹å¼å¯ä»¥æš´éœ²ä¸€ä¸ªpodè¿™äº›éƒ¨åˆ†å…ƒæ•°æ®&lt;/p>
&lt;h3 id="æš´éœ²æ–¹å¼">æš´éœ²æ–¹å¼ï¼š&lt;/h3>
&lt;ul>
&lt;li>ç›´æ¥åœ¨pod manifestçš„containerå½“ä¸­å£°æ˜ç¯å¢ƒå˜é‡ï¼Œå¼•ç”¨manifestå½“ä¸­çš„æŸäº›å­—æ®µï¼ˆç¯å¢ƒå˜é‡æ–¹å¼ï¼‰&lt;/li>
&lt;li>é€šè¿‡æŒ‚è½½DownwardAPIå·æ¥è·å–æ–‡ä»¶ï¼Œä»è€Œè·å–å…ƒæ•°æ®ï¼ˆå·æ–¹å¼ï¼Œ&lt;strong>å·æ–¹å¼æ‰èƒ½æš´éœ²podçš„æ ‡ç­¾å’Œæ³¨è§£&lt;/strong>ï¼‰&lt;/li>
&lt;/ul>
&lt;h2 id="deployment">Deployment&lt;/h2>
&lt;p>deploymentç”¨äºéƒ¨ç½²åº”ç”¨å¹¶ä»¥å£°æ˜çš„å½¢å¼å‡çº§åº”ç”¨&lt;/p>
&lt;p>åˆ›å»ºdeploymentæ—¶ï¼Œreplicasetä¹Ÿä¼šè·Ÿç€åˆ›å»ºï¼Œç”±rsæ¥ç®¡ç†podï¼Œdeploymentç®¡ç†å¤šä¸ªrs&lt;/p>
&lt;p>&lt;strong>æ›´æ”¹deploymentçš„&lt;/strong>podæ¨¡æ¿&lt;strong>å³å¯å®Œæˆå‡çº§ï¼Œç”±k8sçš„æ§åˆ¶å™¨æ“ä½œå®Œæˆ&lt;/strong>&lt;/p>
&lt;h3 id="å‡çº§æ–¹å¼">å‡çº§æ–¹å¼&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>è“ç»¿éƒ¨ç½²&lt;/p>
&lt;p>åœ¨è¿è¡Œæ–°ç‰ˆæœ¬çš„podä¹‹å‰ï¼Œserviceæµé‡å§‹ç»ˆå®šä½åˆ°æ—§ç‰ˆæœ¬podï¼Œä¸€æ—¦ç¡®å®šæ–°ç‰ˆæœ¬åŠŸèƒ½è¿è¡Œæ­£å¸¸ï¼Œä¿®æ”¹serviceçš„é€‰æ‹©å™¨ï¼Œå®šä½åˆ°æ–°ç‰ˆæœ¬çš„podï¼Œåˆ é™¤æ—§ç‰ˆæœ¬çš„replicaset&lt;/p>
&lt;p>&lt;img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gob3wyc4q2j31wu0u0u13.jpg" alt="image-20201021161437006">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ»šåŠ¨å‡çº§&lt;/p>
&lt;p>æ–°çš„rsæ§åˆ¶æ–°ç‰ˆæœ¬çš„podï¼Œé€šè¿‡æ›´æ”¹æ–°æ—§rsçš„æœŸæœ›æ•°é‡æ¥å¼¹æ€§æ‰©ç¼©æ—§ç‰ˆæœ¬ä¸æ–°ç‰ˆæœ¬çš„podæ•°é‡ï¼Œæ–°ç‰ˆæœ¬podä¸€ç‚¹ç‚¹å¢å¤šï¼Œæ—§ç‰ˆæœ¬podä¸€ç‚¹ç‚¹å‡å°‘ï¼Œç›´åˆ°æ‰€æœ‰æ›´æ–°ä¸ºæ­¢&lt;/p>
&lt;p>&lt;img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gob3x1q66qj31ou0u0npe.jpg" alt="6D21A0ED0EAF37931D60F5EF5098258D">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é‡‘ä¸é›€å‡çº§&lt;/p>
&lt;p>ä¸€å°éƒ¨åˆ†podå‡çº§ä¸ºæ–°ç‰ˆæœ¬ï¼Œç‰ºç‰²ä¸€å°éƒ¨åˆ†ç”¨æˆ·çš„ä½“éªŒï¼ˆbetaç‰ˆæœ¬ï¼‰ï¼Œå¦‚æœæ–°ç‰ˆæœ¬é€‚ç”¨åˆ™å…¨éƒ¨å‡çº§å®Œæˆï¼Œå¦åˆ™å›æ»šåˆ°ä¸Šä¸ªç‰ˆæœ¬&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="kubectl-rollout-å‘½ä»¤">kubectl rollout å‘½ä»¤&lt;/h3>
&lt;p>è¿›è¡Œå‡çº§deploymentæ—¶ï¼Œå¯ä»¥é€šè¿‡kubectl rolloutè¿›è¡Œå‡çº§æŸ¥çœ‹å’Œå›æ»šç­‰&lt;/p>
&lt;ul>
&lt;li>
&lt;p>kubectl rollout status deployment [name]&lt;/p>
&lt;p>æŸ¥çœ‹æ»šåŠ¨å‡çº§çŠ¶æ€&lt;/p>
&lt;/li>
&lt;li>
&lt;p>history deployment [name]&lt;/p>
&lt;p>æŸ¥çœ‹å‡çº§å†å²ï¼ˆå¯ä»¥æŒ‡å®šrevisionæ¥å›æ»šæŒ‡å®šç‰ˆæœ¬ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>pause æš‚åœæ»šåŠ¨å‡çº§&lt;/p>
&lt;/li>
&lt;li>
&lt;p>resume æ¢å¤æ»šåŠ¨å‡çº§&lt;/p>
&lt;/li>
&lt;li>
&lt;p>undo å›æ»šåˆ°ä¸Šä¸ªç‰ˆæœ¬&lt;/p>
&lt;p>å¯æ·»åŠ &amp;ndash;to-revisionå‚æ•°å›åˆ°historyç»™å‡ºçš„æŒ‡å®šrevisionç‰ˆæœ¬&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="deployment-manifesté‡è¦å­—æ®µ">deployment manifesté‡è¦å­—æ®µ&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>maxSurge&lt;/p>
&lt;p>é™¤deploymentå®šä¹‰çš„æœŸæœ›å€¼å¤–ï¼Œæœ€å¤šå…è®¸è¶…è¿‡çš„podå¯ç”¨å®ä¾‹æ•°é‡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>maxUnavailable&lt;/p>
&lt;p>ç›¸å¯¹äºæœŸæœ›å€¼ï¼Œæœ€å¤šä¸å¯ç”¨podçš„æ•°é‡&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å¯ä»¥é€šè¿‡ä¿®æ”¹maxSurgeå’ŒmaxUnavailableæ§åˆ¶æ»šåŠ¨å‡çº§é€Ÿåº¦&lt;/p>
&lt;ul>
&lt;li>
&lt;p>minReadySeconds&lt;/p>
&lt;p>podè‡³å°‘è¦è¿è¡ŒminReadySecondsç§’ï¼Œæ‰èƒ½è§†å…¶ä¸ºå¯ç”¨çŠ¶æ€ï¼Œå› ä¸ºmaxUnavailableé™åˆ¶äº†ä¸å¯ç”¨podæ•°é‡ï¼Œæ‰€ä»¥ä¸å¯ç”¨çš„è¯ï¼Œæ»šåŠ¨å‡çº§ä¸ä¼šç»§ç»­&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="statefulset">StatefulSet&lt;/h2>
&lt;p>&lt;strong>ç”¨æ¥ç»´æŠ¤æœ‰çŠ¶æ€åº”ç”¨&lt;/strong>ï¼Œå› ä¸ºæœ‰çŠ¶æ€åº”ç”¨å¯èƒ½éœ€è¦ä¸»æœºåï¼Œipç­‰ä¸å˜&lt;/p>
&lt;p>statefulsetç»´æŠ¤çš„podå‰¯æœ¬åæ˜¯å¯é¢„çŸ¥çš„ï¼ŒæŒ‰ç…§statefulsetåç§°åŠ é¡ºåºç´¢å¼•å€¼ç»„æˆï¼Œæ¯æ¬¡æ‰©ç¼©å®¹éƒ½æ˜¯æ‰©ç¼©ç´¢å¼•æœ€é«˜çš„é‚£ä¸ª&lt;/p>
&lt;p>statefulsetå¯¹äºæœ‰çŠ¶æ€åº”ç”¨åšå‡ºçš„æ”¹å˜ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¯¹äºipå¯èƒ½çš„æ”¹å˜ï¼š&lt;/p>
&lt;p>éœ€è¦ä½ é™¤statefulsetä¹‹å¤–é¢å¤–å®šä¹‰ä¸€ä¸ªheadless serviceï¼Œç„¶åæ ¹æ®åŸŸåæ¥è®¿é—®å„ä¸ªpodï¼Œè¿™æ ·æ¯ä¸ªpodçš„dnsè®°å½•å›ºå®š&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯¹äºä¸»æœºåç»´æŒä¸å˜&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯¹äºpodåˆ é™¤è€Œå­˜å‚¨å¯èƒ½å‘ç”Ÿçš„å˜åŠ¨ï¼š&lt;/p>
&lt;p>å¦‚æœstatefulsetç»´æŠ¤çš„podè¢«åˆ é™¤äº†ï¼Œä¸replicasetç›¸åŒï¼Œstatefulsetä¼šé‡æ–°åˆ›å»ºpodï¼Œä½†è¿™ä¸ªpodå¯èƒ½ä¼šè°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œå¯¹äºæœ‰çŠ¶æ€åº”ç”¨æ¥è¯´ï¼Œæœ‰çŠ¶æ€çš„podåº”è¯¥æŒ‚è½½åŸæ¥ç›¸åŒçš„å­˜å‚¨ï¼Œè¿™å°±éœ€è¦pvcå’Œpvï¼Œåˆ›å»ºä¸€ä¸ªstatefulsetçš„æ—¶å€™ï¼Œä¸ä»…éœ€è¦å†™podæ¨¡æ¿ï¼Œè¿˜éœ€è¦å†™pvcï¼Œ&lt;strong>statefulsetå¯¹æ¯ä¸ªpodéƒ½åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªç‹¬ç«‹çš„pvc&lt;/strong>ï¼Œå› ä¸ºæŒ‚è½½çš„pvcä¸å˜ï¼Œæ‰€ä»¥æ–°å®ä¾‹è¯»å–çš„ä»ç„¶æ˜¯æ—§å®ä¾‹çš„æ•°æ®&lt;/p>
&lt;p>æ³¨æ„ï¼š&lt;/p>
&lt;p>å¦‚æœpodè¢«æ„å¤–åˆ é™¤ï¼Œ&lt;strong>å…¶æŒ‚è½½çš„pvcä¸ä¼šè¢«åˆ é™¤&lt;/strong>ï¼Œå› ä¸ºå¦‚æœpvcè¢«åˆ é™¤ï¼Œå…¶ç»‘å®šçš„pvå¯èƒ½ä¼šè¢«å›æ”¶æˆ–è€…åˆ é™¤ï¼Œé‚£å…¶ä¸Šçš„æ•°æ®å°±ä¸¢å¤±äº†ï¼Œæ‰€ä»¥æ— è®ºæ˜¯ç¼©å®¹è¿˜æ˜¯æ„å¤–åˆ é™¤äº†statefulsetçš„podï¼Œéƒ½ä¼šä¿ç•™pvcï¼Œæ„å¤–ç¼©å®¹äº†statefulsetä¹‹åä»ç„¶èƒ½é€šè¿‡æ‰©å®¹ï¼Œå°†podé‡æ–°æŒ‚è½½åŸæ¥ä¸¢å¤±äº†æŒ‚è½½çš„pvcï¼Œä½†æ˜¯statefulsetåªèƒ½&lt;strong>çº¿æ€§ç¼©å®¹&lt;/strong>ï¼Œä¸èƒ½åœ¨æœ‰ä¸€ä¸ªå®ä¾‹ä¸å¥åº·çš„æ—¶å€™è¿›è¡Œç¼©å®¹ï¼Œè¿™æ—¶åŒæ—¶æœ‰ä¸¤ä¸ªpodä¸‹çº¿ï¼Œé‚£æ•°æ®å°±ä¸¢å¤±äº†ã€‚å¦‚æœæƒ³åˆ é™¤pvï¼Œéœ€è¦&lt;strong>æ‰‹åŠ¨&lt;/strong>åˆ é™¤ç»‘å®šçš„pvc&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="serviceaccount">ServiceAccount&lt;/h2>
&lt;p>user accountæ˜¯ç»™é›†ç¾¤å¤–éƒ¨ç”¨æˆ·è®¾è®¡çš„ï¼Œè€Œservice accountæ˜¯ä¸ºäº†&lt;strong>podè®¿é—®api server&lt;/strong>è€Œè®¾è®¡çš„ï¼ˆæ¯åˆ›å»ºä¸€ä¸ªservice accountå°±ä¼šæœ‰å¯¹åº”çš„ä¸€ä¸ªsecretè¢«åˆ›å»ºï¼Œè¿™ä¸ªsecretå½“ä¸­å†…å«ca.certï¼Œnamespaceï¼Œtokenï¼ŒæŒ‚è½½ç‚¹/var/run/secrets/kubernetes.io/serviceaccountï¼Œè·Ÿsecretç« èŠ‚ä¸­æåˆ°çš„default tokenæ˜¯ä¸€æ ·çš„ï¼‰&lt;/p>
&lt;p>&lt;strong>tips:&lt;/strong>&lt;/p>
&lt;p>Api serverçš„è®¿é—®è¿‡ç¨‹éœ€è¦ç»è¿‡çš„æ’ä»¶ï¼šè®¤è¯(authenticaiton)&amp;ndash;&amp;gt;æˆæƒ(authorization)&amp;ndash;&amp;gt;å‡†å…¥æ§åˆ¶(admission control)&lt;/p>
&lt;p>å½“åˆ›å»ºä¸€ä¸ªnamespaceæ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªé»˜è®¤çš„default serviceaccountï¼ˆæ¯ä¸ªnamespaceåº•ä¸‹ä¸€ä¸ªï¼‰ï¼Œæ‰€ä»¥service accountæ˜¯å±€é™äºå…¶æ‰€åœ¨çš„namespaceçš„ã€‚å½“åˆ›å»ºä¸€ä¸ªpodæ—¶ï¼Œé»˜è®¤æŒ‡å®šçš„service accountå°±æ˜¯podæ‰€åœ¨namespaceåº•ä¸‹çš„defaultï¼ˆé™¤éæŒ‡å®šæŸä¸ªservice accountï¼‰ï¼Œ&lt;strong>è¿™ä¸ªservice accountåœ¨é»˜è®¤æ²¡æœ‰ç»‘å®šrolebindingæˆ–è€…clusterrolebindingçš„æƒ…å†µä¸‹ï¼Œæ˜¯æ²¡æœ‰æŸ¥çœ‹å’Œä¿®æ”¹é›†ç¾¤èµ„æºæƒé™çš„&lt;/strong>&lt;/p>
&lt;h3 id="rbac">RBAC&lt;/h3>
&lt;p>å››ç§RBACèµ„æºï¼ˆroleå¯ä»¥ç†è§£ä¸ºå¯¹äºèµ„æºçš„æƒé™ï¼Œbindingå°±æ˜¯å°†æƒé™èµ‹äºˆæŸä¸ªaccountï¼‰&lt;/p>
&lt;h4 id="æŸä¸ªå…·ä½“å‘½åç©ºé—´">æŸä¸ªå…·ä½“å‘½åç©ºé—´&lt;/h4>
&lt;ul>
&lt;li>role:&lt;strong>å¯¹ä»…é™äºæŸä¸ªç‰¹å®šå‘½åç©ºé—´&lt;/strong>çš„èµ„æºçš„æ“ä½œæƒé™&lt;/li>
&lt;li>rolebinding:&lt;strong>ä»…é™äºæŸä¸ªç‰¹å®šå‘½åç©ºé—´&lt;/strong>çš„æƒé™ç»‘å®š&lt;/li>
&lt;/ul>
&lt;h4 id="é›†ç¾¤èŒƒå›´æˆ–ä»»æ„å‘½åç©ºé—´">é›†ç¾¤èŒƒå›´æˆ–ä»»æ„å‘½åç©ºé—´&lt;/h4>
&lt;ul>
&lt;li>clusterrole:&lt;strong>å¯¹äºé›†ç¾¤èµ„æºæˆ–æ‰€æœ‰å‘½åç©ºé—´èµ„æºæˆ–éèµ„æºå‹URL&lt;/strong>çš„æ“ä½œæƒé™&lt;/li>
&lt;li>clusterrolebinding:&lt;strong>å¯¹äºé›†ç¾¤èµ„æºæˆ–æ‰€æœ‰å‘½åç©ºé—´èµ„æºæˆ–éèµ„æºå‹URL&lt;/strong>çš„æƒé™ç»‘å®š&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>å½“bindingç»‘å®šåˆ°æŸä¸ªservice accountæˆ–user accountä¹‹åï¼Œè¿™ä¸ªaccountå°±è·å¾—äº†å¯¹äºroleè§„å®šçš„æƒé™&lt;/strong>&lt;/p>
&lt;p>&lt;img src="https://tva1.sinaimg.cn/large/008eGmZEly1gni8tkzq8nj32c30u04qq.jpg" alt="img">&lt;/p>
&lt;p>ä¸€äº›é‡è¦çš„ç³»ç»Ÿè‡ªå®šclusterroleï¼š&lt;/p>
&lt;ul>
&lt;li>viewï¼šé™¤äº†roleï¼Œrolebindingå’Œsecretå¤–å¯ä»¥è¯»å–å¤§éƒ¨åˆ†èµ„æº&lt;/li>
&lt;li>editï¼šé™¤äº†roleï¼Œrolebindingå¤–å¯ä»¥è¯»å–å’Œä¿®æ”¹å¤§éƒ¨åˆ†èµ„æº&lt;/li>
&lt;li>admin: é™¤äº†ResourceQuotaèƒ½è¯»å–å’Œä¿®æ”¹æ‰€æœ‰èµ„æº&lt;/li>
&lt;li>cluster admin:å®Œå…¨èƒ½è¯»å–å’Œä¿®æ”¹æ‰€æœ‰èµ„æº&lt;/li>
&lt;/ul>
- http://example.org/posts/k8s-resource%E6%A6%82%E6%9E%90/ - æœ¬ç«™éµå¾ª CC-BY-NC 4.0 åè®®</description></item></channel></rss>